cscope 15 $HOME/git/mazewar -q 0000001183 0000131189
	@Exception.h

1 #iâdeà
EXCEPTION_H


2 
	#EXCEPTION_H


	)

3 
	~"fwk/PŒ.h
"

4 
	~"fwk/PŒIÁ”çû.h
"

5 
	~<io¡»am
>

6 
	~<¡ršg
>

7 
usšg
 
Çme¥aû
 
	g¡d
;

10 şas 
	cExû±iÚ
 {

11 
	mpublic
:

12 
¡ršg
 
	$wh©
(ècÚ¡ {  
wh©_
; }

13 
vœtu®
 ~
	$Exû±iÚ
(){
	}
};

14 
	$Exû±iÚ
(cÚ¡ *
¡r
è: 
	$wh©_
(
¡r
è{
	}
}

15 
	$Exû±iÚ
(
¡ršg
 
¡r
è: 
	$wh©_
(
¡r
è{
	}
}

17 
´iv©e
:

18 
¡ršg
 
wh©_
;

21 şas 
	cRªgeExû±iÚ
 : 
public
 
Exû±iÚ
 {

22 
public
:

23 
	$RªgeExû±iÚ
(
¡ršg
 
šfo
è: 
	$Exû±iÚ
(
šfo
){};

24 ~
	$RªgeExû±iÚ
(){
	}
};

27 şas 
	cNameInU£Exû±iÚ
 : 
public
 
Exû±iÚ
 {

28 
public
:

29 
	$NameInU£Exû±iÚ
(
¡ršg
 
šfo
è: 
	$Exû±iÚ
(
šfo
){};

30 ~
	$NameInU£Exû±iÚ
(){
	}
};

33 şas 
	cP”missiÚExû±iÚ
 : 
public
 
Exû±iÚ
 {

34 
public
:

35 
	$P”missiÚExû±iÚ
(
¡ršg
 
šfo
è: 
	$Exû±iÚ
(
šfo
){};

36 ~
	$P”missiÚExû±iÚ
(){
	}
};

39 şas 
	cNoIm¶em’tiÚExû±iÚ
 : 
public
 
Exû±iÚ
 {

40 
public
:

41 
	$NoIm¶em’tiÚExû±iÚ
(
¡ršg
 
šfo
è: 
	$Exû±iÚ
(
šfo
){};

42 ~
	$NoIm¶em’tiÚExû±iÚ
(){
	}
};

45 şas 
	cA‰ribu‹NÙSuµÜ‹dExû±iÚ
 : 
public
 
NoIm¶em’tiÚExû±iÚ
 {

46 
public
:

47 
	$A‰ribu‹NÙSuµÜ‹dExû±iÚ
(
¡ršg
 
šfo
)

48 : 
	$NoIm¶em’tiÚExû±iÚ
(
šfo
){};

49 ~
	$A‰ribu‹NÙSuµÜ‹dExû±iÚ
(){
	}
};

52 şas 
	cEÁ™yNÙFoundExû±iÚ
 : 
public
 
Exû±iÚ
 {

53 
public
:

54 
	$EÁ™yNÙFoundExû±iÚ
(
¡ršg
 
šfo
è: 
	$Exû±iÚ
(
šfo
){};

55 ~
	$EÁ™yNÙFoundExû±iÚ
(){
	}
};

	@Nominal.h

1 #iâdeà
__NOMINAL_H__


2 
	#__NOMINAL_H__


	)

4 
	g‹m¶©e
 <
şass
 
	gUn™Ty³
, cÏs 
	gR•Ty³
> cÏs 
	cNomš®
 {

5 
	mpublic
:

6 
	$Nomš®
(
R•Ty³
 
v
è: 
	$v®ue_
(
v
) {}

8 
boŞ
 
İ”©Ü
==(cÚ¡ 
Nomš®
<
Un™Ty³
, 
R•Ty³
> &
v
) const {

9  
v®ue_
 =ğ
v
.value_;

10 
	}
}

12 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
Nomš®
<
Un™Ty³
, 
	gR•Ty³
> &
	gv
) const {

13  
	gv®ue_
 !ğ
v
.
v®ue_
;

16 cÚ¡ 
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
> &

17 
	gİ”©Ü
=(cÚ¡ 
Nomš®
<
Un™Ty³
, 
	gR•Ty³
> &
	gv
) {

18 
	gv®ue_
 = 
v
.
v®ue_
;

19  *
	gthis
;

22 
R•Ty³
 
	$v®ue
(ècÚ¡ {  
v®ue_
; 
	}
}

24 
	g´Ùeùed
:

25 
R•Ty³
 
v®ue_
;

28 
	g‹m¶©e
 <
şass
 
	gUn™Ty³
, cÏs 
	gR•Ty³
>

29 
şass
 
	gOrdš®
 : 
public
 
Nomš®
<
Un™Ty³
, 
	gR•Ty³
> {

30 
	gpublic
:

31 
Ordš®
(
R•Ty³
 
v
è: 
Nomš®
<
Un™Ty³
, 
	gR•Ty³
>(
	gv
) {}

33 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
> &
	gv
) const {

34  
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 < 
v
.value_;

37 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
Ordš®
<
Un™Ty³
, 
	gR•Ty³
> &
	gv
) const {

38  
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 <ğ
v
.value_;

41 
boŞ
 
	gİ”©Ü
>(cÚ¡ 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
> &
	gv
) const {

42  
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 > 
v
.value_;

45 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
Ordš®
<
Un™Ty³
, 
	gR•Ty³
> &
	gv
) const {

46  
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 >ğ
v
.value_;

49 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
>

50 
	gİ”©Ü
+(cÚ¡ 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
> &
	gÙh”
) {

51  (
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 + 
Ùh”
.value_);

54 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
>

55 
	gİ”©Ü
/(cÚ¡ 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
> &
	gÙh”
) {

56  (
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
 / 
Ùh”
.value_);

59 cÚ¡ 
	gOrdš®
<
	gUn™Ty³
, 
	gR•Ty³
> &
	gİ”©Ü
++() {

60 ++
	gNomš®
<
	gUn™Ty³
, 
	gR•Ty³
>::
v®ue_
;

61  *
	gthis
;

	@display.cpp

37 
	~"maš.h
"

39 
	~"mazew¬.h
"

41 
	~"di¥Ïy.h
"

43 
XY·œ
 *
¶ÙLše
(XY·œ *, 
boŞ
);

44 
XY·œ
 *
hidd’
(
Loc
, Loc, 
DœeùiÚ
, XYpair *);

45 
Tok’VisibË
(
R©IndexTy³
);

46 
XORTok’
(
R©IndexTy³
);

47 
g‘R©
(
R©IndexTy³
, *, *, *);

54 
	$In™Di¥Ïy
(
¬gc
, **
¬gv
è{ 
	`In™Wšdow
×rgc,‡rgv); 
	}
}

63 
	$S¹Di¥Ïy
(è{ 
	`S¹Wšdow
(
¿tB™s_width
, 
¿tB™s_height
); 
	}
}

82 
	#NDIR
 
NDIRECTION


	)

83 
boŞ
 
	g´evEdge3
, 
	g´evEdge7
;

84 
boŞ
 
	gedge1
, 
	gedge2
, 
	gedge3
, 
	gedge4
, 
	gedge5
, 
	gedge6
, 
	gedge7
;

85 
XY·œ
 
	gedge3Lšes
[2], 
	gedge7Lšes
[2];

86 
XY
 
	gl1D–
[
NDIR
] = {{0, -1}, {0, 1}, {1, 0}, {-1, 0}};

87 
XY
 
	gl2D–
[
NDIR
] = {{1, -1}, {-1, 1}, {1, 1}, {-1, -1}};

88 
XY
 
	gc2D–
[
NDIR
] = {{1, 0}, {-1, 0}, {0, 1}, {0, -1}};

89 
XY
 
	gr1D–
[
NDIR
] = {{0, 1}, {0, -1}, {-1, 0}, {1, 0}};

90 
XY
 
	gr2D–
[
NDIR
] = {{1, 1}, {-1, -1}, {-1, 1}, {1, -1}};

91 #undeà
NDIR


93 
	$ShowV›w
(
Loc
 
x
, Loø
y
, 
DœeùiÚ
 
dœ
) {

94 
XY·œ
 *

 = 
v›wTabË
;

95 
tx
 = 
x
.
	`v®ue
();

96 
ty
 = 
y
.
	`v®ue
();

97 
R©IndexTy³
 
	`¿tIndex
(0);

98 
R©Look
 
¿tLook
;

99 
boŞ
 
ŞdVisibË
;

101 
	`CË¬V›w
();

102 
´evEdge3
 = 
´evEdge7
 = 
FALSE
;

103 !
M
->
maze_
[
tx
][
ty
]) {

104 

 = 
	`hidd’
(
tx
, 
ty
, 
dœ
,p);

105 
dœ
.
	`v®ue
()) {

106 
NORTH
:

107 
tx
++;

109 
SOUTH
:

110 
tx
--;

112 
EAST
:

113 
ty
++;

115 
WEST
:

116 
ty
--;

120 ià(
´evEdge3
)

121 ()
	`¶ÙLše
(
edge3Lšes
, 
TRUE
);

122 ià(
´evEdge7
)

123 ()
	`¶ÙLše
(
edge7Lšes
, 
TRUE
);

127 
¿tIndex
 = 0;„©Index < 
MAX_RATS
;

128 
¿tIndex
 = 
	`R©IndexTy³
Ô©Index.
	`v®ue
() + 1)) {

129 ià(
¿tIndex
 =ğ
MY_RAT_INDEX
)

131 
¿tLook
 = &
R©s2Di¥Ïy
[
¿tIndex
.
	`v®ue
()];

132 
ŞdVisibË
 = 
¿tLook
->
visibË
;

133 
	`Tok’VisibË
(
¿tIndex
);

134 ià(
¿tLook
->
visibË
 =ğ
TRUE
)

135 
	`XORTok’
(
¿tIndex
);

136 ià(
¿tLook
->
visibË
 !ğ
ŞdVisibË
)

137 
	`Upd©eScÜeC¬d
(
¿tIndex
);

139 
	}
}

143 
XY·œ
 *
	$¶ÙLše
(
XY·œ
 *
p
, 
boŞ
 
two
) {

145 
	`D¿wV›wLše
(
p
->
p1
.
x
,…->p1.
y
,…->
p2
.x,…->p2.y);

146 
p
++;

147 ià(!
two
)

148  
p
;

149 
two
 = 
FALSE
;

151 
	}
}

155 
XY·œ
 *
	$hidd’
(
Loc
 
x
, Loø
y
, 
DœeùiÚ
 
dœ
, 
XY·œ
 *
p
) {

156 
l1x
, 
l1y
, 
l2x
, 
l2y
;

157 
r1x
, 
r1y
, 
r2x
, 
r2y
;

158 
c2x
, 
c2y
;

162 
l1x
 = 
x
.
	`v®ue
(è+ 
l1D–
[
dœ
.v®ue()].
xcÜ
;

163 
l1y
 = 
y
.
	`v®ue
(è+ 
l1D–
[
dœ
.v®ue()].
ycÜ
;

164 
l2x
 = 
x
.
	`v®ue
(è+ 
l2D–
[
dœ
.v®ue()].
xcÜ
;

165 
l2y
 = 
y
.
	`v®ue
(è+ 
l2D–
[
dœ
.v®ue()].
ycÜ
;

166 
r1x
 = 
x
.
	`v®ue
(è+ 
r1D–
[
dœ
.v®ue()].
xcÜ
;

167 
r1y
 = 
y
.
	`v®ue
(è+ 
r1D–
[
dœ
.v®ue()].
ycÜ
;

168 
r2x
 = 
x
.
	`v®ue
(è+ 
r2D–
[
dœ
.v®ue()].
xcÜ
;

169 
r2y
 = 
y
.
	`v®ue
(è+ 
r2D–
[
dœ
.v®ue()].
ycÜ
;

170 
c2x
 = 
x
.
	`v®ue
(è+ 
c2D–
[
dœ
.v®ue()].
xcÜ
;

171 
c2y
 = 
y
.
	`v®ue
(è+ 
c2D–
[
dœ
.v®ue()].
ycÜ
;

175 
edge2
 = 
M
->
maze_
[
c2x
][
c2y
];

176 
edge3
 = 
M
->
maze_
[
l1x
][
l1y
];

177 
edge4
 = !
edge3
;

179 
edge7
 = 
M
->
maze_
[
r1x
][
r1y
];

180 
edge6
 = !
edge7
;

182 
edge1
 = (
edge3
 && (
edge2
 || !
M
->
maze_
[
l2x
][
l2y
])è|| ((!edge2è&& 
edge4
);

183 
edge5
 = (
edge7
 && (
edge2
 || !
M
->
maze_
[
r2x
][
r2y
])è|| ((!edge2è&& 
edge6
);

196 ià(
edge1
)

197 
p
 = 
	`¶ÙLše
Õ, 
FALSE
);

199 
p
++;

200 ià(
edge2
)

201 
p
 = 
	`¶ÙLše
Õ, 
TRUE
);

203 
p
 += 2;

204 ià(
edge3
) {

205 ià(
´evEdge3
) {

206 
edge3Lšes
[0].
p2
 = (
p
++)->p2;

207 
edge3Lšes
[1].
p2
 = 
p
->p2;

209 
edge3Lšes
[0] = *
p
++;

210 
edge3Lšes
[1] = *
p
;

211 
´evEdge3
 = 
TRUE
;

213 
p
++;

215 ià(
´evEdge3
) {

216 ()
	`¶ÙLše
(
edge3Lšes
, 
TRUE
);

217 
´evEdge3
 = 
FALSE
;

219 
p
 += 2;

221 ià(
edge4
)

222 
p
 = 
	`¶ÙLše
Õ, 
TRUE
);

224 
p
 += 2;

225 ià(
edge5
)

226 
p
 = 
	`¶ÙLše
Õ, 
FALSE
);

228 
p
++;

229 ià(
edge6
)

230 
p
 = 
	`¶ÙLše
Õ, 
TRUE
);

232 
p
 += 2;

233 ià(
edge7
) {

234 ià(
´evEdge7
) {

235 
edge7Lšes
[0].
p1
 = (
p
++)->p1;

236 
edge7Lšes
[1].
p1
 = 
p
->p1;

238 
edge7Lšes
[0] = *
p
++;

239 
edge7Lšes
[1] = *
p
;

240 
´evEdge7
 = 
TRUE
;

242 
p
++;

244 ià(
´evEdge7
) {

245 ()
	`¶ÙLše
(
edge7Lšes
, 
TRUE
);

246 
´evEdge7
 = 
FALSE
;

248 
p
 += 2;

250  
p
;

251 
	}
}

258 
	$Tok’VisibË
(
R©IndexTy³
 
hisR©Index
) {

259 
R©Look
 
¿tLook
 = &
R©s2Di¥Ïy
[
hisR©Index
.
	`v®ue
()];

260 
R©
 
¿t
 = 
M
->
	`¿t
(
hisR©Index
);

261 
Loc
 
	`tx
(0), 
	`ty
(0);

262 
DœeùiÚ
 
	`td
(0);

263 
ix
, 
ix12
;

265 
¿tLook
->
visibË
 = 
FALSE
;

266 ià(!
¿t
.
¶ayšg
)

268 ià(
M
->
	`³ekšg
()) {

269 
tx
 = 
M
->
	`xP“k
();

270 
ty
 = 
M
->
	`yP“k
();

271 
td
 = 
M
->
	`dœP“k
();

273 
tx
 = 
MY_X_LOC
;

274 
ty
 = 
MY_Y_LOC
;

275 
td
 = 
MY_DIR
;

277 
ix
 = 0;

278 !
M
->
maze_
[
tx
.
	`v®ue
()][
ty
.value()]) {

279 
td
.
	`v®ue
()) {

280 
NORTH
:

281 
tx
 = 
	`Loc
Ñx.
	`v®ue
() + 1);

283 
SOUTH
:

284 
tx
 = 
	`Loc
Ñx.
	`v®ue
() - 1);

286 
EAST
:

287 
ty
 = 
	`Loc
Ñy.
	`v®ue
() + 1);

289 
WEST
:

290 
ty
 = 
	`Loc
Ñy.
	`v®ue
() - 1);

293 
ix
++;

294 ià((
tx
 =ğ
¿t
.
x
è&& (
ty
 =ğ¿t.
y
)) {

295 
¿tLook
->
visibË
 = !
¿t
.
şßked
;

296 
ix12
 = 
ix
 * 12;

297 
¿tLook
->
x
 = (
v›wTabË
[
ix12
 + 3].
p2
.x + v›wTabË[ix12 + 10].
p1
.x) / 2;

298 
¿tLook
->
y
 = (
v›wTabË
[
ix12
 + 3].
p1
.y + v›wTabË[ix12 + 3].
p2
.y) / 2;

299 
¿tLook
->
tok’Id
 = 
»ÏtiveTok’s
[
td
.
	`v®ue
()][
¿t
.
dœ
.value()];

300 
¿tLook
->
di¡ªû
 = 
ix
;

304 
	}
}

312 
	$XORTok’
(
R©IndexTy³
 
hisR©Index
) {

313 
size
;

314 
¤cX
, 
¤cY
;

316 
	`g‘R©
(
hisR©Index
, &
¤cX
, &
¤cY
, &
size
);

317 
	`Di¥ÏyR©B™m­
(
R©s2Di¥Ïy
[
hisR©Index
.
	`v®ue
()].
x
.v®ue(è- 
size
 / 2,

318 
R©s2Di¥Ïy
[
hisR©Index
.
	`v®ue
()].
y
.v®ue(è- 
size
 / 2, size,

319 
size
, 
¤cX
, 
¤cY
);

320 
	}
}

328 
	$g‘R©
(
R©IndexTy³
 
hisR©Index
, *
x
, *
y
, *
size
) {

329 
v›wT
 = 
LEFT
;

330 
v›w
 = 
R©s2Di¥Ïy
[
hisR©Index
.
	`v®ue
()].
tok’Id
.value();

332 
R©s2Di¥Ïy
[
hisR©Index
.
	`v®ue
()].
di¡ªû
) {

334 *
size
 = 64;

335 *
x
 = 0;

336 *
y
 = 0;

337 
v›wT
 = 0; v›wT !ğ
v›w
; *
x
 += 64)

338 
v›wT
++;

342 *
size
 = 32;

343 *
x
 = 4 * 64; *x != 64 * 5; *x += 32)

344 *
y
 = 0; *y != 64; *y += 32)

345 ià(
v›wT
 =ğ
v›w
)

348 
v›wT
++;

351 *
size
 = 24;

352 *
x
 = 5 * 64; *x != 64 * 5 + 48; *x += 24)

353 *
y
 = 0; *y != 48; *y += 24)

354 ià(
v›wT
 =ğ
v›w
)

357 
v›wT
++;

361 *
size
 = 16;

362 *
x
 = 64 * 5 + 48;

363 *
y
 = 0; *y != 64; *y += 16)

364 ià(
v›wT
 =ğ
v›w
)

367 
v›wT
++;

372 *
size
 = 9;

373 *
y
 = 48;

374 *
x
 = 64 * 5; *x != 64 * 5 + 4 * 9; *x += 9)

375 ià(
v›wT
 =ğ
v›w
)

378 
v›wT
++;

384 *
size
 = 6;

385 *
y
 = 48 + 9;

386 *
x
 = 64 * 5; *x != 64 * 5 + 4 * 6; *x += 6)

387 ià(
v›wT
 =ğ
v›w
)

390 
v›wT
++;

398 *
size
 = 4;

399 *
y
 = 48 + 9 + 3;

400 *
x
 = 64 * 5 + 4 * 6; *x != 64 * 5 + 4 * 6 + 4 * 4; *x += 4)

401 ià(
v›wT
 =ğ
v›w
)

404 
v›wT
++;

407 *
size
 = 3;

408 *
y
 = 48 + 9;

409 *
x
 = 64 * 5 + 4 * 6; *x != 64 * 5 + 4 * 6 + 4 * 3; *x += 3)

410 ià(
v›wT
 =ğ
v›w
)

413 
v›wT
++;

415 
	}
}

422 
	$S‘MyR©IndexTy³
(
R©IndexTy³
 
¿tIndex
) {

423 
R©
 
myR©
;

424 
myR©
 = 
M
->
	`¿t
(
¿tIndex
);

425 
myR©
.
¶ayšg
 = 
TRUE
;

426 
M
->
	`¿tIs
(
myR©
, 
¿tIndex
);

427 
	}
}

434 
	$S‘R©Pos™iÚ
(
R©IndexTy³
 
¿tIndex
, 
Loc
 
x_loc
, Loø
y_loc
,

435 
DœeùiÚ
 
dœ
) {

436 
R©
 
ÃwR©
 = 
M
->
	`¿t
(
¿tIndex
);

437 
ÃwR©
.
¶ayšg
 = 
TRUE
;

438 
ÃwR©
.
x
 = 
x_loc
;

439 
ÃwR©
.
y
 = 
y_loc
;

440 
ÃwR©
.
dœ
 = dir;

441 
M
->
	`¿tIs
(
ÃwR©
, 
¿tIndex
);

443 
	`ş—rPos™iÚ
(
¿tIndex
, 
x_loc
, 
y_loc
);

444 
	}
}

451 
	$CË¬R©Pos™iÚ
(
R©IndexTy³
 
¿tIndex
)

454 
R©
 
ËáR©
 = 
M
->
	`¿t
(
¿tIndex
);

456 
	`ş—rPos™iÚ
(
¿tIndex
, 
ËáR©
.
x
,†eáR©.
y
);

457 
ËáR©
.
¶ayšg
 = 
FALSE
;

458 
M
->
	`¿tIs
(
ËáR©
, 
¿tIndex
);

459 
	}
}

467 
	$ShowPos™iÚ
(
Loc
 
x_loc
, Loø
y_loc
, 
DœeùiÚ
 
tdœ
) {

468 
R©
 
myR©
 = 
M
->
	`¿t
(
MY_RAT_INDEX
);

469 
	`ş—rPos™iÚ
(
MY_RAT_INDEX
, 
myR©
.
x
, myR©.
y
);

470 
	`showMe
(
x_loc
, 
y_loc
, 
tdœ
);

471 
	}
}

479 
	$ShowAÎPos™iÚs
() {

480 
R©IndexTy³
 
	`¿tIndex
(0);

482 
¿tIndex
 = 0;„©Index < 
MAX_RATS
;

483 
¿tIndex
 = 
	`R©IndexTy³
Ô©Index.
	`v®ue
() + 1)) {

484 ià(
¿tIndex
 =ğ
MY_RAT_INDEX
)

486 ià(
M
->
	`¿t
(
¿tIndex
).
¶ayšg
)

487 
	`ş—rPos™iÚ
(
¿tIndex
, 
M
->
	`¿t
Ô©Index).
x
, M->¿tÔ©Index).
y
);

489 
	}
}

496 
	$showMe
(
Loc
 
x_loc
, Loø
y_loc
, 
DœeùiÚ
 
dœ
) {

497 
B™C–l
 *
bp
;

498 
R©
 
½
;

500 
bp
 = 
nÜm®A¼ows
;

502 
	`HackMazeB™m­
(
x_loc
, 
y_loc
, &
bp
[
dœ
.
	`v®ue
()]);

504 
½
 = 
M
->
	`¿t
(
MY_RAT_INDEX
);

506 
½
.
¶ayšg
 = 
TRUE
;

507 
½
.
x
 = 
x_loc
;

508 
½
.
y
 = 
y_loc
;

509 
½
.
dœ
 = dir;

510 
M
->
	`¿tIs
(
½
, 
MY_RAT_INDEX
);

511 
	}
}

519 
	$ş—rPos™iÚ
(
R©IndexTy³
 
¿tIndex
, 
Loc
 
xCË¬
, Loø
yCË¬
) {

520 
R©
 
½
;

521 
i
;

523 
	`ş—rSqu¬e
(
xCË¬
, 
yCË¬
);

524 
i
 = 0; i < 
MAX_RATS
; i++) {

525 
½
 = 
M
->
	`¿t
(
i
);

526 ià((
i
 =ğ
¿tIndex
.
	`v®ue
()è|| !(
½
.
¶ayšg
))

528 ià((
½
.
x
 =ğ
xCË¬
è&& (½.
y
 =ğ
yCË¬
))

529 ià(
i
 =ğ
MY_RAT_INDEX
)

530 
	`showMe
(
½
.
x
,„p.
y
,„p.
dœ
);

532 
	}
}

536 
B™C–l
 
	gEMPTY
 = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};

539 
	$ş—rSqu¬e
(
Loc
 
xCË¬
, Loø
yCË¬
) {

540 
	`HackMazeB™m­
(
xCË¬
, 
yCË¬
, &
EMPTY
);

541 
	}
}

550 
	$NewScÜeC¬d
() {

551 
R©IndexTy³
 
	`¿tIndex
(0);

553 
¿tIndex
 = 0;„©Index < 
MAX_RATS
;

554 
¿tIndex
 = 
	`R©IndexTy³
Ô©Index.
	`v®ue
() + 1))

555 
	`Upd©eScÜeC¬d
(
¿tIndex
);

556 
	}
}

559 
	$Upd©eScÜeC¬d
(
R©IndexTy³
 
¿tIndex
) {

560 
	`CË¬ScÜeLše
(
¿tIndex
);

561 ià(
M
->
	`¿t
(
¿tIndex
).
¶ayšg
)

562 
	`Wr™eScÜeSŒšg
(
¿tIndex
);

563 ià(
R©s2Di¥Ïy
[
¿tIndex
.
	`v®ue
()].
visibË
 =ğ
TRUE
)

564 
	`Inv”tScÜeLše
(
¿tIndex
);

565 
	}
}

582 
	$FlB™m­s
() {

583 
i
;

585 
	`b™Fl
(
nÜm®A¼ows
, 4);

586 
	`b™Fl
(
misse
, 1);

587 
i
 = 0; i < 
¿tB™s_width
 * 
¿tB™s_height
 / 16; i += 64)

588 
	`b™Fl
((
B™C–l
 *)&
¿tB™s
[
i
], 4);

589 
	}
}

597 
	$b™Fl
(
B™C–l
 *
b™s
, 
size
) {

598 
num
, 
tİ
, 
bÙ
, 
i
, 
j
;

600 
i
 = 0; i < 
size
; i++) {

601 
j
 = 0; j < 16; j++) {

602 
num
 = 
b™s
->b™s[
j
] & 0xffff;

603 
tİ
 = 
num
 & 0xff00;

604 
bÙ
 = 
num
 & 0x00ff;

605 
tİ
 >>= 8;

606 
bÙ
 <<= 8;

607 
num
 = 
tİ
 | 
bÙ
;

609 
tİ
 = 
num
 & 0xf0f0;

610 
bÙ
 = 
num
 & 0x0f0f;

611 
tİ
 >>= 4;

612 
bÙ
 <<= 4;

613 
num
 = 
tİ
 | 
bÙ
;

615 
tİ
 = 
num
 & 0xcccc;

616 
bÙ
 = 
num
 & 0x3333;

617 
tİ
 >>= 2;

618 
bÙ
 <<= 2;

619 
num
 = 
tİ
 | 
bÙ
;

621 
tİ
 = 
num
 & 0xaaaa;

622 
bÙ
 = 
num
 & 0x5555;

623 
tİ
 >>= 1;

624 
bÙ
 <<= 1;

625 
b™s
->b™s[
j
] = 
tİ
 | 
bÙ
;

627 
b™s
++;

629 
	}
}

641 
	$Sw­B™m­s
() {

642 
i
;

644 
	`by‹Sw­
(
nÜm®A¼ows
, 4);

645 
	`by‹Sw­
(
misse
, 1);

646 
i
 = 0; i < 
¿tB™s_width
 * 
¿tB™s_height
 / 16; i += 64)

647 
	`by‹Sw­
((
B™C–l
 *)&
¿tB™s
[
i
], 4);

648 
	}
}

655 
	$by‹Sw­
(
B™C–l
 *
b™s
, 
size
) {

656 
i
, 
j
;

658 
i
 = 0; i < 
size
; i++, 
b™s
++)

659 
j
 = 0; j < 16; j++)

660 
b™s
->b™s[
j
] = 
	`htÚs
(bits->bits[j] & 0xffff);

661 
	}
}

671 
	$showMisse
(
Loc
 
x_loc
, Loø
y_loc
, 
DœeùiÚ
 
dœ
, Loø
´ev_x
, Loø
´ev_y
,

672 
boŞ
 
ş—r
) {

674 
B™C–l
 *
bp
;

676 
bp
 = 
misse
;

677 ià(
ş—r
)

678 
	`ş—rSqu¬e
(
´ev_x
, 
´ev_y
);

679 
	`HackMazeB™m­
(
x_loc
, 
y_loc
, &
bp
[0]);

681 
	}
}

	@display.h

1 
R©Aµ_ty³
 
	gR©s2Di¥Ïy
;

13 
B™C–l
 
	gnÜm®A¼ows
[
NDIRECTION
] = {

27 
B™C–l
 
	gmisse
[1] = {

31 
XY·œ
 
	gv›wTabË
[] = {

214 
	#¿tB™s_width
 384

	)

215 
	#¿tB™s_height
 64

	)

216 
	g¿tB™s
[] = {

473 
Tok’Id
 
	g»ÏtiveTok’s
[
NDIRECTION
][NDIRECTION] = {

474 {
REAR
, 
FRONT
, 
RIGHT
, 
LEFT
},

475 {
FRONT
, 
REAR
, 
LEFT
, 
RIGHT
},

476 {
LEFT
, 
RIGHT
, 
REAR
, 
FRONT
},

477 {
RIGHT
, 
LEFT
, 
FRONT
, 
REAR
}

	@fwk/Array.h

4 #iâdeà
FWK_ARRAY_H


5 
	#FWK_ARRAY_H


	)

10 
	~<fwk/Ty³s.h
>

11 
	~<fwk/Ba£CŞËùiÚ.h
>

12 
	~<fwk/Ty³T¿™s.h
>

14 
Çme¥aû
 
	gFwk
 {

16 
šlše
 

17 
z”oIfTrue
Ğ
True
, * 
±r
, 
size_t
 
size
 ) {

18 
mem£t
Ğ
±r
, 0, 
size
 );

21 
šlše
 

22 
z”oIfTrue
Ğ
F®£
, * 
±r
, 
size_t
 
size
 ) {

25 
	g‹m¶©e
< 
ty³Çme
 
	gT
, 
U32
 
	gN
,y³Çm
	gK
=U32 >

26 
şass
 
A¼ay
 : 
public
 
Ba£RefCŞËùiÚ
<
T
> {

27 
public
:

28 
A¼ay
(è{ 
z”oIfTrue
Ğ
ty³Çme
 
IsPod
<
T
>::
V®ue
(), 
¬¿y_
, (‡rray_ )); }

29 ’um { 
	gmaxIndex
 = 
N
 };

30 
T
 cÚ¡ & 
	gİ”©Ü
[]Ğ
	gn
 ) cÚ¡ {  
	g¬¿y_
[ 
n
 ]; }

31 
	gT
 & 
	gİ”©Ü
[]Ğ
	gn
 ) {  
	g¬¿y_
[ 
n
 ]; }

32 
boŞ
 
	gİ”©Ü
==Ğ
A¼ay
< 
T
, 
	gN
, 
	gK
 > cÚ¡ & 
	gÙh”
 ) const {

33  
	gi
 = 0; i < 
	gN
; i++ ) {

34 ifĞ
	g¬¿y_
[
i
] !ğ
Ùh”
[i] ) {

35  
çl£
;

38  
	gŒue
;

40 
boŞ
 
	gİ”©Ü
!=Ğ
A¼ay
< 
T
, 
	gN
, 
	gK
 > cÚ¡ & 
	gÙh”
 ) cÚ¡ {  !(*
	gthis
 =ğ
Ùh”
); }

42 
şass
 
	gI‹¿tÜCÚ¡
 : 
public
 
Ba£I‹¿tÜCÚ¡
<
T
> {

43 
public
:

44 
I‹¿tÜCÚ¡
Ğ
A¼ay
< 
T
, 
N
, 
K
 > cÚ¡ & 
¬¿y
, 
U32
 
¡¬t
 = 0 ) :

45 
Ba£I‹¿tÜCÚ¡
< 
T
 >Ğ&
¬¿y
, &
	g¬¿y
[
¡¬t
] ) {}

46 
usšg
 
	gBa£I‹¿tÜCÚ¡
< 
	gT
 >::
¥aû_
;

47 
ty³Çme
 
	tBa£I‹¿tÜCÚ¡
< 
	tT
 >::
	tBoŞCÚv”siÚ
 BoolConversion;

48 
İ”©Ü
 
	gBoŞCÚv”siÚ
::*() const {

49  
¥aû_
 ? &
BoŞCÚv”siÚ
::
x
 : 
NULL
;

51 
T
 cÚ¡ * 
±r
(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gT
>::ptr(); }

56 
T
 cÚ¡ & 
	gİ”©Ü
*(ècÚ¡ {  *
±r
(); }

60 
´iv©ePŒIs
Ğ
T
 cÚ¡ * 
p
 ) { 
±rIs
(… ); }

62 şas 
	cI‹¿tÜ
 : 
public
 
I‹¿tÜCÚ¡
 {

63 
usšg
 
I‹¿tÜCÚ¡
::
¥aû_
;

64 
	gpublic
:

65 
I‹¿tÜ
Ğ
A¼ay
<
T
,
N
,
K
> cÚ¡ & 
¬¿y
, 
U32
 
¡¬t
 = 0 ) :

66 
I‹¿tÜCÚ¡
Ğ
¬¿y
, 
¡¬t
 ) {}

67 
	gT
 & 
	gİ”©Ü
 *(è{  * 
	gcÚ¡_ÿ¡
<T *>Ğ
	g¥aû_
 ); }

68 
	gI‹¿tÜ
 & 
	gİ”©Ü
++() {

69 
	gthis
->
	gI‹¿tÜCÚ¡
::
İ”©Ü
++();  *this;

72 
I‹¿tÜCÚ¡
 
™”©Ü
() const {

73  
I‹¿tÜCÚ¡
(
this
,0);

76 
	g´iv©e
:

77 
T
 
¬¿y_
[ 
N
 ];

78 
	gBa£CŞËùiÚ
::
	tSŒ•I‹¿tÜ
 StrepIterator;

79 
vœtu®
 
boŞ
 
™”©ÜMÜeLeá
Ğ
SŒ•I‹¿tÜ
 const & ) const;

80 
vœtu®
 
™”©ÜInü
Ğ
SŒ•I‹¿tÜ
& ) const;

81 
vœtu®
 
SŒšg
 
™”©ÜSŒ•
Ğ
SŒ•I‹¿tÜ
 const &) const;

84 
	g‹m¶©e
< 
ty³Çme
 
	gT
,y³Çm
	gK
=
U32
 >

85 
şass
 
A¼ayI‹¿tÜCÚ¡
 : 
public
 
Ba£I‹¿tÜCÚ¡
< 
T
 > {

86 
public
:

87 
‹m¶©e
< 
U32
 
N
 > 
A¼ayI‹¿tÜCÚ¡
Ğ
A¼ay
< 
T
, N, 
K
 > cÚ¡ & 
¬¿y
, U32 
¡¬t
 = 0 ) :

88 
Ba£I‹¿tÜCÚ¡
< 
T
 >Ğ&
¬¿y
, &
	g¬¿y
[
¡¬t
] ) {}

89 
usšg
 
	gBa£I‹¿tÜCÚ¡
< 
	gT
 >::
¥aû_
;

90 
ty³Çme
 
	tBa£I‹¿tÜCÚ¡
< 
	tT
 >::
	tBoŞCÚv”siÚ
 BoolConversion;

91 
İ”©Ü
 
	gBoŞCÚv”siÚ
::*() const {

92  
¥aû_
 ? &
BoŞCÚv”siÚ
::
x
 : 
NULL
;

94 
T
 cÚ¡ * 
±r
(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gT
>::ptr(); }

99 
T
 cÚ¡ & 
	gİ”©Ü
*(ècÚ¡ {  *
±r
(); }

103 
´iv©ePŒIs
Ğ
T
 cÚ¡ * 
p
 ) { 
±rIs
(… ); }

106 
	g‹m¶©e
< 
ty³Çme
 
	gT
, 
U32
 
	gN
,y³Çm
	gK
 >

107 
boŞ
 
	gA¼ay
< 
	gT
, 
	gN
, 
	gK
 >::
	$™”©ÜMÜeLeá
Ğ
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 cÚ¡ & 
™”
 ) const {

108 
A¼ayI‹¿tÜCÚ¡
<
T
,
K
> cÚ¡ * 
i
 = (A¼ayI‹¿tÜCÚ¡<T,K> cÚ¡ *è&
™”
;

109  *
i
 ? 
Œue
 : 
çl£
;

110 
	}
}

112 
	g‹m¶©e
< 
ty³Çme
 
	gT
, 
U32
 
	gN
,y³Çm
	gK
 >

113 
	gA¼ay
< 
	gT
, 
	gN
, 
	gK
 >::
	$™”©ÜInü
Ğ
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 & 
™”
 ) const {

114 
A¼ayI‹¿tÜCÚ¡
<
T
,
K
> * 
i
 = (A¼ayI‹¿tÜCÚ¡<T,K> *è&
™”
;

115 
T
 cÚ¡ * 
p
 = 
i
->
	`±r
();

116 ++
p
;

117 
U32
 
idx
 = 
p
 - 
¬¿y_
;

118 ifĞ
idx
 =ğ
N
 ) {

119 
i
->
	`´iv©ePŒIs
Ğ
NULL
 );

121 
	`as£¹
Ğ
idx
 < 
N
 );

122 
i
->
	`´iv©ePŒIs
Ğ
p
 );

124 
	}
}

130 
Çme¥aû
 
	gFwk
 {

132 
	g‹m¶©e
< 
ty³Çme
 
	gT
, 
U32
 
	gN
,y³Çm
	gK
 >

133 
SŒšg
 
	gA¼ay
< 
	gT
, 
	gN
, 
	gK
 >::
™”©ÜSŒ•
Ğ
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 cÚ¡ & 
™”
 ) const {

134 
A¼ayI‹¿tÜCÚ¡
<
T
,
	gK
> cÚ¡ * 
	gi
 = (A¼ayI‹¿tÜCÚ¡<T,K> cÚ¡ *è&
	g™”
;

135 
T
 cÚ¡ * 
	gp
 = 
i
->
±r
();

136 
U32
 
	gidx
 = 
p
 - 
¬¿y_
;

137 
as£¹
Ğ
idx
 < 
N
 );

142  
v®ueToSŒ•
Ğ
K
Ğ
idx
 ));

146 
	g‹m¶©e
< 
ty³Çme
 
	gT
,y³Çm
	gK
=
U32
 >

147 
şass
 
A¼ayI‹¿tÜ
 : 
public
 
A¼ayI‹¿tÜCÚ¡
< 
T
, 
	gK
 > {

148 
usšg
 
	gA¼ayI‹¿tÜCÚ¡
<
	gT
,
	gK
>::
¥aû_
;

149 
	gpublic
:

150 
‹m¶©e
< 
U32
 
N
 > 
A¼ayI‹¿tÜ
Ğ
A¼ay
<
T
,N,
K
> cÚ¡ & 
¬¿y
, U32 
¡¬t
 = 0 ) :

151 
A¼ayI‹¿tÜCÚ¡
<
T
,
	gK
>Ğ
	g¬¿y
, 
	g¡¬t
 ) {}

152 
	gT
 & 
	gİ”©Ü
 *(è{  * 
	gcÚ¡_ÿ¡
<T *>Ğ
	g¥aû_
 ); }

153 
	gA¼ayI‹¿tÜ
 & 
	gİ”©Ü
++(è{ 
	gthis
->
	gA¼ayI‹¿tÜCÚ¡
<
	gT
,
	gK
>::
İ”©Ü
++();  *this; }

	@fwk/BaseCollection.cpp

3 
	~<fwk/Ba£CŞËùiÚ.h
>

4 
	~<fwk/Exû±iÚ.h
>

6 
boŞ


7 
	gFwk
::
Ba£CŞËùiÚ
::
	$™”©ÜMÜeLeá
Ğ
Fwk
::
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 const & ) const {

8 
throw
 
Fwk
::
	`NoIm¶em’tiÚExû±iÚ
( "generic iteration is unimplemented forhis collectionype" );

9 
	}
}

12 
	gFwk
::
Ba£CŞËùiÚ
::
	$™”©ÜInü
Ğ
Fwk
::
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 & ) const {

13 
throw
 
Fwk
::
	`NoIm¶em’tiÚExû±iÚ
( "generic iteration is unimplemented forhis collectionype" );

14 
	}
}

17 
	gFwk
::
Ba£CŞËùiÚ
::
	$™”©ÜD–‘e
Ğ
Fwk
::
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
& ) cÚ¡ {
	}
}

21 
Fwk
::
SŒšg


22 
Fwk
::
Ba£CŞËùiÚ
::
	$™”©ÜSŒ•
Ğ
Fwk
::
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 const &) const

24 
throw
 
Fwk
::
	`NoIm¶em’tiÚExû±iÚ
( "generic iteration is unimplemented forhis collectionype" );

25 
	}
}

28 
	gFwk
::
Ba£CŞËùiÚ
::
	$™”©ÜS·ûCİy
Ğ
Fwk
::
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 cÚ¡ & 
Ùh”
 ) const

30  
Ùh”
.
¥aû_
;

31 
	}
}

33 
	gFwk
::
Ba£CŞËùiÚ
::~
	$Ba£CŞËùiÚ
() {

34 
	}
}

	@fwk/BaseCollection.h

4 #iâdeà
FWK_BASECOLLECTION_H


5 
	#FWK_BASECOLLECTION_H


	)

7 
	~<fwk/Ty³s.h
>

8 
	~<fwk/PŒ.h
>

9 
	~<fwk/PŒIÁ”çû.h
>

11 
Çme¥aû
 
	gFwk
 {

13 şas 
	cBa£CŞËùiÚ
 {

14 
	gpublic
:

16 
vœtu®
 ~
Ba£CŞËùiÚ
();

18 şas 
	cSŒ•I‹¿tÜ
 {

19 
	gpublic
:

20 ~
SŒ•I‹¿tÜ
(è{ ifĞ
cŞËùiÚ_
 ) cŞËùiÚ_->
™”©ÜD–‘e
Ğ*
this
 ); }

21 
SŒ•I‹¿tÜ
ĞSŒ•I‹¿tÜ cÚ¡ & 
Ùh”
 ) :

22 
cŞËùiÚ_
Ğ
Ùh”
.cŞËùiÚ_ ), 
¥aû_
(

23 
Ùh”
.
cŞËùiÚ_
 ? oth”.cŞËùiÚ_->
™”©ÜS·ûCİy
( other ) :

24 
Ùh”
.
¥aû_
 ), 
d©a0_
(Ùh”.d©a0_), 
d©a1_
(other.data1_) {}

25 
SŒ•I‹¿tÜ
 cÚ¡ & 
	gİ”©Ü
=ĞSŒ•I‹¿tÜ cÚ¡ & 
Ùh”
 ) {

26 iàĞ
cŞËùiÚ_
 ) {

27 
cŞËùiÚ_
->
™”©ÜD–‘e
Ğ*
this
 );

30 
	gcŞËùiÚ_
 = 
Ùh”
.
cŞËùiÚ_
;

31 iàĞ
	gÙh”
.
	gcŞËùiÚ_
 ) {

32 
	g¥aû_
 = 
Ùh”
.
cŞËùiÚ_
->
™”©ÜS·ûCİy
( other );

34 
	g¥aû_
 = 
Ùh”
.
¥aû_
;

36 
	gd©a0_
 = 
Ùh”
.
d©a0_
;

37 
	gd©a1_
 = 
Ùh”
.
d©a1_
;

38  *
	gthis
;

40 
	sBoŞCÚv”siÚ
 { 
	gx
; };

41 
İ”©Ü
 
	gBoŞCÚv”siÚ
::*() const {

42  
cŞËùiÚ_
->
™”©ÜMÜeLeá
Ğ*
this
 ) ? &
BoŞCÚv”siÚ
::
x
 : 
NULL
;

44 
	gSŒ•I‹¿tÜ
& 
	gİ”©Ü
++() {

45 
	gcŞËùiÚ_
->
™”©ÜInü
Ğ*
this
 );

46  *
	gthis
;

48 
SŒšg
 
¡»p
() const {

49  
	gcŞËùiÚ_
->
™”©ÜSŒ•
Ğ*
this
 );

51 
	g´Ùeùed
:

52 
SŒ•I‹¿tÜ
Ğ
Ba£CŞËùiÚ
 cÚ¡ * 
cŞ
, cÚ¡ * 
¥aû
 ) :

53 
cŞËùiÚ_
Ğ
cŞ
 ), 
¥aû_
Ğ
¥aû
 ) {

57 
SŒ•I‹¿tÜ
(è: 
cŞËùiÚ_
(0), 
¥aû_
(0) { }

58 
ä›nd
 
şass
 
	gBa£CŞËùiÚ
;

59 
Ba£CŞËùiÚ
 cÚ¡ * 
	gcŞËùiÚ_
;

60 cÚ¡ * 
	g¥aû_
;

61 
U32
 
	gd©a0_
;

62 
U32
 
	gd©a1_
;

64 
	g´Ùeùed
:

65 cÚ¡ * 
¥aû
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
™
 ) cÚ¡ {  it.
¥aû_
; }

67 
	g´iv©e
:

68 
ä›nd
 
şass
 
SŒ•I‹¿tÜ
;

69 
vœtu®
 
boŞ
 
™”©ÜMÜeLeá
Ğ
SŒ•I‹¿tÜ
 const & ) const;

70 
vœtu®
 
™”©ÜInü
Ğ
SŒ•I‹¿tÜ
& ) const;

71 
vœtu®
 
™”©ÜD–‘e
Ğ
SŒ•I‹¿tÜ
& ) const;

72 
vœtu®
 
SŒšg
 
™”©ÜSŒ•
Ğ
SŒ•I‹¿tÜ
 const &) const;

73 
vœtu®
 cÚ¡ * 
™”©ÜS·ûCİy
Ğ
SŒ•I‹¿tÜ
 const & ) const;

76 
šlše
 
	$_ÃwRef
ĞcÚ¡ vŞ©* 
t
 ) {
	}
}

77 
šlše
 
	$_d–‘eRef
ĞcÚ¡ vŞ©* 
t
 ) {
	}
}

78 
	g‹m¶©e
<
şass
 
	gT
> 
šlše
 
_ÃwRef
Ğ
PŒIÁ”çû
<
T
> cÚ¡ * 
t
 ) { 
	gt
->
ÃwRef
(); }

79 
	g‹m¶©e
<
şass
 
	gT
> 
šlše
 
_d–‘eRef
Ğ
PŒIÁ”çû
<
T
> cÚ¡ * 
t
 ) { 
	gt
->
d–‘eRef
(); }

93 
	g‹m¶©e
<
ty³Çme
 
	gT
>

94 şas 
	cBa£RefCŞËùiÚ
 : 
public
 
Ba£CŞËùiÚ
 {

95 
public
:

96 
vœtu®
 cÚ¡ * 
™”©ÜS·ûCİy
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
™
 ) const {

97 
T
 cÚ¡ * 
t
 = 
¡©ic_ÿ¡
<T cÚ¡ *>Ğ
¥aû
Ğ
™
 ) );

98 ifĞ
	gt
 ) { 
_ÃwRef
Ğ
t
 ); }

99  
	gt
;

101 
vœtu®
 
™”©ÜD–‘e
Ğ
SŒ•I‹¿tÜ
 & 
™
 ) const {

102 
T
 cÚ¡ * 
	gt
 = 
¡©ic_ÿ¡
<T cÚ¡ *>Ğ
¥aû
Ğ
™
 ) );

103 ifĞ
	gt
 ) { 
_d–‘eRef
Ğ
t
 ); }

122 
	g‹m¶©e
<
ty³Çme
 
	gT
, 
boŞ
 
	g»fcouÁ
=
Œue
>

123 şas 
	cBa£I‹¿tÜCÚ¡
 : 
public
 
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
 {

124 
public
:

125 
Ba£I‹¿tÜCÚ¡
ĞcÚ¡ 
Ba£CŞËùiÚ
 * 
cŞ
, 
T
 cÚ¡ * 
t
 ) :

126 
Ba£CŞËùiÚ
::
SŒ•I‹¿tÜ
Ğ
cŞ
, (*è
t
 ) {

127 ifĞ
»fcouÁ
 && 
±r
(èè{ 
_ÃwRef
(…tr() ); }

129 
boŞ
 
	gİ”©Ü
==ĞcÚ¡ 
Ba£I‹¿tÜCÚ¡
& 
mp
 ) const {

130  (
mp
.
±r
(è=ğ±r()è&& (mp.
cŞËùiÚ_
 == collection_);

132 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
Ba£I‹¿tÜCÚ¡
& 
mp
 ) const {

133  !((
mp
.
±r
(è=ğ±r()è&& (mp.
cŞËùiÚ_
 == collection_));

135 
	gBa£I‹¿tÜCÚ¡
<
	gT
>& 
	gİ”©Ü
=ĞcÚ¡ 
Ba£I‹¿tÜCÚ¡
<
T
>& 
mp
 ) {

136 
cŞËùiÚ_
 = 
mp
.collection_;

137 
±rIs
Ğ
mp
.
±r
() );

138 
	gd©a0_
 = 
mp
.
d©a0_
;

139 
	gd©a1_
 = 
mp
.
d©a1_
;

140  *
	gthis
;

142 
İ”©Ü
 
	gBoŞCÚv”siÚ
::*(ècÚ¡ {  
¥aû_
 ? &
BoŞCÚv”siÚ
::
x
 : 
NULL
; }

144 
	g´Ùeùed
:

145 
T
 cÚ¡ * 
±r
(ècÚ¡ {  (T cÚ¡ *è
¥aû_
; }

146 
±rIs
Ğ
T
 cÚ¡ * 
t
 ) {

147 ifĞ
	g»fcouÁ
 && 
	gt
 ) 
_ÃwRef
Ğ
t
 );

148 ifĞ
	g»fcouÁ
 && 
±r
(èè{ 
_d–‘eRef
(…tr() ); }

149 
	g¥aû_
 = (*è
t
;

159 
	g‹m¶©e
 <
şass
 
	gCŞËùiÚ
 >

160 
	$ÜphªAÎMemb”s
Ğ
CŞËùiÚ
 & 
c
 ) {

161 
ty³Çme
 
CŞËùiÚ
::
I‹¿tÜ
 
	`i
Ğ
c
.
	`™”©Ü
() );

162  ; 
i
; ++i ) {

163 
i
->
	`·»ÁIs
(0);

165 
	}
}

	@fwk/BaseNotifiee.cpp

3 
	~<fwk/Ba£NÙif›e.h
>

4 
	~<io¡»am
>

6 
Çme¥aû
 
	gFwk
 {

9 
şass
 
	gAùiv™y
;

10 
SŒšg
 
	gRoÙNÙif›e
::
Çme
() const {  "unknown"; }

11 
	gRoÙNÙif›e
::
isNÚReã»ncšgIs
Ğ
boŞ
 
b
 ) { 
as£¹
Ğ
çl£
 ); }

12 
	gRoÙNÙif›e
::
hªdËNÙifiÿtiÚ
Ğ
Aùiv™y
 * ) {}

13 
RoÙNÙif›e
::
hªdËDeçuÉ
Ğ
Aùiv™y
 *, 
A‰ribu‹Id
, 
boŞ
 ) {}

14 
	gRoÙNÙif›e
::
ÚA‰ribu‹
Ğ
A‰ribu‹Id
 ) {}

15 
RoÙNÙif›e
::
ÚNÙifiÿtiÚExû±iÚ
() {}

17 
RoÙNÙif›e
::
ÚNÙifiÿtiÚExû±iÚ
Ğ
A‰ribu‹Id
 ) {

18 
ÚNÙifiÿtiÚExû±iÚ
();

22 
	gRoÙNÙif›e
::
hªdËNÙifiÿtiÚExû±iÚ
Ğ
A‰ribu‹Id
 
aid
 ) {

23 
ÚNÙifiÿtiÚExû±iÚ
(
aid
);

26 
	gRoÙNÙif›e
::
hªdËNÙifiÿtiÚExû±iÚ
() {

27 
ÚNÙifiÿtiÚExû±iÚ
();

29 
	gRoÙNÙif›e
::
ÚD–‘e
( ) {}

30 
U32
 
RoÙNÙif›e
::
aud™E¼Üs
( U32 ) const {  0; }

33 
	gRoÙNÙif›e
::
ÚNÙifiÿtiÚ
() {}

34 
RoÙNÙif›e
::
ÚCŞËùiÚNÙifiÿtiÚ
Ğ
SŒšg
 ) {}

36 
SŒšg
 
RoÙNÙif›e
::
©Œibu‹SŒšg
ĞRoÙNÙif›e::
A‰ribu‹Id
 
a
 )

38 
Fwk
::
SŒšg
 
¡r
 = "unknown";

39 
	ga
) {

40 
	gnuÎNÙifiÿtiÚ_
: 
¡r
 = "nullNotification_"; ;

41 
	gmuÉËA‰ribu‹s__
: 
¡r
 = "multipleAttributes__"; ;

42 
	gš™ŸlNÙifiÿtiÚ__
: 
¡r
 = "initialNotification__"; ;

43 
	gthis__
: 
¡r
 = "this__"; ;

44 
	gnÙifiÿtiÚExû±iÚ__
: 
¡r
 = "notificationException__"; ;

45 
	gnÙifiÿtiÚA‰ribu‹__
: 
¡r
 = "notificationAttribute__"; ;

46 
	gd–‘eRef__
: 
¡r
 = "deleteRef__"; ;

47 
	g»ã»nûs__
: 
¡r
 = "references__"; ;

48 
	gaud™E¼Üs__
: 
¡r
 = "auditErrors__"; ;

49 
	gÇme__
: 
¡r
 = "name__"; ;

50 
	gv”siÚ__
: 
¡r
 = "version__"; ;

51 
	gşÚe__
: 
¡r
 = "clone__"; ;

52 
	g’t™yRef__
: 
¡r
 = "entityRef__"; ;

53 
	g©Œibu‹__
: 
¡r
 = "attribute__"; ;

54 
	g·»Á__
: 
¡r
 = "parent__"; ;

55 
	gsyncMode__
: 
¡r
 = "syncMode__"; ;

56 
	gÜphª__
: 
¡r
 = "orphan__"; ;

57 
	g’t™yId__
: 
¡r
 = "entityId__"; ;

58 
	gşÚeS‹__
: 
¡r
 = "cloneState__"; ;

61  
	g¡r
;

	@fwk/BaseNotifiee.h

4 #iâdeà
FWK_BASENOTIFIEE_H


5 
	#FWK_BASENOTIFIEE_H


	)

7 
	~<fwk/PŒIÁ”çû.h
>

8 
	~<fwk/Exû±iÚ.h
>

9 
	~<fwk/PŒ.h
>

10 
	~<fwk/Ty³s.h
>

11 
	~<fwk/SŒšg.h
>

13 
Çme¥aû
 
	gFwk
 {

15 
şass
 
	gRoÙNÙif›e
 : 
public
 
Fwk
::
PŒIÁ”çû
<
RoÙNÙif›e
> {

16 
public
:

17 
Fwk
::
	tPŒ
<
	tRoÙNÙif›e
 cÚ¡> 
	tPŒCÚ¡
;

18 
	gFwk
::
	tPŒ
<
	tRoÙNÙif›e
> Ptr;

20 
	eA‰ribu‹Id
 {

21 
	gnuÎNÙifiÿtiÚ_
 = 0,

22 
	gmuÉËA‰ribu‹s__
 = -1,

23 
	gš™ŸlNÙifiÿtiÚ__
 = -2,

24 
	gthis__
 = 1,

26 
	gnÙifiÿtiÚExû±iÚ__
 = 8,

27 
	gnÙifiÿtiÚA‰ribu‹__
 = 9,

28 
	gd–‘eRef__
 = 10,

29 
	g»ã»nûs__
 = 11,

30 
	gaud™E¼Üs__
 = 12,

32 
	gÇme__
 = 2,

33 
	gv”siÚ__
 = 3,

34 
	gşÚe__
 = 4,

35 
	g’t™yRef__
 = 5,

36 
	g©Œibu‹__
 = 6,

37 
	g·»Á__
 = 16,

38 
	gsyncMode__
 = 17,

39 
	gÜphª__
 = 20,

40 
	g’t™yId__
 = 22,

41 
	gşÚeS‹__
 = 23,

43 
	gÃxtA‰ribu‹Numb”__
,

44 
	gcNextA‰ribu‹Id__
 = 
ÃxtA‰ribu‹Numb”__
,

45 
	gÃg©iveA‰r__
 = 0x80000000,

47 
A‰ribu‹Id
 
nÙifiÿtiÚA‰ribu‹
() const {

48  
	gnÙifiÿtiÚA‰ribu‹_
;

50 
SŒšg
 
©Œibu‹SŒšg
Ğ
A‰ribu‹Id
 );

51 
RoÙNÙif›e
 cÚ¡ * 
lqNext
(ècÚ¡ {  
	glqNext_
.
±r
(); }

52 
vœtu®
 
SŒšg
 
Çme
() const;

55 
RoÙNÙif›e
 * 
fwkV®ue
(è{  
	gthis
; }

56 
nÙifiÿtiÚA‰ribu‹
(
A‰ribu‹Id
 
_nÙifiÿtiÚA‰ribu‹
 ) {

57 
	gnÙifiÿtiÚA‰ribu‹_
 = 
_nÙifiÿtiÚA‰ribu‹
;

59 
A‰ribu‹Id
 
cKeyFÜNÙifiÿtiÚExû±iÚ
() const {

60  
	gcKeyFÜNÙifiÿtiÚExû±iÚ_
;

62 
cKeyFÜNÙifiÿtiÚExû±iÚIs
Ğ
A‰ribu‹Id
 
aid
 ){

63 
	gcKeyFÜNÙifiÿtiÚExû±iÚ_
 = 
aid
;

65 
U8
 
cNÙifiÿtiÚExû±iÚChªges
() const {

66  
	gcNÙifiÿtiÚExû±iÚChªges_
;

68 
cNÙifiÿtiÚExû±iÚChªgesIs
Ğ
U8
 
Šec
 ) {

69 
	gcNÙifiÿtiÚExû±iÚChªges_
 = 
Šec
;

71 
RoÙNÙif›e
 * 
lqNext
(è{  
	glqNext_
.
±r
(); }

72 
lqNextIs
Ğ
RoÙNÙif›e
* 
_lqNext
 ) { 
	glqNext_
 = _lqNext; }

75 
vœtu®
 
isNÚReã»ncšgIs
Ğ
boŞ
 
b
 );

78 
RoÙNÙif›e
(): 
nÙifiÿtiÚA‰ribu‹_
(

79 
A‰ribu‹Id
(
nuÎNÙifiÿtiÚ_
)) {}

80 
vœtu®
 
hªdËNÙifiÿtiÚ
Ğ
Aùiv™y
 * );

81 
vœtu®
 
hªdËDeçuÉ
Ğ
Aùiv™y
 *, 
A‰ribu‹Id
, 
boŞ
 );

82 
vœtu®
 
ÚA‰ribu‹
Ğ
A‰ribu‹Id
 );

85 
vœtu®
 
ÚNÙifiÿtiÚExû±iÚ
();

86 
vœtu®
 
ÚNÙifiÿtiÚExû±iÚ
Ğ
A‰ribu‹Id
 );

87 
vœtu®
 
hªdËNÙifiÿtiÚExû±iÚ
Ğ
A‰ribu‹Id
 
aid
 );

88 
vœtu®
 
hªdËNÙifiÿtiÚExû±iÚ
();

89 
vœtu®
 
ÚD–‘e
();

90 
vœtu®
 
ÚNÙifiÿtiÚ
();

91 
vœtu®
 
ÚCŞËùiÚNÙifiÿtiÚ
Ğ
SŒšg
 );

92 
vœtu®
 
U32
 
aud™E¼Üs
( U32 ) const;

93 
	g´Ùeùed
:

94 
A‰ribu‹Id
 
nÙifiÿtiÚA‰ribu‹_
;

95 
PŒ
 
	glqNext_
;

96 
A‰ribu‹Id
 
	gcKeyFÜNÙifiÿtiÚExû±iÚ_
;

97 
U8
 
	gcNÙifiÿtiÚExû±iÚChªges_
;

	@fwk/Exception.cpp

3 
	~<fwk/Exû±iÚ.h
>

4 
	~<as£¹.h
>

5 
	~<io¡»am
>

6 
	~<sigÇl.h
>

8 
	gFwk
::
Exû±iÚ
::
Id
 
Fwk
::Exû±iÚ::
	$IdIn¡ªû
Ğ
U32
 
v
 ) {

9  
v
 ) {

10 
noExû±iÚ_
 : ‚oException_;

11 
unknownExû±iÚ_
 :  unknownException_;

12 
unknownTy³Exû±iÚ_
 :  unknownTypeException_;

13 
unknownA‰rExû±iÚ_
 :  unknownAttrException_;

14 
unknownD–im™”Exû±iÚ_
 :  unknownDelimiterException_;

15 
unknownArgExû±iÚ_
 :  unknownArgException_;

16 
š‹º®Exû±iÚ_
 :  internalException_;

17 
¿ngeExû±iÚ_
 : „angeException_;

18 
memÜyExû±iÚ_
 :  memoryException_;

19 
¡ÜageExû±iÚ_
 :  storageException_;

20 
timeoutExû±iÚ_
 : imeoutException_;

21 
ÇmeInU£Exû±iÚ_
 : ‚ameInUseException_;

22 
Ëg®NameExû±iÚ_
 :  illegalNameException_;

23 
³rmissiÚExû±iÚ_
 : …ermissionException_;

24 
noIm¶em’tiÚExû±iÚ_
 : ‚oImplementationException_;

25 
½cExû±iÚ_
 : „pcException_;

26 
½cCÚÃùiÚExû±iÚ_
 : „pcConnectionException_;

27 
’t™yNÙFoundExû±iÚ_
 : ƒntityNotFoundException_;

28 
’t™yNÙDœExû±iÚ_
 : ƒntityNotDirException_;

29 
aud™Exû±iÚ_
 : ‡uditException_;

30 
unknownEÁ™yIdExû±iÚ_
 :  unknownEntityIdException_;

31 
’t™yIdInU£Exû±iÚ_
 : ƒntityIdInUseException_;

32 
’t™yLogMsgL’Exû±iÚ_
 : ƒntityLogMsgLenException_;

33 
’t™yLogWr™eToCÚ¡Exû±iÚ_
 : ƒntityLogWriteToConstException_;

34 
”ºoExû±iÚ_
 : ƒrrnoException_;

35 
memÜyLim™ExûededExû±iÚ_
 :  memoryLimitExceededException_;

36 
noP¬’tExû±iÚ_
 : ‚oParentException_;

37  : 
throw
 
Fwk
::
	`RªgeExû±iÚ
( "Fwk::Exception::Id" );

39 
	}
}

41 
	gFwk
::
Exû±iÚ
::~
	$Exû±iÚ
() {

42 
	}
}

45 
Fwk
::
Exû±iÚ
::
Id


46 
Fwk
::
Exû±iÚ
::
	$id
() {

47  
unknownExû±iÚ_
;

48 
	}
}

50 
	gFwk
::
Exû±iÚ
::
Id


51 
Fwk
::
UnknownTy³Exû±iÚ
::
	$id
() {

52  
unknownTy³Exû±iÚ_
;

53 
	}
}

55 
	gFwk
::
Exû±iÚ
::
Id


56 
Fwk
::
UnknownA‰rExû±iÚ
::
	$id
() {

57  
unknownA‰rExû±iÚ_
;

58 
	}
}

60 
	gFwk
::
Exû±iÚ
::
Id


61 
Fwk
::
UnknownD–im™”Exû±iÚ
::
	$id
() {

62  
unknownD–im™”Exû±iÚ_
;

63 
	}
}

65 
	gFwk
::
Exû±iÚ
::
Id


66 
Fwk
::
UnknownArgExû±iÚ
::
	$id
() {

67  
unknownArgExû±iÚ_
;

68 
	}
}

70 
	gFwk
::
Exû±iÚ
::
Id


71 
Fwk
::
IÁ”ÇlExû±iÚ
::
	$id
() {

72  
š‹º®Exû±iÚ_
;

73 
	}
}

75 
	gFwk
::
Exû±iÚ
::
Id


76 
Fwk
::
RªgeExû±iÚ
::
	$id
() {

77  
¿ngeExû±iÚ_
;

78 
	}
}

80 
	gFwk
::
Exû±iÚ
::
Id


81 
Fwk
::
MemÜyExû±iÚ
::
	$id
() {

82  
memÜyExû±iÚ_
;

83 
	}
}

85 
	gFwk
::
Exû±iÚ
::
Id


86 
Fwk
::
StÜageExû±iÚ
::
	$id
() {

87  
¡ÜageExû±iÚ_
;

88 
	}
}

90 
	gFwk
::
Exû±iÚ
::
Id


91 
Fwk
::
TimeoutExû±iÚ
::
	$id
() {

92  
timeoutExû±iÚ_
;

93 
	}
}

95 
	gFwk
::
Exû±iÚ
::
Id


96 
Fwk
::
NameInU£Exû±iÚ
::
	$id
() {

97  
ÇmeInU£Exû±iÚ_
;

98 
	}
}

100 
	gFwk
::
Exû±iÚ
::
Id


101 
Fwk
::
IÎeg®NameExû±iÚ
::
	$id
() {

102  
Ëg®NameExû±iÚ_
;

103 
	}
}

105 
	gFwk
::
Exû±iÚ
::
Id


106 
Fwk
::
P”missiÚExû±iÚ
::
	$id
() {

107  
³rmissiÚExû±iÚ_
;

108 
	}
}

110 
	gFwk
::
Exû±iÚ
::
Id


111 
Fwk
::
NoIm¶em’tiÚExû±iÚ
::
	$id
() {

112  
noIm¶em’tiÚExû±iÚ_
;

113 
	}
}

115 
	gFwk
::
Exû±iÚ
::
Id


116 
Fwk
::
RpcExû±iÚ
::
	$id
() {

117  
½cExû±iÚ_
;

118 
	}
}

120 
	gFwk
::
Exû±iÚ
::
Id


121 
Fwk
::
RpcCÚÃùiÚExû±iÚ
::
	$id
() {

122  
½cCÚÃùiÚExû±iÚ_
;

123 
	}
}

125 
	gFwk
::
Exû±iÚ
::
Id


126 
Fwk
::
EÁ™yNÙFoundExû±iÚ
::
	$id
() {

127  
’t™yNÙFoundExû±iÚ_
;

128 
	}
}

130 
	gFwk
::
Exû±iÚ
::
Id


131 
Fwk
::
EÁ™yNÙDœExû±iÚ
::
	$id
() {

132  
’t™yNÙDœExû±iÚ_
;

133 
	}
}

135 
	gFwk
::
Exû±iÚ
::
Id


136 
Fwk
::
Aud™Exû±iÚ
::
	$id
() {

137  
aud™Exû±iÚ_
;

138 
	}
}

140 
	gFwk
::
Exû±iÚ
::
Id


141 
Fwk
::
UnknownEÁ™yIdExû±iÚ
::
	$id
() {

142  
unknownEÁ™yIdExû±iÚ_
;

143 
	}
}

145 
	gFwk
::
Exû±iÚ
::
Id


146 
Fwk
::
EÁ™yIdInU£Exû±iÚ
::
	$id
() {

147  
’t™yIdInU£Exû±iÚ_
;

148 
	}
}

150 
	gFwk
::
Exû±iÚ
::
Id


151 
Fwk
::
EÁ™yLogMsgL’Exû±iÚ
::
	$id
() {

152  
’t™yLogMsgL’Exû±iÚ_
;

153 
	}
}

155 
	gFwk
::
Exû±iÚ
::
Id


156 
Fwk
::
EÁ™yLogWr™eToCÚ¡Exû±iÚ
::
	$id
() {

157  
’t™yLogWr™eToCÚ¡Exû±iÚ_
;

158 
	}
}

160 
	gFwk
::
Exû±iÚ
::
Id


161 
Fwk
::
E¼noExû±iÚ
::
	$id
() {

162  
”ºoExû±iÚ_
;

163 
	}
}

165 
	gFwk
::
Exû±iÚ
::
Id


166 
Fwk
::
Li¡Exû±iÚ
::
	$id
() {

167  
li¡Exû±iÚ_
;

168 
	}
}

170 
	gFwk
::
Exû±iÚ
::
Id


171 
Fwk
::
MemÜyLim™ExûededExû±iÚ
::
	$id
() {

172  
memÜyLim™ExûededExû±iÚ_
;

173 
	}
}

	@fwk/Exception.h

4 #iâdeà
FWK_EXCEPTION_H


5 
	#FWK_EXCEPTION_H


	)

7 
	~<c¡ršg
>

8 
	~<fwk/SŒšg.h
>

9 
	~<fwk/PŒ.h
>

10 
	~<fwk/PŒIÁ”çû.h
>

12 
Çme¥aû
 
	gFwk
 {

14 şas 
	cExû±iÚ
 {

15 
	gpublic
:

17 
	eId
 {

18 
noExû±iÚ_
 = 0,

19 
	gunknownExû±iÚ_
 = 1,

20 
	gunknownTy³Exû±iÚ_
 = 2,

21 
	gunknownA‰rExû±iÚ_
 = 3,

22 
	gunknownD–im™”Exû±iÚ_
 = 4,

23 
	gunknownArgExû±iÚ_
 = 5,

24 
	gš‹º®Exû±iÚ_
 = 6,

25 
	g¿ngeExû±iÚ_
 = 7,

26 
	gmemÜyExû±iÚ_
 = 8,

27 
	g¡ÜageExû±iÚ_
 = 9,

28 
	gtimeoutExû±iÚ_
 = 10,

29 
	gÇmeInU£Exû±iÚ_
 = 11,

30 
	gËg®NameExû±iÚ_
 = 12,

31 
	g³rmissiÚExû±iÚ_
 = 13,

32 
	gnoIm¶em’tiÚExû±iÚ_
 = 14,

33 
	g½cExû±iÚ_
 = 15,

34 
	g½cCÚÃùiÚExû±iÚ_
 = 16,

35 
	g’t™yNÙFoundExû±iÚ_
 = 17,

36 
	g’t™yNÙDœExû±iÚ_
 = 18,

37 
	gaud™Exû±iÚ_
 = 19,

38 
	gunknownEÁ™yIdExû±iÚ_
 = 20,

39 
	g’t™yIdInU£Exû±iÚ_
 = 21,

40 
	g’t™yLogMsgL’Exû±iÚ_
 = 22,

41 
	g’t™yLogWr™eToCÚ¡Exû±iÚ_
 = 23,

42 
	g”ºoExû±iÚ_
 = 24,

43 
	gli¡Exû±iÚ_
 = 25,

44 
	gmemÜyLim™ExûededExû±iÚ_
 = 26,

45 
	gnoP¬’tExû±iÚ_
 = 27,

48 
Id
 
IdIn¡ªû
Ğ
U32
 
v
 );

50 
SŒšg
 
wh©
(ècÚ¡ {  
	gwh©_
; }

51 
	gvœtu®
 ~
Exû±iÚ
();

54 
vœtu®
 
Id
 
id
();

55 
	g´Ùeùed
:

56 
Exû±iÚ
ĞcÚ¡ * 
¡r
 ) : 
wh©_
(str) {}

57 
Exû±iÚ
Ğ
SŒšg
 
¡r
 ) : 
wh©_
(str) {}

58 
´iv©e
:

59 
SŒšg
 
wh©_
;

62 
	gO¡»am
 & 
	gİ”©Ü
<<ĞO¡»am &, 
Exû±iÚ
 const & );

64 şas 
	cUnknownTy³Exû±iÚ
 : 
public
 
Exû±iÚ
 {

65 
public
:

66 
UnknownTy³Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

67 
vœtu®
 
Id
 
id
();

70 şas 
	cUnknownA‰rExû±iÚ
 : 
public
 
Exû±iÚ
 {

71 
public
:

72 
UnknownA‰rExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

73 
vœtu®
 
Id
 
id
();

76 şas 
	cUnknownD–im™”Exû±iÚ
 : 
public
 
Exû±iÚ
 {

77 
public
:

78 
UnknownD–im™”Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

79 
vœtu®
 
Id
 
id
();

82 şas 
	cUnknownArgExû±iÚ
 : 
public
 
Exû±iÚ
 {

83 
public
:

84 
UnknownArgExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

85 
vœtu®
 
Id
 
id
();

88 şas 
	cIÁ”ÇlExû±iÚ
 : 
public
 
Exû±iÚ
 {

89 
public
:

90 
IÁ”ÇlExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

91 
vœtu®
 
Id
 
id
();

94 şas 
	cRªgeExû±iÚ
 : 
public
 
Exû±iÚ
 {

95 
public
:

96 
RªgeExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

97 
vœtu®
 
Id
 
id
();

100 şas 
	cMemÜyExû±iÚ
 : 
public
 
Exû±iÚ
 {

101 
public
:

102 
MemÜyExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

103 
vœtu®
 
Id
 
id
();

106 şas 
	cStÜageExû±iÚ
 : 
public
 
Exû±iÚ
 {

107 
public
:

108 
StÜageExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

109 
vœtu®
 
Id
 
id
();

112 şas 
	cTimeoutExû±iÚ
 : 
public
 
Exû±iÚ
 {

113 
public
:

114 
TimeoutExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
(what) {}

115 
vœtu®
 
Id
 
id
();

118 şas 
	cNameInU£Exû±iÚ
 : 
public
 
Exû±iÚ
 {

119 
public
:

120 
NameInU£Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

121 
vœtu®
 
Id
 
id
();

124 şas 
	cIÎeg®NameExû±iÚ
: 
public
 
Exû±iÚ
 {

125 
public
:

126 
IÎeg®NameExû±iÚ
Ğ
SŒšg
 
wh©
 ): 
Exû±iÚ
( what ) {}

127 
vœtu®
 
Id
 
id
();

130 şas 
	cP”missiÚExû±iÚ
 : 
public
 
Exû±iÚ
 {

131 
public
:

132 
P”missiÚExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

133 
vœtu®
 
Id
 
id
();

136 şas 
	cNoIm¶em’tiÚExû±iÚ
 : 
public
 
Exû±iÚ
 {

137 
public
:

138 
NoIm¶em’tiÚExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

139 
vœtu®
 
Id
 
id
();

142 şas 
	cA‰ribu‹NÙSuµÜ‹dExû±iÚ
 : 
public
 
NoIm¶em’tiÚExû±iÚ
 {

143 
public
:

144 
A‰ribu‹NÙSuµÜ‹dExû±iÚ
Ğ
SŒšg
 
wh©
 )

145 : 
NoIm¶em’tiÚExû±iÚ
Ğ
wh©
 ) {}

150 şas 
	cRpcExû±iÚ
 : 
public
 
Exû±iÚ
 {

151 
public
:

152 
RpcExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

153 
vœtu®
 
Id
 
id
();

156 şas 
	cRpcCÚÃùiÚExû±iÚ
 : 
public
 
RpcExû±iÚ
 {

157 
public
:

158 
RpcCÚÃùiÚExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
RpcExû±iÚ
( what ) {}

159 
vœtu®
 
Id
 
id
();

162 şas 
	cEÁ™yNÙFoundExû±iÚ
 : 
public
 
Exû±iÚ
 {

163 
public
:

164 
EÁ™yNÙFoundExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

165 
vœtu®
 
Id
 
id
();

168 şas 
	cEÁ™yNÙDœExû±iÚ
 : 
public
 
Exû±iÚ
 {

169 
public
:

170 
EÁ™yNÙDœExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

171 
vœtu®
 
Id
 
id
();

174 şas 
	cEÁ™yLogRecÜdExû±iÚ
 : 
public
 
Exû±iÚ
 {

175 
public
:

176 
EÁ™yLogRecÜdExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

180 şas 
	cEÁ™yLogEÁ™yExû±iÚ
 : 
public
 
Exû±iÚ
 {

181 
public
:

182 
EÁ™yLogEÁ™yExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

185 şas 
	cMouÁExû±iÚ
 : 
public
 
Exû±iÚ
 {

186 
public
:

187 
MouÁExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

190 şas 
	cAud™Exû±iÚ
 : 
public
 
IÁ”ÇlExû±iÚ
 {

191 
public
:

192 
Aud™Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
IÁ”ÇlExû±iÚ
(what) {}

193 
vœtu®
 
Id
 
id
();

196 şas 
	cUnknownEÁ™yIdExû±iÚ
 : 
public
 
IÁ”ÇlExû±iÚ
 {

197 
public
:

198 
UnknownEÁ™yIdExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
IÁ”ÇlExû±iÚ
(what) {}

199 
vœtu®
 
Id
 
id
();

202 şas 
	cEÁ™yIdInU£Exû±iÚ
 : 
public
 
IÁ”ÇlExû±iÚ
 {

203 
public
:

204 
EÁ™yIdInU£Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
IÁ”ÇlExû±iÚ
(what) {}

205 
vœtu®
 
Id
 
id
();

208 şas 
	cEÁ™yLogMsgL’Exû±iÚ
 : 
public
 
IÁ”ÇlExû±iÚ
 {

209 
public
:

210 
EÁ™yLogMsgL’Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
IÁ”ÇlExû±iÚ
(what) {}

211 
vœtu®
 
Id
 
id
();

214 şas 
	cEÁ™yLogWr™eToCÚ¡Exû±iÚ
 : 
public
 
IÁ”ÇlExû±iÚ
 {

215 
public
:

216 
EÁ™yLogWr™eToCÚ¡Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
IÁ”ÇlExû±iÚ
(what) {}

217 
vœtu®
 
Id
 
id
();

220 şas 
	cE¼noExû±iÚ
 : 
public
 
Exû±iÚ
 {

221 
public
:

222 
E¼noExû±iÚ
Ğ
”rÜ
, 
SŒšg
 
f’ame
 = "" )

223 : 
Exû±iÚ
Ğ
¡»¼Ü
Ğ
”rÜ
 ) ), 
”ºo_
Ğ”rÜ ), 
f’ame_
Ğ
f’ame
 ) {}

224 
”rÜ
(ècÚ¡ {  
	g”ºo_
; }

226 
SŒšg
 
f’ame
(ècÚ¡ {  
	gf’ame_
; }

227 
vœtu®
 
Id
 
id
();

228 
	g´iv©e
:

229 
”ºo_
;

230 
SŒšg
 
	gf’ame_
;

233 şas 
	cLi¡Exû±iÚ
 : 
public
 
RªgeExû±iÚ
 {

234 
public
:

235 
Li¡Exû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
RªgeExû±iÚ
(what) {}

236 
vœtu®
 
Id
 
id
();

239 şas 
	cMemÜyLim™ExûededExû±iÚ
 : 
public
 
MemÜyExû±iÚ
 {

240 
public
:

241 
MemÜyLim™ExûededExû±iÚ
(
SŒšg
 
wh©
è: 
MemÜyExû±iÚ
(what) {}

242 
vœtu®
 
Id
 
id
();

245 şas 
	cNoP¬’tExû±iÚ
 : 
public
 
Exû±iÚ
 {

246 
public
:

247 
NoP¬’tExû±iÚ
Ğ
SŒšg
 
wh©
 ) : 
Exû±iÚ
( what ) {}

	@fwk/HashMap.h

52 #iâdeà
FWK_HASHMAP_H


53 
	#FWK_HASHMAP_H


	)

55 
	~<¡dlib.h
>

56 
	~<fwk/Ba£CŞËùiÚ.h
>

57 
	~<fwk/SŒšg.h
>

59 
Çme¥aû
 
	gFwk
 {

74 
šlše
 
Æpo2
Ğ
x
 )

76 
	gx
 |ğ(
x
 >> 1);

77 
	gx
 |ğ(
x
 >> 2);

78 
	gx
 |ğ(
x
 >> 4);

79 
	gx
 |ğ(
x
 >> 8);

80 
	gx
 |ğ(
x
 >> 16);

81 (
	gx
+1);

85 
šlše
 
b™Rev”£
(
U32
 
x
)

87 
U32
 
	gy
 = 0x55555555;

88 
	gx
 = (((
x
 >> 1è& 
y
) | ((x & y) << 1));

89 
	gy
 = 0x33333333;

90 
	gx
 = (((
x
 >> 2è& 
y
) | ((x & y) << 2));

91 
	gy
 = 0x0f0f0f0f;

92 
	gx
 = (((
x
 >> 4è& 
y
) | ((x & y) << 4));

93 
	gy
 = 0x00ff00ff;

94 
	gx
 = (((
x
 >> 8è& 
y
) | ((x & y) << 8));

95 ((
	gx
 >> 16) | (x << 16));

98 
	g‹m¶©e
<
ty³Çme
 
	gKey
>

99 
šlše
 
U32
 
rhash
Ğ
Key
 cÚ¡ & 
k
 ) {

100  
b™Rev”£
Ğ
hash
Ğ
k
 ) );

103 
	g‹m¶©e
< 
ty³Çme
 
	gT
,y³Çm
	gKey
,y³Çm
	gP
 = 
T
,

104 
ty³Çme
 
	gVcÚ¡
 = 
P
,y³Çm
	gV
 = 
VcÚ¡
, 
	gbkts
 = 1,

105 
	gK
=4, 
U32
 (*
hash
)(
Key
 cÚ¡ &èğ
rhash
>

106 
şass
 
HashM­
 : 
public
 
Ba£RefCŞËùiÚ
<
T
> {

107 
public
:

108 
T
 
	tMemb”Ty³
;

109 
	gHashM­
<
	tT
,
	tKey
,
	tP
,
	tVcÚ¡
,
	tV
,
	tbkts
,
	tK
,
	thash
> 
	tS–f
;

110 
HashM­
Ğ
U32
 
_buck‘s
=
bkts
è: 
v”siÚ_
(1), 
memb”s_
(0) {

111 ifĞ
	g_buck‘s
 ) {

112 
	gbuck‘s_
 = (
_buck‘s
 =ğ1è? 1 : 
Æpo2
( _buckets - 1 );

113 
	gbuck‘_
 = (
PŒ
<
T
> *)

114 
Ãw
 
U8
[ 
buck‘s_
 * (
PŒ
<
T
>) ];

115 
mem£t
Ğ
buck‘_
, 0, 
buck‘s_
 * (
PŒ
<
T
>) );

118 
	gbuck‘s_
 = 0;

119 
	gbuck‘_
 = 0;

121 #ifdeà
HASHMAP_STATS


122 
	g»sizeUps_
 = 
»sizeDowns_
 = 0;

126 
U32
 
rshiá
(ècÚ¡ {  
__butš_şzl
Ğ
buck‘s_
 ) + 1; }

127 
U32
 
buck‘s
(ècÚ¡ {  
	gbuck‘s_
; }

128 
U32
 
buck‘
ĞU32 
hashV®
 ) const {

129 
U32
 
	grs
 = 
rshiá
();

130  (
	grs
 =ğ32è? 0 : 
hashV®
 >> 
rs
;

132 
U32
 
memb”s
(ècÚ¡ {  
	gmemb”s_
; }

133 
U32
 
v”siÚ
(ècÚ¡ {  
	gv”siÚ_
; }

134 
buck‘sIs
Ğ
U32
 
b
 ) {

138 
U32
 
	gbb
 = 
b
 ? 
Æpo2
( b - 1 ) : 1;

139 if(
	gbuck‘s_
 =ğ
bb
) {

142 
U32
 
	gobuck‘s
 = 
buck‘s_
;

143 
	gPŒ
<
	gT
> * 
	gobuck‘
 = 
buck‘_
;

144 
	gbuck‘s_
 = 
bb
;

145 
U8
 * 
	gmem
 = 
Ãw
 U8[ 
buck‘s_
 * (
PŒ
<
T
>) ];

146 
mem£t
Ğ
mem
, 0, 
buck‘s_
 * (
PŒ
<
T
>) );

147 
	gPŒ
<
	gT
> * 
	gnbuck‘
 = 
»š‹½»t_ÿ¡
<
PŒ
<
T
> *>Ğ
mem
 );

148 
	gbuck‘_
 = 
nbuck‘
;

149  
S32
 
	gi
=
obuck‘s
-1;i>=0;--i) {

155 
T
 * 
	gt
 = 
obuck‘
[
i
].
±r
();

158 
U32
 
	gb2
 = 0;

159 ifĞ
	gt
 ) {

160 
U32
 
	gb1
 = 
buck‘
(
hash
Ğ
t
->
fwkKey
() ) );

161  
	gt
 ) {

162 
T
 * 
	gt1
 = 
t
;

163 
T
 * 
	gt2
;

164  (
	gt2
 = 
t1
->
fwkHmNext
()) ) {

165 
b2
 = 
buck‘
(
hash
(
t2
->
fwkKey
()));

166 ifĞ
	gb1
 !ğ
b2
 ) ;

167 
	gt1
 = 
t2
;

169 
	gPŒ
<
	gT
> 
	gt2a
 = 
t2
;

170 
	gt1
->
fwkHmNextIs
Ğ
nbuck‘
[ 
b1
 ].
±r
() );

171 
	gnbuck‘
[
b1
] = 
t
;

172 
	gobuck‘
[
i
] = 
t2
;

173 
	gt
 = 
t2
;

174 
	gb1
 = 
b2
;

178 
	gd–‘e
 [] (
	gU8
*è
	gobuck‘
;

179 
	gv”siÚ_
++;

180 #ifdeà
HASHMAP_STATS


181 ifĞ
	gbuck‘s_
 > 
	gobuck‘s
 ) {

182 
	g»sizeUps_
++;

184 
	g»sizeDowns_
++;

186 ifĞ
	gçl£
 )

187 
	g¡d
::
û¼
 << "»sizšg " << ((
buck‘s_
 > 
obuck‘s
) ? "up" : "down")

188 << " from " << 
obuck‘s
 << "Ø" << 
buck‘s_
 << "‡ˆ" << 
memb”s_
 << 
¡d
::
’dl
;

192 
U32
 
aud™E¼Üs
( U32 ) const {

193 
U32
 
	g”rs
 = 0;

194 
U32
 
	gcouÁ
 = 0;

195 
T
 ** 
	gpbp
 = (T **è
buck‘_
 + 
buck‘s_
;

196 
U32
 
	ghsh
 = 0;

197 
U32
 
	ghashV®
 = 0;

198  
T
 ** 
	gcbp
 = (T **)
buck‘_
; cb°< 
	gpbp
; ++cbp, ++
	ghsh
 ) {

199 
T
* 
	gc
 = *
cbp
;

200  
	gc
 ) {

201 
U32
 
	gh
 = 
hash
Ğ
c
->
fwkKey
() );

202 ifĞ
	ghsh
 !ğ
buck‘
Ğ
h
 ) ) { ++
”rs
; }

203 ifĞ
	gh
 < 
	ghashV®
 ) { ++
	g”rs
; }

204 ifĞ++
	gcouÁ
 > 
	gmemb”s_
 ) ;

205 
	gc
 = 
c
->
fwkHmNext
();

206 
	ghashV®
 = 
h
;

209 ifĞ
	gcouÁ
 !ğ
memb”s_
 ) ++
”rs
;

210  
	g”rs
;

212 #ifdeà
HASHMAP_STATS


213 
U32
 
»sizeUps
() const {

214  
	g»sizeUps_
;

216 
U32
 
»sizeDowns
() const {

217  
	g»sizeDowns_
;

221 
U32
 
size
() const {  1; }

222 
T
 cÚ¡ * 
	gİ”©Ü
[]ĞcÚ¡ 
	gKey
& 
	gk
 ) const {

223 
U32
 
	gi
 = 
buck‘
Ğ
hash
Ğ
k
 ) );

224  
T
 * 
	gc
 = 
buck‘_
[
i
].
±r
(); c; c = 
c
->
fwkHmNext
() ) {

225 ifĞ
c
->
fwkKey
(è=ğ
k
 )  c;

229 
T
 cÚ¡ * 
memb”
ĞcÚ¡ 
Key
& 
k
 ) cÚ¡ {  
	gİ”©Ü
[](
	gk
); }

232 
T
 * 
	gİ”©Ü
[]ĞcÚ¡ 
	gKey
& 
	gk
 ) {

233 
U32
 
	gi
 = 
buck‘
Ğ
hash
Ğ
k
 ) );

234  
T
 * 
	gc
 = 
buck‘_
[
i
].
±r
(); c; c = 
c
->
fwkHmNext
() ) {

235 ifĞ
c
->
fwkKey
(è=ğ
k
 )  c;

239 
T
 * 
memb”
ĞcÚ¡ 
Key
& 
k
 ) {  
	gİ”©Ü
[](
	gk
); }

242 
boŞ
 
isMemb”
ĞcÚ¡ 
T
 * 
t
 ) const {

243 
U32
 
	gi
 = 
buck‘
Ğ
hash
Ğ
t
->
fwkKey
() ) );

244  
T
 * 
	gc
 = 
buck‘_
[
i
].
±r
(); c; c = 
c
->
fwkHmNext
() ) {

245 ifĞ
c
 =ğ
t
 )  
Œue
;

247  
	gçl£
;

251 
memb”Is
ĞcÚ¡ 
PŒ
<
T
>& 
t
 ) {

254 
ÃwMemb”
Ğ
t
, 
hash
Ğt->
fwkKey
() ) );

257 
ÃwMemb”
Ğ
T
 * 
t
 ) {

258 
ÃwMemb”
Ğ
t
, 
hash
Ğt->
fwkKey
() ) );

260 
memb”Is
ĞcÚ¡ 
T
 * 
t
 ) { memb”IsĞ
cÚ¡_ÿ¡
<T *>(t) ); }

261 
ÃwMemb”
ĞcÚ¡ 
T
 * 
t
 ) { 
memb”Is
Ğ
cÚ¡_ÿ¡
<T *>(t) ); }

262 
ÃwMemb”
ĞcÚ¡ 
PŒ
<
T
>& 
t
 ) {

263 
memb”Is
(
t
);

266 
d–‘eMemb”
ĞcÚ¡ 
PŒ
<
T
>& 
t
 ) {

267 
U32
 
	gi
 = 
buck‘
Ğ
hash
Ğ
t
->
fwkKey
() ));

268 
T
 * 
	g´ev
 = 0;

269  
T
 * 
	gc
 = 
buck‘_
[
i
].
±r
(); c; c = 
c
->
fwkHmNext
() ) {

270 ifĞ
c
 =ğ
t
.
±r
() ) {

271 ifĞ
´ev
 ) {

272 
´ev
->
fwkHmNextIs
Ğ
c
->
fwkHmNext
());

275 
	gbuck‘_
[
i
] = 
c
->
fwkHmNext
();

277 --
	gmemb”s_
;

278 ++
	gv”siÚ_
;

279 
	gc
->
fwkHmNextIs
( 0 );

282 
	g´ev
 = 
c
;

284 
maybeShršk
();

288 
	gPŒ
<
	gT
> 
memb”D–
Ğ
Key
 
k
 ) {

289 
U32
 
	gi
 = 
buck‘
Ğ
hash
Ğ
k
 ));

290 
T
 * 
	g´ev
 = 0;

291  
T
 * 
	gc
 = 
buck‘_
[
i
].
±r
(); c; c = 
c
->
fwkHmNext
() ) {

292 ifĞ
k
 =ğ
c
->
fwkKey
() ) {

293 
PŒ
<
T
> 
»t
 = 
c
;

294 ifĞ
	g´ev
 ) {

295 
	g´ev
->
fwkHmNextIs
Ğ
c
->
fwkHmNext
() );

298 
	gbuck‘_
[
i
] = 
c
->
fwkHmNext
();

300 --
	gmemb”s_
;

301 ++
	gv”siÚ_
;

302 
	gc
->
fwkHmNextIs
( 0 );

303 
maybeShršk
();

304  
	g»t
;

306 
	g´ev
 = 
c
;

310 
	gPŒ
<
	gT
> 
d–‘eMemb”
Ğ
Key
 
k
 ) {

311  
memb”D–
(
k
);

315 
memb”D–AÎ
() {

316 
em±yAÎBuck‘s
();

317 ifĞ
	gbuck‘s_
 !ğ1 ) 
buck‘sIs
( 1 );

318 ++
	gv”siÚ_
;

320 
boŞ
 
	gİ”©Ü
==Ğ
S–f
 cÚ¡ & 
v
 ) const {

321  
memb”s
(è=ğ
v
.members();

324 
boŞ
 
	gİ”©Ü
!=Ğ
S–f
 cÚ¡ & 
v
 ) const {

325  !(
v
=ğ
this
);

328 
d–‘eAÎ
() {

330 
memb”D–AÎ
();

332 
	g´Ùeùed
:

334 
T
 * 
fšdNext
ĞT cÚ¡ * 
t
, 
S32
 * 
n
 ) const {

336 
T
 ** 
	gpbp
 = (T **è(
buck‘_
 + 
buck‘s_
);

337 
T
 ** 
	gcbp
;

338 ifĞ
	gt
 ) {

339 
U32
 
	gh
 = 
hash
Ğ
t
->
fwkKey
() );

340 
U32
 
	gi
 = 
buck‘
Ğ
h
 );

341 
	gcbp
 = (
T
 **è&
buck‘_
[
i
];

342 ifĞ
T
 * 
	gt1
 = (*
cbp
) ) {

346 
U32
 
h1
 = 
hash
Ğ
t1
->
fwkKey
() );

347 if((
	gh
 < 
	gh1
è|| (h =ğ
h1
 && 
t
->
fwkKey
(è< 
t1
->fwkKey())) {

348 *
n
 = 
cbp
 - (
T
**)
buck‘_
;

349  
	gt1
;

351 
	gt1
 = 
t1
->
fwkHmNext
();

352 }  
	gt1
 );

355 ++
	gcbp
;

357 
	gcbp
 = (
T
 **è&
buck‘_
[0];

360 
T
 * 
	gbkt
 = 0;

361  (
	gcbp
 < 
	gpbp
è&& !(
	gbkt
 = *
cbp
) ) ++cbp;

362 *
	gn
 = 
cbp
 - (
T
**)
buck‘_
;

363  
	gbkt
;

366 
T
 * 
fšdNextBuck‘
Ğ
S32
 * 
bkt
 ) const {

367 
T
 ** 
	gbp
 = (T **è
buck‘_
;

368 
U32
 
	gi
=(*
bkt
)+1; i<
	gbuck‘s_
; ++i) {

369 ifĞ
	gbp
[
i
] ) {

370 *
	gbkt
 = 
i
;

371  
	gbp
[
i
];

374 *
	gbkt
 = -1;

378 
	gpublic
:

380 
şass
 
I‹¿tÜCÚ¡Ba£
 : 
public
 
Ba£I‹¿tÜCÚ¡
<
T
> {

381 
´Ùeùed
:

382 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

383 
I‹¿tÜCÚ¡Ba£
(è: 
Ba£I‹¿tÜCÚ¡
<
T
>( 0, 0 ) {

384 
v”siÚIs
( 0 );

385 
buck‘Is
( 0 );

386 
¦owInüsIs
( 0 );

388 
advªû
() {

389 
T
 cÚ¡ * 
	gc
 = 
_±r
();

390 
T
 cÚ¡ * 
	gÃwC
 = 
c
->
fwkHmNext
();

391 ifĞ
	gÃwC
 ) {

392 
±rIs
Ğ
ÃwC
 );

393 } ifĞ
v”siÚ
(è=ğ
hashM­
()->version() ) {

394 
±rIs
Ğ
hashM­
()->
fšdNextBuck‘
Ğ(
S32
*)&
d©a1_
 ) );

396 
S32
 
	gbkt
;

397 
±rIs
Ğ
hashM­
()->
fšdNext
Ğ
c
, &
bkt
 ) );

398 
buck‘Is
(
bkt
);

399 
v”siÚIs
Ğ
hashM­
()->
v”siÚ
() );

400 
¦owInüsIs
Ğ
¦owInüs
() + 1 );

403 
T
 cÚ¡ * 
_±r
(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
±r
(); }

404 
S–f
 cÚ¡ * 
hashM­
(ècÚ¡ {  
	g¡©ic_ÿ¡
<S–àcÚ¡ *>Ğ
	gcŞËùiÚ_
 ); }

405 
I‹¿tÜCÚ¡Ba£
Ğ
S–f
 cÚ¡ * 
hm
, 
T
 cÚ¡ * 
t
, 
S32
 
bkt
 = -1 ) :

406 
Ba£I‹¿tÜCÚ¡
<
T
>(
hm
, 
	gt
) {

407 
v”siÚIs
((
bkt
 >ğ0è? 
hm
->
v”siÚ
() : 0);

408 
buck‘Is
(
bkt
);

409 
¦owInüsIs
( 0 );

411 
usšg
 
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
d©a0_
;

412 
usšg
 
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
d©a1_
;

413 
buck‘Is
(
S32
 
b
è{ 
	gd©a1_
 = (
U32
)b; }

414 
v”siÚIs
(
U32
 
v
è{ 
	gd©a0_
 = v; }

415 
	gpublic
:

416 
S32
 
buck‘
(ècÚ¡ {  (S32)
d©a1_
; }

417 
U32
 
v”siÚ
(ècÚ¡{  
	gd©a0_
; }

418 #ifdeà
HASHMAP_STATS


419 
U32
 
¦owInüs
(ècÚ¡ {  
	g¦owInüs_
; }

420 
¦owInüsIs
Ğ
U32
 
c
 ) { 
	g¦owInüs_
 = c; }

421 
	g´iv©e
:

422 
U32
 
¦owInüs_
;

424 
¦owInüsIs
Ğ
U32
 
c
 ) {}

425 
U32
 
¦owInüs
() const {  0; }

430 şas 
	cI‹¿tÜCÚ¡
 : 
public
 
I‹¿tÜCÚ¡Ba£
 {

431 
public
:

432 
I‹¿tÜCÚ¡
() {}

433 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

434 
I‹¿tÜCÚ¡
 cÚ¡ & 
	gİ”©Ü
++() {

435 
	gI‹¿tÜCÚ¡Ba£
::
advªû
();

436  *
	gthis
;

438 
usšg
 
	gI‹¿tÜCÚ¡Ba£
::
_±r
;

439 
VcÚ¡
 
	gİ”©Ü
*(ècÚ¡ {  
_±r
()->
fwkV®ue
(); }

440 
P
 cÚ¡ * 
	gİ”©Ü
->(ècÚ¡ {  
_±r
()->
fwkPŒ
(); }

441 
P
 cÚ¡ * 
±r
(ècÚ¡ {  
_±r
()->
fwkPŒ
(); }

442 
Key
 
key
(ècÚ¡ {  
_±r
()->
fwkKey
(); }

443 
boŞ
 
m¬kedFÜD–‘iÚ
(ècÚ¡ {  
_±r
()->
cM¬kedFÜD–‘iÚ
(); }

445 
	g´Ùeùed
:

446 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

447 
I‹¿tÜCÚ¡
Ğ
S–f
 cÚ¡ * 
hm
, 
T
 cÚ¡ * 
t
, 
S32
 
bkt
=-1 ) : 
I‹¿tÜCÚ¡Ba£
( hm,, bkt ) {}

450 
I‹¿tÜCÚ¡
 
™”©Ü
() const {

451 
S32
 
	gbkt
;

452 
T
 * 
	gt
 = 
fšdNext
Ğ0, &
bkt
 );

453  
I‹¿tÜCÚ¡
Ğ
this
, 
t
, 
bkt
 );

455 
I‹¿tÜCÚ¡
 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) const {

456  
I‹¿tÜCÚ¡
Ğ
this
, 
¡¬t
.
±r
() );

460 
I‹¿tÜCÚ¡
 
™”©Ü
ĞcÚ¡ 
Key
 & 
k
 ) const {

462  
I‹¿tÜCÚ¡
Ğ
this
,
İ”©Ü
[](
k
));

466 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

467 şas 
	cD”I‹¿tÜCÚ¡
 : 
public
 
I‹¿tÜCÚ¡Ba£
 {

468 
public
:

469 
D”I‹¿tÜCÚ¡
() {}

470 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

471 
D”I‹¿tÜCÚ¡
 cÚ¡ & 
	gİ”©Ü
++() {

473 
	gI‹¿tÜCÚ¡Ba£
::
advªû
();

474 } 
±r
(è&& !
	gdyÇmic_ÿ¡
<
DT
 const *>(ptr()));

475  *
	gthis
;

477 
	gFwk
::
PŒ
<
DT
 cÚ¡> 
İ”©Ü
*(ècÚ¡ {  
_±r
(); }

478 
DT
 cÚ¡ * 
	gİ”©Ü
->(ècÚ¡ {  
_±r
()->
fwkPŒ
(); }

479 
DT
 cÚ¡ * 
±r
(ècÚ¡ {  
_±r
(); }

480 
Key
 
key
(ècÚ¡ {  
_±r
()->
fwkKey
(); }

481 
boŞ
 
m¬kedFÜD–‘iÚ
(ècÚ¡ {  
_±r
()->
cM¬kedFÜD–‘iÚ
(); }

483 
	g´Ùeùed
:

484 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

485 
DT
 cÚ¡ * 
_±r
(ècÚ¡ {  
	gdyÇmic_ÿ¡
<DT cÚ¡ *>(
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
±r
()); }

486 
S–f
 cÚ¡ * 
hashM­
(ècÚ¡ {  
	g¡©ic_ÿ¡
<S–àcÚ¡ *>(
	gcŞËùiÚ_
); }

487 
D”I‹¿tÜCÚ¡
Ğ
S–f
 cÚ¡ * 
hm
, 
DT
 cÚ¡ * 
t
, 
S32
 
bkt
=-1 ) :

488 
I‹¿tÜCÚ¡Ba£
Ğ
hm
, 
t
, 
bkt
 ) {

489 if(
	gt
&&!
	gdyÇmic_ÿ¡
<
DT
 const *>(t)) {

490 
	gİ”©Ü
++();

495 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

496 
	gD”I‹¿tÜCÚ¡
<
	gDT
> 
™”©Ü
() const {

497 
S32
 
	gbkt
;

498 
T
 cÚ¡ * 
	gt
 = 
fšdNext
(0, &
bkt
);

499 
DT
 cÚ¡ * 
	gdt
 = 
dyÇmic_ÿ¡
<DT cÚ¡ *>(
t
);

500  
	gD”I‹¿tÜCÚ¡
<
	gDT
>(
	gthis
,
	gdt
);

502 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

503 
	gD”I‹¿tÜCÚ¡
<
	gDT
> 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) const {

504  
	gD”I‹¿tÜCÚ¡
<
	gDT
>(
	gthis
,
	g¡¬t
.
±r
());

508 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

509 
	gD”I‹¿tÜCÚ¡
<
	gDT
> 
™”©Ü
ĞcÚ¡ 
Key
 & 
k
 ) const {

510 
DT
 cÚ¡ * 
	gdt
 = 
dyÇmic_ÿ¡
<DT cÚ¡ *>(
İ”©Ü
[](
k
));

511  
	gD”I‹¿tÜCÚ¡
<
	gDT
>(
	gthis
,
	gdt
);

518 şas 
	cDI‹¿tÜCÚ¡
 : 
public
 
I‹¿tÜCÚ¡Ba£
 {

519 
public
:

520 
DI‹¿tÜCÚ¡
() {}

521 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

522 
DI‹¿tÜCÚ¡
 cÚ¡ & 
	gİ”©Ü
++() {

523 
	gI‹¿tÜCÚ¡Ba£
::
advªû
();

524  *
	gthis
;

526 
usšg
 
	gI‹¿tÜCÚ¡Ba£
::
_±r
;

527 
T
 cÚ¡ * 
	gİ”©Ü
*(ècÚ¡ {  
_±r
(); }

528 
T
 cÚ¡ * 
	gİ”©Ü
->(ècÚ¡ {  
_±r
(); }

529 
T
 cÚ¡ * 
±r
(ècÚ¡ {  
_±r
(); }

530 
Key
 
key
(ècÚ¡ {  
_±r
()->
fwkKey
(); }

531 
boŞ
 
m¬kedFÜD–‘iÚ
(ècÚ¡ {  
_±r
()->
cM¬kedFÜD–‘iÚ
(); }

533 
	g´Ùeùed
:

534 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

536 
S–f
 cÚ¡ * 
hashM­
(ècÚ¡ {  
	g¡©ic_ÿ¡
<S–àcÚ¡ *>Ğ
	gcŞËùiÚ_
 ); }

537 
DI‹¿tÜCÚ¡
Ğ
S–f
 cÚ¡ * 
hm
, 
T
 cÚ¡ * 
t
, 
S32
 
bkt
=-1 ) : 
I‹¿tÜCÚ¡Ba£
( hm,, bkt ) {}

540 
DI‹¿tÜCÚ¡
 
dI‹¿tÜ
() const {

541 
S32
 
	gbkt
;

542 
T
 * 
	gt
 = 
fšdNext
Ğ0, &
bkt
 );

543  
DI‹¿tÜCÚ¡
(
this
,
t
,
bkt
);

545 
DI‹¿tÜCÚ¡
 
dI‹¿tÜ
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) const {

546  
DI‹¿tÜCÚ¡
(
this
,
¡¬t
.
±r
());

550 
DI‹¿tÜCÚ¡
 
dI‹¿tÜ
ĞcÚ¡ 
Key
 & 
k
 ) const {

551  
DI‹¿tÜCÚ¡
(
this
,
İ”©Ü
[](
k
));

555 şas 
	cI‹¿tÜ
 : 
public
 
I‹¿tÜCÚ¡
 {

556 
public
:

557 
I‹¿tÜ
() {}

558 
I‹¿tÜ
Ğ
S–f
 * 
hm
, 
T
 * 
t
 ) : 
I‹¿tÜCÚ¡
(hm,) {}

559 
usšg
 
	gI‹¿tÜCÚ¡
::
_±r
;

560 
P
 * 
±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gP
 * >Ğ
_±r
()->
fwkPŒ
() ); }

561 
P
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gP
 * >Ğ
_±r
()->
fwkPŒ
() ); }

562 
V
 
	gİ”©Ü
*(ècÚ¡ {  
_±r
()->
fwkV®ue
(); }

564 
	sI‹rD–‘”
 {

565 ~
I‹rD–‘”
() {}

566 
İ”©Ü
 
d–‘e
Ğ* 
thisPŒ
 ) {

567 
I‹¿tÜ
 * 
	gi
 = (I‹¿tÜ *è
thisPŒ
;

568 
	gi
->
d–‘ePŒ
();

571 
İ”©Ü
 
	gI‹rD–‘”
 * (è{  
_±r
(è? (I‹rD–‘”*è
	gthis
 : 0; }

577 
d–‘ePŒ
() {

578 
T
 * 
	gt
 = 
_±r
();

579 ++(*
	gthis
);

580 
hashM­
()->
d–‘eMemb”
Ğ
t
 );

582 
usšg
 
	gI‹¿tÜCÚ¡
::
m¬kedFÜD–‘iÚ
;

583 
m¬kedFÜD–‘iÚ
Ğ
boŞ
 
Ú
 ) {

584 
_±r
()->
cM¬kedFÜD–‘iÚIs
(
Ú
);

586 
	g´Ùeùed
:

587 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

588 
I‹¿tÜ
Ğ
S–f
 * 
hm
, 
T
 * 
t
, 
S32
 
bkt
 ) : 
I‹¿tÜCÚ¡
(hm,, bkt) {}

589 
S–f
 * 
hashM­
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gS–f
 *>Ğ
	gI‹¿tÜCÚ¡
::hashMap() ); }

590 
T
 * 
_±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gT
 * >Ğ
	gBa£I‹¿tÜCÚ¡
<T>::
±r
() ); }

593 
I‹¿tÜ
 
™”©Ü
() {

594 
S32
 
	gbkt
;

595 
T
 * 
	gt
 = 
fšdNext
Ğ0, &
bkt
 );

596  
I‹¿tÜ
Ğ
this
, 
t
, 
bkt
 );

598 
I‹¿tÜ
 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) {

599  
I‹¿tÜ
Ğ
this
, 
¡¬t
.
±r
() );

601 
I‹¿tÜ
 
™”©Ü
ĞcÚ¡ 
Key
 & 
k
 ) {

602  
I‹¿tÜ
Ğ
this
,
İ”©Ü
[](
k
));

606 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

607 
şass
 
	gD”I‹¿tÜ
 : 
public
 
D”I‹¿tÜCÚ¡
<
DT
> {

608 
public
:

609 
D”I‹¿tÜ
() {}

610 
D”I‹¿tÜ
Ğ
S–f
 * 
hm
, 
DT
 * 
t
 ) : 
D”I‹¿tÜCÚ¡
<DT>(hm,
	gt
) {}

611 
usšg
 
	gD”I‹¿tÜCÚ¡
<
	gDT
>::
_±r
;

613 
DT
 * 
±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gDT
 *>(
_±r
()); }

614 
DT
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gDT
 * >(
_±r
()->
fwkPŒ
()); }

615 
	gFwk
::
PŒ
<
DT
> 
İ”©Ü
*(è{  
_±r
(); }

617 
	sI‹rD–‘”
 {

618 ~
I‹rD–‘”
() {}

619 
İ”©Ü
 
d–‘e
Ğ* 
thisPŒ
 ) {

620 
D”I‹¿tÜ
 * 
	gi
 = (D”I‹¿tÜ *è
thisPŒ
;

621 
	gi
->
d–‘ePŒ
();

624 
İ”©Ü
 
	gI‹rD–‘”
 * (è{  
_±r
(è? (I‹rD–‘”*è
	gthis
 : 0; }

630 
d–‘ePŒ
() {

631 
DT
 * 
	gt
 = 
_±r
();

632 ++(*
	gthis
);

633 
hashM­
()->
d–‘eMemb”
Ğ
t
 );

635 
usšg
 
	gD”I‹¿tÜCÚ¡
<
	gDT
>::
m¬kedFÜD–‘iÚ
;

636 
m¬kedFÜD–‘iÚ
Ğ
boŞ
 
Ú
 ) {

637 
_±r
()->
cM¬kedFÜD–‘iÚIs
(
Ú
);

639 
	g´Ùeùed
:

640 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

641 
D”I‹¿tÜ
Ğ
S–f
 * 
hm
, 
DT
 * 
t
, 
S32
 
bkt
 ) : 
D”I‹¿tÜCÚ¡
<DT>(hm,
	gt
,
	gbkt
) {}

642 
S–f
 * 
hashM­
() const {

643  
	gcÚ¡_ÿ¡
<
	gS–f
 *>(
	gD”I‹¿tÜCÚ¡
<
	gDT
>::
hashM­
() );

645 
DT
 * 
_±r
(ècÚ¡ { 
	gcÚ¡_ÿ¡
<
	gDT
*>(
	gD”I‹¿tÜCÚ¡
<DT>::
±r
());}

648 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

649 
	gD”I‹¿tÜ
<
	gDT
> 
™”©Ü
() {

650 
S32
 
	gbkt
;

651 
T
 * 
	gt
 = 
fšdNext
(0, &
bkt
);

652 
DT
 * 
	gdt
 = 
dyÇmic_ÿ¡
<DT *>(
t
);

653  
	gD”I‹¿tÜ
<
	gDT
>(
	gthis
,
	gdt
,
	gbkt
);

655 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

656 
	gD”I‹¿tÜ
<
	gDT
> 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) {

657  
	gD”I‹¿tÜ
<
	gDT
>Ğ
	gthis
, 
	g¡¬t
.
±r
() );

659 
	g‹m¶©e
<
ty³Çme
 
	gDT
>

660 
	gD”I‹¿tÜ
<
	gDT
> 
™”©Ü
ĞcÚ¡ 
Key
 & 
k
 ) {

661 
DT
 * 
	gdt
 = 
dyÇmic_ÿ¡
<DT *>(
İ”©Ü
[](
k
));

662  
	gD”I‹¿tÜ
<
	gDT
>(
	gthis
,
	gdt
);

666 şas 
	cDI‹¿tÜ
 : 
public
 
DI‹¿tÜCÚ¡
 {

667 
public
:

668 
DI‹¿tÜ
() {}

669 
DI‹¿tÜ
Ğ
S–f
 * 
hm
, 
T
 * 
t
 ) : 
DI‹¿tÜCÚ¡
(hm,) {}

670 
usšg
 
	gDI‹¿tÜCÚ¡
::
_±r
;

671 
T
 * 
±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gT
 *>Ğ
_±r
()); }

672 
T
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gT
 *>Ğ
_±r
()); }

673 
T
 * 
	gİ”©Ü
*(ècÚ¡ {  
_±r
(); }

675 
	sI‹rD–‘”
 {

676 ~
I‹rD–‘”
() {}

677 
İ”©Ü
 
d–‘e
Ğ* 
thisPŒ
 ) {

678 
DI‹¿tÜ
 * 
	gi
 = (DI‹¿tÜ *è
thisPŒ
;

679 
	gi
->
d–‘ePŒ
();

682 
İ”©Ü
 
	gI‹rD–‘”
 * (è{  
_±r
(è? (I‹rD–‘”*è
	gthis
 : 0; }

688 
d–‘ePŒ
() {

689 
T
 * 
	gt
 = 
_±r
();

690 ++(*
	gthis
);

691 
hashM­
()->
d–‘eMemb”
Ğ
t
 );

693 
usšg
 
	gDI‹¿tÜCÚ¡
::
m¬kedFÜD–‘iÚ
;

694 
m¬kedFÜD–‘iÚ
Ğ
boŞ
 
Ú
 ) {

695 
_±r
()->
cM¬kedFÜD–‘iÚIs
(
Ú
);

697 
	g´Ùeùed
:

698 
ä›nd
 
şass
 
HashM­
<
T
,
	gKey
,
	gP
,
	gVcÚ¡
,
	gV
,
	gbkts
,
	gK
,
	ghash
>;

699 
DI‹¿tÜ
Ğ
S–f
 * 
hm
, 
T
 * 
t
, 
S32
 
bkt
 ) : 
DI‹¿tÜCÚ¡
(hm,, bkt) {}

700 
S–f
 * 
hashM­
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gS–f
 *>(
	gDI‹¿tÜCÚ¡
::hashMap() ); }

701 
T
 * 
_±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gT
 * >Ğ
	gBa£I‹¿tÜCÚ¡
<T>::
±r
() ); }

704 
DI‹¿tÜ
 
dI‹¿tÜ
() {

705 
S32
 
	gbkt
;

706 
T
 * 
	gt
 = 
fšdNext
(0, &
bkt
 );

707  
DI‹¿tÜ
(
this
,
t
,
bkt
);

709 
DI‹¿tÜ
 
dI‹¿tÜ
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) {

710  
DI‹¿tÜ
(
this
,
¡¬t
.
±r
());

712 
DI‹¿tÜ
 
dI‹¿tÜ
ĞcÚ¡ 
Key
 & 
k
 ) {

713  
DI‹¿tÜ
(
this
,
İ”©Ü
[](
k
));

716 
HashM­
ĞcÚ¡ 
S–f
 & 
hm
 ) {

717 
	gv”siÚ_
 = 
hm
.
v”siÚ_
;

718 
	gmemb”s_
 = 
hm
.
memb”s_
;

719 
	gbuck‘s_
 = 
hm
.
buck‘s_
;

720 
	gbuck‘_
 = (
PŒ
<
T
> *è
ÿÎoc
(
buck‘s_
, (Ptr<T>));

723 
T
 ** 
	gpbp
 = (T **è
hm
.
buck‘_
 + hm.
buck‘s_
;

724 
T
 ** 
	gÃwPbp
 = (T **è
buck‘_
 + 
hm
.
buck‘s_
;

725 
	gFwk
::
PŒ
<
T
> * 
ÃwCbp
 = 
buck‘_
;

726  
T
 ** 
	gcbp
 = (T **)
hm
.
buck‘_
; cb°< 
	gpbp
; ++cbp, ++
	gÃwCbp
 ) {

727 
T
 * 
	gc
 = *
cbp
;

728 
T
 * 
	gÃwP»v
 = 0;

729 ifĞ!
	gc
 ) { *
	gÃwCbp
 = 0; ; }

731 ifĞ
	gÃwP»v
 ) {

732 
	gÃwP»v
->
fwkHmNextIs
Ğ
Ãw
 
T
(*
c
) );

733 
	gÃwP»v
 = 
ÃwP»v
->
fwkHmNext
();

736 *
	gÃwCbp
 = 
ÃwP»v
 = 
Ãw
 
T
(*
c
);

738 
	gc
 = 
c
->
fwkHmNext
();

739 }  
	gc
 );

743 
HashM­
ĞcÚ¡ *, cÚ¡ * ) : 
v”siÚ_
(0), 
memb”s_
(0),

744 
buck‘s_
(
bkts
) {

747 ifĞ
	gbuck‘s_
) {

748 
	gbuck‘_
 = (
PŒ
<
T
> *è
Ãw
 
U8
[ 
buck‘s_
 * (Ptr<T>) ];

749 
mem£t
Ğ
buck‘_
, 0, 
buck‘s_
 * (
PŒ
<
T
>) );

751 
	gbuck‘_
 = 0;

753 
	gvœtu®
 ~
HashM­
() {

754 
em±yAÎBuck‘s
();

755 
U8
 * 
	gbuck‘MemÜy
 = (U8 *è
buck‘_
;

756 ifĞ
	gbuck‘MemÜy
 ) 
	gd–‘e
 [] bucketMemory;

759 
	g´iv©e
:

760 
maybeGrow
() {

763 ifĞ
memb”s_
 > (
K
 * 
buck‘s_
) ) {

764 ifĞ
K
 >= 2 ) {

765 
U32
 
z”o
 = 0;

766 
buck‘sIs
Ğ
memb”s_
 / ((
K
+
z”o
)/2));

768 
buck‘sIs
Ğ(
memb”s_
-1è* (2/
K
) );

772 
maybeShršk
() {

773 ifĞ
	gbuck‘s_
 <= 8 ) ;

774 ifĞ
	gmemb”s_
 * 4 < 
	gK
 * (
	gbuck‘s_
 + buckets_ / 2) ) {

775 
buck‘sIs
Ğ
memb”s_
 / 
K
 );

778 
ÃwMemb”
ĞcÚ¡ 
PŒ
<
T
>& 
t
, 
U32
 
hashV®
 ) {

779 
U32
 
	gi
 = 
buck‘
Ğ
hashV®
 );

780 
as£¹
Ğ
t
->
fwkHmNext
() == 0 );

781 
T
 * 
	g´ev
 = 0;

782 
T
 * 
	gt1
 = 
buck‘_
[
i
].
±r
();

783  
	gt1
 ) {

784 
U32
 
	gh1
 = 
hash
Ğ
t1
->
fwkKey
() );

785 ifĞ
	ghashV®
 < 
	gh1
 ) ;

786 ifĞ
	gh1
 =ğ
hashV®
 && 
t
->
fwkKey
(è< 
t1
->fwkKey()) ;

787 
	g´ev
 = 
t1
;

788 
	gt1
 = 
t1
->
fwkHmNext
();

792 
	gt
->
fwkHmNextIs
Ğ
t1
 );

793 ifĞ
	g´ev
 ) {

794 
	g´ev
->
fwkHmNextIs
Ğ
t
.
±r
() );

796 
	gbuck‘_
[
i
] = 
t
;

798 ++
	gmemb”s_
;

799 ++
	gv”siÚ_
;

800 
maybeGrow
();

805 
	gBa£CŞËùiÚ
::
	tSŒ•I‹¿tÜ
 StrepIterator;

806 
vœtu®
 
boŞ
 
™”©ÜMÜeLeá
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
bi
 ) const {

807 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ cÚ¡ *>Ğ&
bi
 );

808  *
	gtmp
;

810 
vœtu®
 
™”©ÜInü
Ğ
SŒ•I‹¿tÜ
& 
bi
 ) const {

811 
I‹¿tÜCÚ¡
 * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ *>Ğ&
bi
 );

812 ++(*
	gtmp
);

814 
vœtu®
 
SŒšg
 
™”©ÜSŒ•
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
bi
 ) const {

815 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ cÚ¡ *>Ğ&
bi
 );

816  
v®ueToSŒ•
Ğ
tmp
->
key
() );

818 
em±yAÎBuck‘s
() {

819 
	gPŒ
<
	gT
> * 
	gpbp
 = 
buck‘_
 + 
buck‘s_
;

820  
	gPŒ
<
	gT
> * 
	gcbp
 = 
buck‘_
; cb°< 
	gpbp
; ++cbp ) {

821 
	gPŒ
<
	gT
> 
	gc
 = *
cbp
;

822 *
	gcbp
 = 0;

823 ifĞ
	gc
 ) {

824  
	gPŒ
<
	gT
> 
	gÃxtC
 = 
c
->
fwkHmNext
(); 
	gc
; c = 
ÃxtC
 ) {

825 
ÃxtC
 = 
c
->
fwkHmNext
();

826 
	gc
->
fwkHmNextIs
( 0 );

830 
	gmemb”s_
 = 0;

833 
U32
 
	gv”siÚ_
;

834 
U32
 
	gmemb”s_
;

835 
U32
 
	gbuck‘s_
;

836 
	gPŒ
<
	gT
> *
	gbuck‘_
;

837 #ifdeà
HASHMAP_STATS


838 
U32
 
	g»sizeDowns_
;

839 
U32
 
	g»sizeUps_
;

	@fwk/LinkedList.h

28 #iâdeà
FWK_LINKEDLIST_H


29 
	#FWK_LINKEDLIST_H


	)

31 
	~<fwk/PŒ.h
>

32 
	~<fwk/Ba£CŞËùiÚ.h
>

33 
	~<fwk/Ty³s.h
>

35 
Çme¥aû
 
	gFwk
 {

37 
	g‹m¶©e
<
şass
 
	gT
>

38 
şass
 
	gLškedLi¡
 : 
public
 
Ba£RefCŞËùiÚ
<
T
> {

39 
public
:

40 
T
 
	tMemb”Ty³
;

41 
LškedLi¡
(è: 
v”siÚ_
(0),
memb”s_
(0),
h—d_
(0),
_
(0) {}

42 
LškedLi¡
ĞLškedLi¡<
T
> * 
Î
 ) : 
h—d_
Öl->
h—d
()) {}

44 
U32
 
v”siÚ
(ècÚ¡ {  
v”siÚ_
; }

45 
U32
 
memb”s
(ècÚ¡ {  
	gmemb”s_
; }

47 cÚ¡ 
T
 * 
h—d
(ècÚ¡ {  
	gh—d_
.
±r
(); }

48 
T
 * 
h—d
(è{  
	gh—d_
.
±r
(); }

49 
ÃwMemb”
Ğ
T
 * 
_ÃwMemb”
 ) {

50 ifĞ
	g_
 ) {

51 
	g_
->
ÎNextIs
(
_ÃwMemb”
);

53 
	gh—d_
 = 
_ÃwMemb”
;

54 
	g_ÃwMemb”
->
ÎNextIs
(0);

55 
	g_
 = 
_ÃwMemb”
;

56 ++
	gv”siÚ_
;

57 ++
	gmemb”s_
;

59 
ÃwMemb”
ĞcÚ¡ 
ty³Çme
 
T
::
PŒ
& 
_ÃwMemb”
 ) {

60 
ÃwMemb”
(
_ÃwMemb”
.
±r
() );

62 
T
 cÚ¡ * 
	gİ”©Ü
[]ĞT cÚ¡ * 
	gm
 ) const {

63  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
ÎNext
(èèifĞc==
m
 )  c;

66 
T
 cÚ¡ * 
memb”
ĞT cÚ¡ * 
m
 ) cÚ¡ {  
	gİ”©Ü
[](
	gm
); }

68 
T
 cÚ¡ * 
	gİ”©Ü
[]ĞcÚ¡ 
ty³Çme
 
	gT
::
PŒ
& 
m
 ) const {

69  
İ”©Ü
[](
m
.
±r
() );

71 
T
 cÚ¡ * 
memb”
ĞcÚ¡ 
ty³Çme
 T::
PŒ
& 
m
ècÚ¡ { 
İ”©Ü
[](m); }

73 
T
 * 
	gİ”©Ü
[]ĞT cÚ¡ * 
	gm
 ) {

74  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
ÎNext
(èèifĞc==
m
 )  c;

77 
T
 * 
memb”
ĞT cÚ¡ * 
m
 ) {  
	gİ”©Ü
[](
	gm
); }

79 
T
 * 
	gİ”©Ü
[]ĞcÚ¡ 
ty³Çme
 
	gT
::
PŒ
& 
m
 ) {

80  
İ”©Ü
[](
m
.
±r
() );

82 
T
 * 
memb”
ĞcÚ¡ 
ty³Çme
 T::
PŒ
& 
m
 ) {  
İ”©Ü
[](m); }

83 
	gPŒ
<
	gT
> 
h—dD–
() {

84 
	gPŒ
<
	gT
> 
	g±r
 = 
h—d_
.
±r
();

85 ifĞ
	g±r
 ) {

86 ifĞ
	g_
 =ğ
±r
 ) 
_
 = 0;

87 
	gh—d_
 = 
±r
->
ÎNext
();

88 
	g±r
->
ÎNextIs
( 0 );

89 ++
	gv”siÚ_
;

90 --
	gmemb”s_
;

92  
	g±r
;

94 
d–‘eH—d
() {

95 
h—dD–
();

97 
T
 * 
d–‘eMemb”
ĞT * 
memb”
 ) {

98 
T
 * 
	g´ev
 = 0;

99  
T
 * 
	gc
 = 
h—d_
.
±r
(); c; c = 
c
->
ÎNext
() ) {

100 ifĞ
c
 =ğ
memb”
 ) {

101 
PŒ
<
T
> 
§ve
 = 
memb”
;

103 ifĞ
	g´ev
 )…»v->
ÎNextIs
Ğ
c
->
ÎNext
() );

104 
	gh—d_
 = 
c
->
ÎNext
();

105 if(!
	g§ve
->
ÎNext
()è
	g_
 = 
´ev
;

106 
	gmemb”
->
ÎNextIs
( 0 );

107 ++
	gv”siÚ_
;

108 --
	gmemb”s_
;

109  
	gc
;

111 
	g´ev
 = 
c
;

115 
T
 * 
d–‘eMemb”
ĞcÚ¡ 
ty³Çme
 T::
PŒ
& 
_memb”
 ) {

116  
d–‘eMemb”
(
_memb”
.
±r
() );

118 
	g‹m¶©e
<
ty³Çme
 
	gTT
>

119 
şass
 
	gCÚ¡LlI‹¿tÜ
 : 
public
 
Ba£I‹¿tÜCÚ¡
<
TT
> {

120 
public
:

121 
CÚ¡LlI‹¿tÜ
& 
İ”©Ü
++() {

122 cÚ¡ 
TT
 * 
c
 = 
Ba£I‹¿tÜCÚ¡
<TT>::
±r
();

123 
±rIs
Ğ
c
->
ÎNext
() );

124  *
	gthis
;

126 cÚ¡ 
	gLškedLi¡
<
	gT
>* 
li¡
() const {

127  
	g¡©ic_ÿ¡
<cÚ¡ 
	gLškedLi¡
<
	gT
> *>(
	gthis
->
	gcŞËùiÚ_
);

129 cÚ¡ 
TT
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gTT
>::
±r
(); }

130 cÚ¡ 
TT
 * 
±r
(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gTT
>::ptr(); }

131 
	g´Ùeùed
:

132 
ä›nd
 
şass
 
LškedLi¡
<
T
>;

133 
CÚ¡LlI‹¿tÜ
ĞcÚ¡ 
LškedLi¡
<
T
>* 
Î
, cÚ¡ T * 
mem
 ) :

134 
Ba£I‹¿tÜCÚ¡
<
TT
>Ğ
Î
, 
	gmem
 ) {}

137 
	gCÚ¡LlI‹¿tÜ
<
	tT
> 
	tI‹¿tÜCÚ¡
;

139 
I‹¿tÜCÚ¡
 
™”©Ü
() const {

140  
I‹¿tÜCÚ¡
(
this
,
h—d_
.
±r
());

143 
	g‹m¶©e
<
ty³Çme
 
	gTT
>

144 
şass
 
	gLlI‹¿tÜ
 : 
public
 
CÚ¡LlI‹¿tÜ
<
TT
> {

145 
usšg
 
CÚ¡LlI‹¿tÜ
<
TT
>::
cŞËùiÚ_
;

146 
	gpublic
:

147 
usšg
 
CÚ¡LlI‹¿tÜ
<
TT
>::
±r
;

148 
TT
 * 
±r
(è{  
	gcÚ¡_ÿ¡
< 
	gTT
 * >Ğ
	gCÚ¡LlI‹¿tÜ
<TT>::ptr() ); }

150 cÚ¡ 
	gLlI‹¿tÜ
& 
	gİ”©Ü
++() {

151 ifĞ
TT
 * 
	gc
 = 
±r
() ) {

152 
´ev_
 = 
c
;

153 
±rIs
Ğ
c
->
ÎNext
() );

155  *
	gthis
;

157 
ÃwPŒ
Ğ
T
 * 
ÃwMemb”
 ) {

158 
TT
 * 
	gp
 = 
´ev_
.
±r
();

159 
li¡
()->
ÃwMemb”ThruI‹¿tÜ
Ğ
p
, 
ÃwMemb”
 );

160 ifĞ
	gp
 ) {

161 
	gÃwMemb”
->
ÎNextIs
Ğ
±r
() );

162 
	gp
->
ÎNextIs
Ğ
ÃwMemb”
 );

165 
	gÃwMemb”
->
ÎNextIs
Ğ
li¡
()->
h—d
() );

166 
li¡
()->
	gh—d_
 = 
ÃwMemb”
;

168 
±rIs
Ğ
ÃwMemb”
 );

169 ++
li¡
()->
	gv”siÚ_
;

170 ++
li¡
()->
	gmemb”s_
;

172 
d–‘ePŒ
() {

173 
TT
 * 
	gp
 = 
´ev_
.
±r
();

174 
	gPŒ
<
	gTT
> 
	gc
 = 
±r
();

175 
li¡
()->
d–‘eMemb”ThruI‹¿tÜ
Ğ
c
.
±r
() );

176 
TT
 * 
	gÃwC
 = 
c
->
ÎNext
();

177 ifĞ!
	gÃwC
 ) 
li¡
()->
	g_
 = 
p
;

178 ifĞ
	gp
 )…->
ÎNextIs
Ğ
ÃwC
 );

179 
li¡
()->
	gh—d_
 = 
ÃwC
;

180 
	gc
->
ÎNextIs
( 0 );

181 ++
li¡
()->
	gv”siÚ_
;

182 --
li¡
()->
	gmemb”s_
;

183 
±rIs
Ğ
ÃwC
 );

185 
ÃwMemb”
Ğ
T
 *‚ewMember ) {

186 
TT
 * 
	gc
 = 
±r
();

187 
li¡
()->
ÃwMemb”ThruI‹¿tÜ
Ğ
c
, 
ÃwMemb”
 );

188 ifĞ
	gc
 ) {

189 
	gÃwMemb”
->
ÎNextIs
Ğ
c
->
ÎNext
() );

190 
	gc
->
ÎNextIs
Ğ
ÃwMemb”
 );

191 
	g´ev_
 = 
c
;

194 
li¡
()->
ÃwMemb”
(‚ewMember );

196 
±rIs
Ğ
ÃwMemb”
 );

197 ++
li¡
()->
	gv”siÚ_
;

198 ++
li¡
()->
	gmemb”s_
;

200 
	gLškedLi¡
<
	gT
>* 
li¡
() {

201  
	g¡©ic_ÿ¡
<
	gLškedLi¡
<
	gT
> *>Ğ
	gcÚ¡_ÿ¡
< 
	gBa£CŞËùiÚ
 * >Ğ
	gcŞËùiÚ_
 ));

203 #ifdeà
CRUD


204 
	g‹m¶©e
 <
şass
 
	gOth”Ty³
>

205 
İ”©Ü
 
	gLlI‹¿tÜ
<
	gOth”Ty³
>() const {

206  
	gLlI‹¿tÜ
<
	gOth”Ty³
>Ğ
	gcŞËùiÚ_
, 
±r
() );

209 
TT
 * 
	gİ”©Ü
->() const {

210  
	gcÚ¡_ÿ¡
<
	gTT
*>Ğ
	gBa£I‹¿tÜCÚ¡
<TT>::
±r
() );

212 
	g´Ùeùed
:

213 
ä›nd
 
şass
 
LškedLi¡
<
T
>;

214 
LlI‹¿tÜ
Ğ
LškedLi¡
<
T
> * 
Î
, T * 
mem
 ) :

215 
CÚ¡LlI‹¿tÜ
<
TT
>(
Î
, 
	gmem
), 
´ev_
(0) {}

217 
	g´iv©e
:

218 
PŒ
<
TT
> 
´ev_
;

221 
	gLlI‹¿tÜ
<
	tT
> 
	tI‹¿tÜ
;

223 
I‹¿tÜ
 
™”©Ü
() {

224  
I‹¿tÜ
(
this
,
h—d_
.
±r
());

227 
d–‘eAÎ
() {

228 
	gPŒ
<
	gT
> 
	gc
 = 
h—d_
.
±r
();

229 
	gh—d_
 = 0;

230 ifĞ
	gc
 ) {

231  
	gPŒ
<
	gT
> 
	gÃxtC
 = 
c
->
ÎNext
();‚extC; 
	gc
 = 
ÃxtC
 ) {

232 
ÃxtC
 = 
c
->
ÎNext
();

233 
	gc
->
ÎNextIs
( 0 );

236 ++
	gv”siÚ_
;

237 
	gmemb”s_
 = 0;

239 
	gvœtu®
 ~
LškedLi¡
(è{ 
d–‘eAÎ
(); }

240 
U32
 
aud™E¼Üs
ĞU32 
scİe
 ) const {

241 
U32
 
	gcouÁ
 = 0;

242  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
ÎNext
(èè++
couÁ
;

243  
	gcouÁ
 !ğ
memb”s_
;

245 
	g´iv©e
:

246 
Ba£CŞËùiÚ
::
	tSŒ•I‹¿tÜ
 StrepIterator;

247 
vœtu®
 
boŞ
 
™”©ÜMÜeLeá
Ğ
SŒ•I‹¿tÜ
 cÚ¡& 
™”
 ) const {

248 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gi
=(I‹¿tÜCÚ¡ cÚ¡ *è&
™”
;

249  *
	gi
 ? 
	gŒue
 : 
çl£
;

251 
vœtu®
 
™”©ÜInü
Ğ
SŒ•I‹¿tÜ
& 
™”
 ) const {

252 
I‹¿tÜCÚ¡
 * 
	gi
 = (I‹¿tÜCÚ¡ *è&
™”
;

253 ++(*
	gi
);

255 
vœtu®
 
SŒšg
 
™”©ÜSŒ•
Ğ
SŒ•I‹¿tÜ
 cÚ¡& 
™”
 ) const {

256 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gi
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ cÚ¡ *>(&
™”
);

257  
v®ueToSŒ•
((*
i
).
±r
());

259 
U32
 
	gv”siÚ_
;

260 
U32
 
	gmemb”s_
;

261 
	gPŒ
<
	gT
> 
	gh—d_
;

262 
T
 * 
	g_
;

263 
vœtu®
 
ÃwMemb”ThruI‹¿tÜ
Ğ
T
 * 
´evMemb”
, T * 
ÃwMemb”
 ) {}

264 
vœtu®
 
d–‘eMemb”ThruI‹¿tÜ
Ğ
T
 * 
ÃwMemb”
 ) {}

	@fwk/LinkedQueue.h

31 #iâdeà
FWK_LINKEDQUEUE_H


32 
	#FWK_LINKEDQUEUE_H


	)

34 
	~<fwk/PŒ.h
>

35 
	~<fwk/Ba£CŞËùiÚ.h
>

37 
Çme¥aû
 
	gFwk
 {

39 
	g‹m¶©e
< 
ty³Çme
 
	gT
,y³Çm
	gP
 = 
T
,y³Çm
	gV
 = T * >

40 
şass
 
LškedQueue
 : 
public
 
Ba£RefCŞËùiÚ
<
T
> {

41 
public
:

42 
LškedQueue
< 
	tT
, 
	tP
, 
	tV
 > 
	tS–f
;

43 
LškedQueue
(è: 
v”siÚ_
(0), 
memb”s_
(0),
h—d_
(0), 
_
(0) {}

44 
U32
 
v”siÚ
(ècÚ¡ {  
	gv”siÚ_
; }

45 
U32
 
memb”s
(ècÚ¡ {  
	gmemb”s_
; }

46 
T
 * 
h—d
(ècÚ¡ {  
	gh—d_
.
±r
(); }

47 
T
 * 

(ècÚ¡ {  
	g_
; }

48 
ÃwH—d
ĞcÚ¡ 
ty³Çme
 
T
::
PŒ
& 
ÃwMemb”
 ) {

49 
ÃwH—d
Ğ
ÃwMemb”
.
±r
() );

51 
ÃwH—d
Ğ
T
 * 
ÃwMemb”
 ) {

52 ifĞ!
	gh—d_
 ) 
	g_
 = 
ÃwMemb”
;

53 
	gÃwMemb”
->
lqNextIs
Ğ
h—d_
.
±r
() );

54 
	gh—d_
 = 
ÃwMemb”
;

55 ++
	gv”siÚ_
;

56 ++
	gmemb”s_
;

58 
ÃwMemb”
Ğ
T
 * 
_ÃwMemb”
 ) {

59 ifĞ
	g_
 ) {

60 
	g_
->
lqNextIs
(
_ÃwMemb”
);

62 
	gh—d_
 = 
_ÃwMemb”
;

63 
	g_ÃwMemb”
->
lqNextIs
(0);

64 
	g_
 = 
_ÃwMemb”
;

65 ++
	gv”siÚ_
;

66 ++
	gmemb”s_
;

68 
ÃwMemb”
ĞcÚ¡ 
PŒ
<
T
>& 
_ÃwMemb”
 ) {

69 
ÃwMemb”
(
_ÃwMemb”
.
±r
());

71 
	gPŒ
<
	gT
> 
h—dD–
() {

72 
	gPŒ
<
	gT
> 
	g±r
 = 
h—d_
.
±r
();

73 ifĞ
	g±r
 ) {

74 ifĞ
	g_
 =ğ
±r
 ) 
_
 = 0;

75 
	gh—d_
 = 
±r
->
lqNext
();

76 
	g±r
->
lqNextIs
(0);

77 ++
	gv”siÚ_
;

78 --
	gmemb”s_
;

80  
	g±r
;

82 
d–‘eH—d
() {

83 
T
 * 
	g±r
 = 
h—d_
.
±r
();

84 ifĞ
	g±r
 ) {

85 ifĞ
	g_
 =ğ
±r
 ) 
_
 = 0;

86 
	gh—d_
 = 
±r
->
lqNext
();

87 
	g±r
->
lqNextIs
(0);

88 ++
	gv”siÚ_
;

89 --
	gmemb”s_
;

92 
T
 cÚ¡ * 
	gİ”©Ü
[]ĞT cÚ¡ * 
	gm
 ) const {

93  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
lqNext
(èèifĞc==
m
 )  c;

96 
T
 cÚ¡ * 
memb”
ĞT cÚ¡ * 
m
 ) cÚ¡ {  
	gİ”©Ü
[](
	gm
); }

97 
T
 * 
	gİ”©Ü
[]ĞT cÚ¡ * 
	gm
 ) {

98  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
lqNext
(èèifĞc==
m
 )  c;

101 
T
 cÚ¡ * 
	gİ”©Ü
[]ĞcÚ¡ 
ty³Çme
 
	gT
::
PŒ
& 
m
 ) const {

102  
İ”©Ü
[](
m
.
±r
());

104 
T
 * 
	gİ”©Ü
[]ĞcÚ¡ 
ty³Çme
 
	gT
::
PŒ
& 
m
 ) {  
İ”©Ü
[](m.
±r
()); }

106 
	gPŒ
<
	gT
> 
d–‘eMemb”
Ğ
T
 * 
memb”
 ) {

107 
T
 * 
	g´ev
 = 0;

108  
T
 * 
	gc
 = 
h—d_
.
±r
(); c; c = 
c
->
lqNext
() ) {

109 ifĞ
c
 =ğ
memb”
 ) {

110 ifĞ!
c
->
lqNext
(èè
_
 = 
´ev
;

111 ifĞ
	g´ev
 )…»v->
lqNextIs
Ğ
c
->
lqNext
() );

112 
	gh—d_
 = 
c
->
lqNext
();

113 
	gc
->
lqNextIs
( 0 );

114 ++
	gv”siÚ_
;

115 --
	gmemb”s_
;

116  
	gc
;

118 
	g´ev
 = 
c
;

120 
ÚD–‘eMemb”NÙFound
Ğ
memb”
 );

123 
	gPŒ
<
	gT
> 
d–‘eMemb”
ĞcÚ¡ 
ty³Çme
 
T
::
PŒ
& 
_memb”
 ) {

124  
d–‘eMemb”
(
_memb”
.
±r
() );

126 
vœtu®
 
ÚD–‘eMemb”NÙFound
Ğ
T
 * ) {}

129 
şass
 
	gI‹¿tÜCÚ¡
 : 
public
 
Ba£I‹¿tÜCÚ¡
<
T
> {

130 
public
:

131 
P
 cÚ¡ * 
±r
(ècÚ¡ {  
_±r
()->
fwkPŒ
(); }

132 
P
 cÚ¡ * 
	gİ”©Ü
->(ècÚ¡ {  
_±r
()->
fwkPŒ
(); }

133 
V
 
	gİ”©Ü
*() const {

134 
T
 * 
	gp
 = 
cÚ¡_ÿ¡
< T * >Ğ
_±r
() );

138  
	gp
->
fwkV®ue
();

140 
	gI‹¿tÜCÚ¡
& 
	gİ”©Ü
++() {

141 cÚ¡ 
T
 * 
	gc
 = 
_±r
();

142 
±rIs
Ğ
c
->
lqNext
() );

143  *
	gthis
;

145 
S–f
 * 
li¡
() const {

146  
	g¡©ic_ÿ¡
<
	gS–f
 *>(
	gcŞËùiÚ_
);

148 
T
 cÚ¡ * 
_±r
(ècÚ¡ {  
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
±r
(); }

151 
	g´Ùeùed
:

152 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

153 
ä›nd
 
şass
 
	gLškedQueue
< 
	gT
, 
	gP
, 
	gV
 >;

154 
I‹¿tÜCÚ¡
Ğ
S–f
 cÚ¡ * 
lq
, 
T
 * 
mem
 ) :

155 
Ba£I‹¿tÜCÚ¡
<
T
>Ğ
cÚ¡_ÿ¡
<
S–f
*>(
lq
), 
	gmem
 ) {}

156 
I‹¿tÜCÚ¡
Ğ
S–f
 * 
lq
, 
T
 * 
mem
 ) :

157 
Ba£I‹¿tÜCÚ¡
<
T
>(
lq
,
	gmem
) {}

160 
I‹¿tÜCÚ¡
 
™”©Ü
() const {

161  
I‹¿tÜCÚ¡
Ğ
this
, 
cÚ¡_ÿ¡
<
T
 *>(
h—d_
.
±r
()) );

164 
I‹¿tÜCÚ¡
 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) const {

165 
T
 * 
	gp
 = 
¡¬t
.
±r
();

166 
boŞ
 
	g£¬ch
 = 
çl£
;

167 ifĞ
	gp
 && (p!=
h—d_
è&& (
p
 !ğ
_
) ) {

168 
p
 = 
h—d_
.
±r
();

169 
	g£¬ch
 = 
Œue
;

171 
I‹¿tÜCÚ¡
 
ii
Ğ
this
, 
p
 );

172 ifĞ
	g£¬ch
 ) {

173 
	gp
 = 
¡¬t
.
±r
();

174  
	gii
 && i˜!ğ
p
 ) ++
ii
;

176  
	gii
;

179 şas 
	cI‹¿tÜ
 : 
public
 
I‹¿tÜCÚ¡
 {

180 
public
:

181 
usšg
 
I‹¿tÜCÚ¡
::
_±r
;

182 
P
 * 
±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gP
 * >Ğ
_±r
()->
fwkPŒ
() ); }

183 
P
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gcÚ¡_ÿ¡
< 
	gP
 * >Ğ
_±r
()->
fwkPŒ
() ); }

184 
V
 
	gİ”©Ü
*(ècÚ¡ {  
_±r
()->
fwkV®ue
(); }

186 
S–f
* 
li¡
() const {

187  
	gcÚ¡_ÿ¡
<
	gS–f
 *>(

188 
	g¡©ic_ÿ¡
<
S–f
 cÚ¡ *>Ğ
	gcŞËùiÚ_
 ));

190 
	gI‹¿tÜ
& 
	gİ”©Ü
++() {

191 
T
 * 
	gc
 = 
_±r
();

192 
	g´ev_
 = 
c
;

193 
±rIs
Ğ
c
->
lqNext
() );

194  *
	gthis
;

196 
ÃwPŒ
Ğ
T
 * 
ÃwMemb”
 ) {

197 
T
 * 
	gp
 = 
´ev_
.
±r
();

198 ifĞ
	gp
 ) {

199 
	gÃwMemb”
->
lqNextIs
Ğ
±r
() );

200 
	gp
->
lqNextIs
Ğ
ÃwMemb”
 );

203 
	gÃwMemb”
->
lqNextIs
Ğ
li¡
()->
h—d
() );

204 
li¡
()->
	gh—d_
 = 
ÃwMemb”
;

206 ifĞ
	gp
 =ğ
li¡
()->
_
 )†i¡()->_ = 
ÃwMemb”
;

207 
±rIs
Ğ
ÃwMemb”
 );

208 ++
li¡
()->
	gv”siÚ_
;

209 ++
li¡
()->
	gmemb”s_
;

211 
	sPoš‹rCÚv”siÚ
 {

212 
	gv®id
;

216 
İ”©Ü
 
	gPoš‹rCÚv”siÚ
::*() const {

217  
_±r
(è? &
Poš‹rCÚv”siÚ
::
v®id
 : 0;

220 
	sI‹rD–‘”
 {

221 ~
I‹rD–‘”
() {}

222 
İ”©Ü
 
d–‘e
Ğ* 
thisPŒ
 ) {

223 
I‹¿tÜ
 * 
	gi
 = (I‹¿tÜ *è
thisPŒ
;

224 
	gi
->
d–‘ePŒ
();

227 
İ”©Ü
 
	gI‹rD–‘”
 * (è{  
_±r
(è? (I‹rD–‘”*è
	gthis
 : 0; }

234 
d–‘ePŒ
() {

235 
T
 * 
	gp
 = 
´ev_
.
±r
();

236 
T
 * 
	gc
 = 
_±r
();

237 
T
 * 
	gÃwC
 = 
c
->
lqNext
();

238 ifĞ!
	gÃwC
 ) 
li¡
()->
	g_
 = 
p
;

239 ifĞ
	gp
 )…->
lqNextIs
Ğ
ÃwC
 );

240 
li¡
()->
	gh—d_
 = 
ÃwC
;

241 
±rIs
Ğ
ÃwC
 );

242 ++
li¡
()->
	gv”siÚ_
;

243 --
li¡
()->
	gmemb”s_
;

245 
ÃwMemb”
Ğ
T
 *‚ewMember ) {

246 
T
 * 
	gc
 = 
_±r
();

247 
	gÃwMemb”
->
lqNextIs
Ğ
c
->
lqNext
() );

248 
	gc
->
lqNextIs
Ğ
ÃwMemb”
 );

249 ifĞ!
	gÃwMemb”
->
lqNext
(èè
	g_
 = 
ÃwMemb”
;

250 ++
	gv”siÚ_
;

251 ++
	gmemb”s_
;

254 
T
 * 
_±r
(ècÚ¡ {  
	gcÚ¡_ÿ¡
<
	gT
 *>(
	gBa£I‹¿tÜCÚ¡
<T>::
±r
()); }

255 
	g´Ùeùed
:

256 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
cŞËùiÚ_
;

257 
	gPŒ
<
	gT
> 
	g´ev_
;

258 
ä›nd
 
şass
 
	gLškedQueue
< 
	gT
, 
	gP
, 
	gV
 >;

259 
I‹¿tÜ
ĞcÚ¡ 
S–f
* 
lq
, 
T
 * 
mem
 ) :

260 
I‹¿tÜCÚ¡
Ğ
lq
, 
mem
 ), 
´ev_
(0) {}

261 
I‹¿tÜ
Ğ
S–f
 * 
lq
, 
T
 * 
mem
 ) :

262 
I‹¿tÜCÚ¡
(
lq
,
mem
), 
´ev_
(0) {}

265 
I‹¿tÜ
 
™”©Ü
() {

266  
I‹¿tÜ
Ğ
this
, 
h—d_
.
±r
() );

269 
d–‘eAÎ
() {

270 
	gPŒ
<
	gT
> 
	gc
 = 
h—d_
.
±r
();

271 
	gh—d_
 = 0;

272 ifĞ
	gc
 ) {

273  
	gFwk
::
PŒ
<
T
> 
ÃxtC
 = 
c
->
lqNext
(); 
	gÃxtC
; 
	gc
 =‚extC ) {

274 
ÃxtC
 = 
c
->
lqNext
();

275 
	gc
->
lqNextIs
( 0 );

278 
	g_
 = 0;

279 ++
	gv”siÚ_
;

280 
	gmemb”s_
 = 0;

282 
	gvœtu®
 ~
LškedQueue
(è{ 
d–‘eAÎ
(); }

283 
U32
 
aud™E¼Üs
ĞU32 
scİe
 ) const {

284 
U32
 
	gcouÁ
 = 0;

285  
T
 * 
	gc
=
h—d_
.
±r
();c;c=
c
->
lqNext
(èè++
couÁ
;

286  
	gcouÁ
 !ğ
memb”s_
;

289 
	g´iv©e
:

290 
Ba£CŞËùiÚ
::
	tSŒ•I‹¿tÜ
 StrepIterator;

291 
vœtu®
 
boŞ
 
™”©ÜMÜeLeá
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
bi
 ) const {

292 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ cÚ¡ *>Ğ&
bi
 );

293  *
	gtmp
;

295 
vœtu®
 
™”©ÜInü
Ğ
SŒ•I‹¿tÜ
& 
bi
 ) const {

296 
I‹¿tÜCÚ¡
 * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ *>Ğ&
bi
 );

297 ++(*
	gtmp
);

300 
vœtu®
 
SŒšg
 
™”©ÜSŒ•
Ğ
SŒ•I‹¿tÜ
 cÚ¡ & 
bi
 ) const {

301 
I‹¿tÜCÚ¡
 cÚ¡ * 
	gtmp
 = 
¡©ic_ÿ¡
<I‹¿tÜCÚ¡ cÚ¡ *>Ğ&
bi
 );

302  
v®ueToSŒ•
Ğ**
tmp
 );

305 
	g´iv©e
:

306 
U32
 
v”siÚ_
;

307 
U32
 
	gmemb”s_
;

308 
	gPŒ
<
	gT
> 
	gh—d_
;

309 
T
 * 
	g_
;

	@fwk/ListRaw.h

32 #iâdeà
FWK_LISTRAW_H


33 
	#FWK_LISTRAW_H


	)

35 
	~<fwk/PŒ.h
>

37 
	~<fwk/Ba£CŞËùiÚ.h
>

38 
	~<fwk/Exû±iÚ.h
>

40 
Çme¥aû
 
	gFwk
 {

42 
	g‹m¶©e
<
şass
 
	gT
>

43 
şass
 
	gLi¡Raw
 : 
public
 
Ba£RefCŞËùiÚ
<
T
> {

44 
public
:

45 
Li¡Raw
(è: 
v”siÚ_
(0), 
memb”s_
(0), 
h—d_
(0), 
_
(0) {}

47 
U32
 
v”siÚ
(ècÚ¡ {  
	gv”siÚ_
; }

48 
U32
 
memb”s
(ècÚ¡ {  
	gmemb”s_
; }

50 
T
 * 
h—d
(ècÚ¡ {  
	gh—d_
; }

51 
ÃwH—d
ĞcÚ¡ 
ty³Çme
 
T
::
PŒ
& 
ÃwMemb”
 ) {

52 
ÃwH—d
Ğ
ÃwMemb”
.
±r
() );

54 
ÃwH—d
Ğ
T
 * 
ÃwMemb”
 ) {

55 ifĞ!
	gh—d_
 ) 
	g_
 = 
ÃwMemb”
;

56 
	gÃwMemb”
->
ÌNextIs
Ğ
h—d_
 );

57 
	gh—d_
 = 
ÃwMemb”
;

58 ++
	gv”siÚ_
;

59 ++
	gmemb”s_
;

61 
ÃwMemb”
ĞcÚ¡ 
ty³Çme
 
T
::
PŒ
&‚ewMember ) {

62 
ÃwMemb”
ĞÃwMemb”.
±r
() );

64 
ÃwMemb”
Ğ
T
 *‚ewMember ) {

65 
	gÃwMemb”
->
ÌNextIs
(0);

66 ifĞ
	g_
 ) {

67 
	g_
->
ÌNextIs
(
ÃwMemb”
);

69 
	gh—d_
 = 
ÃwMemb”
;

70 
	gÃwMemb”
->
ÌNextIs
( 0 );

71 
	g_
 = 
ÃwMemb”
;

72 ++
	gv”siÚ_
;

73 ++
	gmemb”s_
;

75 
T
 * 
h—dD–
() {

76 
T
 * 
	g±r
 = 
h—d_
;

77 ifĞ
	g±r
 ) {

78 ifĞ
	g_
 =ğ
±r
 ) 
_
 = 0;

79 
	gh—d_
 = 
±r
->
ÌNext
();

80 ++
	gv”siÚ_
;

81 --
	gmemb”s_
;

83  
	g±r
;

85 
d–‘eH—d
() {

86 
T
 * 
	g±r
 = 
h—d_
;

87 ifĞ
	g±r
 ) {

88 ifĞ
	g_
 =ğ
±r
 ) 
_
 = 0;

89 
	gh—d_
 = 
±r
->
ÌNext
();

90 ++
	gv”siÚ_
;

91 --
	gmemb”s_
;

94 
d–‘eMemb”
Ğ
T
 * 
memb”
 ) {

95 
T
 * 
	g´ev
 = 0;

96  
T
 * 
	gc
 = 
h—d_
; c; c = 
c
->
ÌNext
() ) {

97 ifĞ
c
 =ğ
memb”
 ) {

98 ifĞ!
c
->
ÌNext
(èè
_
 = 
´ev
;

99 ifĞ
	g´ev
 )…»v->
ÌNextIs
Ğ
c
->
ÌNext
() );

100 
	gh—d_
 = 
c
->
ÌNext
();

101 ++
	gv”siÚ_
;

102 --
	gmemb”s_
;

105 
	g´ev
 = 
c
;

109 
şass
 
	gLrI‹¿tÜCÚ¡
 : 
public
 
Ba£I‹¿tÜCÚ¡
<
T
> {

110 
public
:

111 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
±r
;

113 
	gLrI‹¿tÜCÚ¡
& 
	gİ”©Ü
++() {

114 cÚ¡ 
T
 * 
	gc
 = 
±r
();

115 
±rIs
Ğ
c
->
ÌNext
() );

116  *
	gthis
;

118 
	gLi¡Raw
<
	gT
> cÚ¡ * 
li¡Raw
() const {

119  
	g¡©ic_ÿ¡
<
	gLi¡Raw
<
	gT
> cÚ¡ *>(
	gcŞËùiÚ_
);

122 
	g´Ùeùed
:

123 
ä›nd
 
şass
 
Li¡Raw
<
T
>;

124 
usšg
 
	gBa£I‹¿tÜCÚ¡
<
	gT
>::
cŞËùiÚ_
;

125 
LrI‹¿tÜCÚ¡
ĞcÚ¡ 
Li¡Raw
<
T
> * 
Ì
, T * 
mem
 ) :

126 
Ba£I‹¿tÜCÚ¡
<
T
>Ğ
cÚ¡_ÿ¡
<
Li¡Raw
<T>*>(
Ì
), 
	gmem
 ) {}

127 
LrI‹¿tÜCÚ¡
Ğ
Li¡Raw
<
T
> * 
Ì
, T * 
mem
 ) :

128 
Ba£I‹¿tÜCÚ¡
<
T
>(
Ì
,
	gmem
) {}

131 
LrI‹¿tÜCÚ¡
 
	tI‹¿tÜCÚ¡
;

135 
I‹¿tÜCÚ¡
 
™”©Ü
() const {

136  
I‹¿tÜCÚ¡
Ğ
this
, 
cÚ¡_ÿ¡
<
T
 *>(
h—d_
) );

139 
I‹¿tÜCÚ¡
 
™”©Ü
ĞcÚ¡ 
PŒ
<
T
>& 
¡¬t
 ) const {

140 
T
 * 
	gp
 = 
¡¬t
.
±r
();

141 
boŞ
 
	g£¬ch
 = 
çl£
;

142 ifĞ
	gp
 && (p!=
h—d_
è&& (
p
 !ğ
_
) ) {

143 
p
 = 
h—d_
;

144 
	g£¬ch
 = 
Œue
;

146 
I‹¿tÜCÚ¡
 
ii
Ğ
this
, 
p
 );

147 ifĞ
	g£¬ch
 ) {

148 
	gp
 = 
¡¬t
.
±r
();

149  
	gii
 && i˜!ğ
p
 ) ++
ii
;

151  
	gii
;

154 şas 
	cLrI‹¿tÜ
 : 
public
 
LrI‹¿tÜCÚ¡
 {

155 
public
:

156 
usšg
 
Ba£I‹¿tÜCÚ¡
<
T
>::
±r
;

157 
usšg
 
	gLrI‹¿tÜCÚ¡
::
li¡Raw
;

158 
T
 * 
±r
(è{  
	gcÚ¡_ÿ¡
<
	gT
 *>(
	gBa£I‹¿tÜCÚ¡
<T>::ptr()); }

159 
T
 * 
	gİ”©Ü
->(è{  
	gcÚ¡_ÿ¡
<
	gT
 *>(
±r
()); }

160 
	gLi¡Raw
<
	gT
> * 
li¡Raw
() {

161  
	gcÚ¡_ÿ¡
<
	gLi¡Raw
<
	gT
> *>(
	gLrI‹¿tÜCÚ¡
::
li¡Raw
());

163 
	gLrI‹¿tÜ
& 
	gİ”©Ü
++() {

164 
T
 * 
	gc
 = 
±r
();

165 
	g´ev_
 = 
c
;

166 
±rIs
Ğ
c
->
ÌNext
() );

167  *
	gthis
;

169 
fixP»v
() {

173  (
li¡Raw
()->
	gv”siÚ_
 - version_) > 0 ) {

174 
	gv”siÚ_
 = 
li¡Raw
()->
v”siÚ_
;

175 
T
 * 
	g´ev
 = 0;

176 
T
 * 
	gp
 = 
li¡Raw
()->
h—d
();

177  
	gp
 ) {

178 ifĞ
	gp
 =ğ
±r
() ) {

179 
´ev_
 = 
´ev
;

180 
	gdÚe
;

182 
	g´ev
 = 
p
;

183 
	gp
 = 
p
->
ÌNext
();

186 
throw
 
Li¡Exû±iÚ
( "Iterator…ointingo‡nƒlement‚ot inhe†ist" );

187 
	gdÚe
: ;

195 
ÃwPŒ
Ğ
T
 * 
ÃwMemb”
 ) {

196 
fixP»v
();

200 
T
 * 
	gp
 = 
´ev_
.
±r
();

201 ifĞ
	gp
 ) {

202 
	gÃwMemb”
->
ÌNextIs
Ğ
±r
() );

203 
	gp
->
ÌNextIs
Ğ
ÃwMemb”
 );

206 
	gÃwMemb”
->
ÌNextIs
Ğ
li¡Raw
()->
h—d
() );

207 
li¡Raw
()->
	gh—d_
 = 
ÃwMemb”
;

209 ifĞ
	gp
 =ğ
li¡Raw
()->
_
 )†i¡Raw()->_ = 
ÃwMemb”
;

210 
±rIs
Ğ
ÃwMemb”
 );

211 ++
li¡Raw
()->
	gv”siÚ_
;

212 ++
li¡Raw
()->
	gmemb”s_
;

214 
	sI‹rD–‘”
 {

215 ~
I‹rD–‘”
() {}

216 
İ”©Ü
 
d–‘e
Ğ* 
thisPŒ
 ) {

217 
LrI‹¿tÜ
 * 
	gi
 = (LrI‹¿tÜ *è
thisPŒ
;

218 
	gi
->
d–‘ePŒ
();

221 
İ”©Ü
 
	gI‹rD–‘”
 * (è{  
±r
(è? (I‹rD–‘”*è
	gthis
 : 0; }

228 
d–‘ePŒ
() {

229 
	gŒy
 {

230 
fixP»v
();

231 } 
ÿtch
Ğ
Li¡Exû±iÚ
 ) {

234 
T
 * 
	gp
 = 
´ev_
.
±r
();

235 
T
 * 
	gc
 = 
±r
();

236 
T
 * 
	gÃwC
 = 
c
->
ÌNext
();

237 ifĞ!
	gÃwC
 ) 
li¡Raw
()->
	g_
 = 
p
;

238 
as£¹
Ğ(
p
?p->
ÌNext
():
li¡Raw
()->
h—d_
è=ğ
c
 );

239 ifĞ
	gp
 )…->
ÌNextIs
Ğ
ÃwC
 );

240 
li¡Raw
()->
	gh—d_
 = 
ÃwC
;

241 
±rIs
Ğ
ÃwC
 );

242 ++
li¡Raw
()->
	gv”siÚ_
;

243 --
li¡Raw
()->
	gmemb”s_
;

246 
ÃwMemb”
Ğ
T
 *‚ewMember ) {

247 
fixP»v
();

248 
T
 * 
	gc
 = 
±r
();

249 
	gÃwMemb”
->
ÌNextIs
Ğ
c
->
ÌNext
() );

250 
	gc
->
ÌNextIs
Ğ
ÃwMemb”
 );

251 ifĞ!
	gÃwMemb”
->
ÌNext
(èè
	g_
 = 
ÃwMemb”
;

252 ++
li¡Raw
()->
	gv”siÚ_
;

253 ++
li¡Raw
()->
	gmemb”s_
;

256 
	g´Ùeùed
:

257 
U32
 
v”siÚ_
;

258 
	gPŒ
<
	gT
> 
	g´ev_
;

259 
ä›nd
 
şass
 
	gLi¡Raw
<
	gT
>;

260 
LrI‹¿tÜ
ĞcÚ¡ 
Li¡Raw
<
T
>* 
li
, T * 
mem
 ) :

261 
LrI‹¿tÜCÚ¡
Ğ
li
, 
mem
 ), 
v”siÚ_
Ğli->
v”siÚ
(è), 
´ev_
(0) {}

265 
LrI‹¿tÜ
Ğ
Li¡Raw
<
T
> * 
li
, T * 
mem
 ) :

266 
LrI‹¿tÜCÚ¡
(
li
,
mem
), 
v”siÚ_
Ğli->
v”siÚ
(è), 
´ev_
(0) {}

268 
LrI‹¿tÜ
 
	tI‹¿tÜ
;

270 
I‹¿tÜ
 
™”©Ü
(è{  I‹¿tÜĞ
this
, 
h—d_
 ); }

272 
d–‘eAÎ
() {

273 
	gPŒ
<
	gT
> 
	gc
 = 
h—d_
;

274 
	gh—d_
 = 0;

275 ifĞ
	gc
 ) {

276  
	gFwk
::
PŒ
<
T
> 
ÃxtC
 = 
c
->
ÌNext
(); 
	gÃxtC
; 
	gc
 =‚extC ) {

277 
ÃxtC
 = 
c
->
ÌNext
();

278 
	gc
->
ÌNextIs
( 0 );

281 ++
	gv”siÚ_
;

282 
	gmemb”s_
 = 0;

284 
	gvœtu®
 ~
Li¡Raw
(è{ 
d–‘eAÎ
(); }

285 
U32
 
aud™E¼Üs
ĞU32 
scİe
 ) const {

286 
U32
 
	gcouÁ
 = 0;

287  
T
 * 
	gc
=
h—d_
;c;c=
c
->
ÌNext
(èè++
couÁ
;

288  
	gcouÁ
 !ğ
memb”s_
;

290 
	g´iv©e
:

291 
U32
 
v”siÚ_
;

292 
U32
 
	gmemb”s_
;

293 
T
 * 
	gh—d_
;

294 
T
 * 
	g_
;

	@fwk/NamedInterface.h

4 #iâdeà
FWK_NAMEDINTERFACE_H


5 
	#FWK_NAMEDINTERFACE_H


	)

7 
	~"PŒIÁ”çû.h
"

8 
	~"Ba£NÙif›e.h
"

10 
Çme¥aû
 
	gFwk
 {

12 
şass
 
	gNamedIÁ”çû
 : 
public
 
PŒIÁ”çû
<
NamedIÁ”çû
>

14 
public
:

15 
SŒšg
 
Çme
(ècÚ¡ {  
Çme_
; }

17 şas 
	cNÙif›eCÚ¡
 : 
vœtu®
 
public
 
RoÙNÙif›e
 {

18 
public
:

19 
Fwk
::
	tPŒ
<
	tNÙif›eCÚ¡
 cÚ¡> 
	tPŒCÚ¡
;

20 
	gFwk
::
	tPŒ
<
	tNÙif›eCÚ¡
> Ptr;

23 şas 
	cNÙif›e
 : 
vœtu®
 
public
 
NÙif›eCÚ¡
 {

24 
public
:

25 
Fwk
::
	tPŒ
<
	tNÙif›e
 cÚ¡> 
	tPŒCÚ¡
;

26 
	gFwk
::
	tPŒ
<
	tNÙif›e
> Ptr;

29 
	g´Ùeùed
:

30 
NamedIÁ”çû
(cÚ¡ 
SŒšg
& 
Çme
è: 
Çme_
(name) { }

32 
´iv©e
:

33 
SŒšg
 
Çme_
;

	@fwk/Ptr.h

3 #iâdeà
FWK_PTR_H


4 
	#FWK_PTR_H


	)

6 
Çme¥aû
 
	gFwk
 {

8 
	g‹m¶©e
 <
şass
 
	gT
>

9 şas 
	cPŒ
 {

10 
	gpublic
:

11 
PŒ
Ğ
T
 *
±r
 = 0 );

12 
PŒ
ĞcÚ¡ PŒ<
T
>& 
mp
 );

13 ~
PŒ
();

14 
	gİ”©Ü
=ĞcÚ¡ 
PŒ
<
T
>& 
mp
 );

15 
	gİ”©Ü
=Ğ
PŒ
<
T
>& 
mp
 );

16 
boŞ
 
	gİ”©Ü
==ĞcÚ¡ 
PŒ
<
T
>& 
mp
 ) cÚ¡ {  mp.
v®ue_
 == value_; }

17 cÚ¡ 
T
 * 
	gİ”©Ü
->(ècÚ¡ {  
	gv®ue_
; }

18 
T
 * 
	gİ”©Ü
->(è{  (
	gT
 *è
	gv®ue_
; }

19 
T
 * 
±r
(ècÚ¡ {  (
	gT
 *è
	gv®ue_
; }

20 
İ”©Ü
 
boŞ
(ècÚ¡ {  
	gv®ue_
 ? 1 : 0; }

22 
	g‹m¶©e
 <
şass
 
	gOth”Ty³
>

23 
İ”©Ü
 
	gPŒ
<
	gOth”Ty³
>() const {

24  
	gPŒ
<
	gOth”Ty³
>Ğ
	gv®ue_
 ); }

26 
	g´Ùeùed
:

27 
T
 *
v®ue_
;

30 
	g‹m¶©e
<
şass
 
	gT
>

31 
	gPŒ
<
	gT
>::
	$PŒ
Ğ
T
 * 
±r
 ) : 
	$v®ue_
(
±r
) {

32 ifĞ
v®ue_
 ) v®ue_->
	`ÃwRef
();

33 
	}
}

35 
	g‹m¶©e
<
şass
 
	gT
>

36 
	gPŒ
<
	gT
>::
PŒ
ĞcÚ¡ PŒ<
T
>& 
mp
 ) : 
	$v®ue_
(
mp
.
v®ue_
) {

37 ifĞ
v®ue_
 ) v®ue_->
	`ÃwRef
();

38 
	}
}

40 
	g‹m¶©e
<
şass
 
	gT
>

41 
	gPŒ
<
	gT
>::~
	$PŒ
() {

42 ifĞ
v®ue_
èv®ue_->
	`d–‘eRef
();

43 
	}
}

45 
	g‹m¶©e
<
şass
 
	gT
> 

46 
	gPŒ
<
	gT
>::
İ”©Ü
=ĞcÚ¡ 
PŒ
<
T
>& 
mp
 ) {

47 cÚ¡ 
T
 * 
§ve
 = 
v®ue_
;

48 
	gv®ue_
 = 
mp
.
v®ue_
;

49 ifĞ
	gv®ue_
 ) v®ue_->
ÃwRef
();

50 ifĞ
	g§ve
 ) save->
d–‘eRef
();

53 
	g‹m¶©e
<
şass
 
	gT
> 

54 
	gPŒ
<
	gT
>::
İ”©Ü
=Ğ
PŒ
<
T
>& 
mp
 ) {

55 
T
 * 
§ve
 = 
v®ue_
;

56 
	gv®ue_
 = 
mp
.
v®ue_
;

57 ifĞ
	gv®ue_
 ) v®ue_->
ÃwRef
();

58 ifĞ
	g§ve
 ) save->
d–‘eRef
();

	@fwk/PtrInterface.h

4 #iâdeà
FWK_PTRINTERFACE_H


5 
	#FWK_PTRINTERFACE_H


	)

7 
	~"Ty³s.h
"

9 
Çme¥aû
 
	gFwk
 {

11 
	g‹m¶©e
 <
şass
 
	gT
>

12 şas 
	cPŒIÁ”çû
 {

13 
	g´iv©e
:

14 
»f_
;

15 
	gpublic
:

16 
PŒIÁ”çû
(è: 
»f_
(1) {}

17 
»ã»nûs
(ècÚ¡ {  
»f_
; }

18 
	eA‰ribu‹
 {

19 
	gÃxtA‰ribu‹Numb”__
 = 1

22 cÚ¡ 
PŒIÁ”çû
 * 
ÃwRef
() const;

23 
d–‘eRef
() const;

24 
»ã»nûsDec
Ğ
U32
 
dec
 ) const;

25 
	g´Ùeùed
:

26 
vœtu®
 ~
PŒIÁ”çû
() {}

28 
vœtu®
 
ÚZ”oReã»nûs
(è{ 
d–‘e
 
this
; }

31 
	g‹m¶©e
<
şass
 
	gT
> cÚ¡ 
	gPŒIÁ”çû
<T> *

32 
	gPŒIÁ”çû
<
	gT
>::
	$ÃwRef
() const {

33 
PŒIÁ”çû
 *
me
 = 
cÚ¡_ÿ¡
<PŒIÁ”çû *>Ğ
this
 );

34 ++
me
->
»f_
;

35  
this
;

36 
	}
}

38 
	g‹m¶©e
<
şass
 
	gT
> 

39 
	gPŒIÁ”çû
<
	gT
>::
	$d–‘eRef
() const {

40 
PŒIÁ”çû
 *
me
 = 
cÚ¡_ÿ¡
<PŒIÁ”çû *>Ğ
this
 );

41 ifĞ--
me
->
»f_
 =ğ0 ) me->
	`ÚZ”oReã»nûs
();

42 
	}
}

44 
	g‹m¶©e
<
şass
 
	gT
> 

45 
	gPŒIÁ”çû
<
	gT
>::
	$»ã»nûsDec
Ğ
U32
 
dec
 ) const {

46 
PŒIÁ”çû
 *
me
 = 
cÚ¡_ÿ¡
<PŒIÁ”çû *>Ğ
this
 );

47 if((
me
->
»f_
-=
dec
è=ğ0 ) me->
	`ÚZ”oReã»nûs
();

48 
	}
}

	@fwk/String.h

3 #iâdeà
FWK_STRING_H


4 
	#FWK_STRING_H


	)

6 
	~<¡d¬g.h
>

7 
	~<¡ršg
>

8 
	~<fwk/Ty³s.h
>

10 
Çme¥aû
 
	gFwk
 {

12 
šlše
 
U32


13 
hash
Ğ
SŒšg
 cÚ¡ & 
s
 )

15 
U32
 
	gh
 = 0;

16 
	gSŒšg
::
size_ty³
 
i
 = 0; 
	gi
 < 
	gs
.
size
(); ++i)

17 
	gh
 = 5 * 
h
 + 
s
[
i
];

18  
	gh
;

21 şas 
	cSŒšgBuf
 {

22 
	gpublic
:

23 
‹m¶©e
< 
ty³Çme
 
T
 >

24 
šlše
 
SŒšgBuf
 & 
İ”©Ü
<<ĞcÚ¡ 
T
 & 
t
 ) {

25 
ss_
 << 
t
;

26  *
	gthis
;

28 
İ”©Ü
 
SŒšg
(ècÚ¡ {  
	gss_
.
¡r
(); }

29 
	g´iv©e
:

30 
¡d
::
¡ršg¡»am
 
ss_
;

	@fwk/TypeTraits.h

4 #iâdeà
FWK_TYPETRAITS_H


5 
	#FWK_TYPETRAITS_H


	)

7 
Çme¥aû
 
	gFwk
 {

9 
	sTrue
 { };

10 
	sF®£
 { };

12 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsIÁeg”
 { 
F®£
 
	tV®ue
; };

13 
	g‹m¶©e
<> 
	gIsIÁeg”
< 
	gboŞ
 > { 
True
 
	tV®ue
; };

14 
	g‹m¶©e
<> 
	gIsIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

15 
	g‹m¶©e
<> 
	gIsIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

16 
	g‹m¶©e
<> 
	gIsIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

17 
	g‹m¶©e
<> 
	gIsIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

18 
	g‹m¶©e
<> 
	gIsIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

19 
	g‹m¶©e
<> 
	gIsIÁeg”
< > { 
True
 
	tV®ue
; };

20 
	g‹m¶©e
<> 
	gIsIÁeg”
< > { 
True
 
	tV®ue
; };

21 
	g‹m¶©e
<> 
	gIsIÁeg”
< > { 
True
 
	tV®ue
; };

22 
	g‹m¶©e
<> 
	gIsIÁeg”
< > { 
True
 
	tV®ue
; };

23 
	g‹m¶©e
<> 
	gIsIÁeg”
< > { 
True
 
	tV®ue
; };

25 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsSigÃdIÁeg”
 { 
F®£
 
	tV®ue
; };

26 
	g‹m¶©e
<> 
	gIsSigÃdIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

27 
	g‹m¶©e
<> 
	gIsSigÃdIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

28 
	g‹m¶©e
<> 
	gIsSigÃdIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

29 
	g‹m¶©e
<> 
	gIsSigÃdIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

30 
	g‹m¶©e
<> 
	gIsSigÃdIÁeg”
< sigÃd > { 
True
 
	tV®ue
; };

32 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsUnsigÃdIÁeg”
 { 
F®£
 
	tV®ue
; };

33 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< 
	gboŞ
 > { 
True
 
	tV®ue
; };

34 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< > { 
True
 
	tV®ue
; };

35 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< > { 
True
 
	tV®ue
; };

36 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< > { 
True
 
	tV®ue
; };

37 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< > { 
True
 
	tV®ue
; };

38 
	g‹m¶©e
<> 
	gIsUnsigÃdIÁeg”
< > { 
True
 
	tV®ue
; };

40 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsFlßt
 { 
F®£
 
	tV®ue
; };

41 
	g‹m¶©e
<> 
	gIsFlßt
< > { 
True
 
	tV®ue
; };

42 
	g‹m¶©e
<> 
	gIsFlßt
< > { 
True
 
	tV®ue
; };

43 
	g‹m¶©e
<> 
	gIsFlßt
< > { 
True
 
	tV®ue
; };

45 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsPoš‹r
 { 
F®£
 
	tV®ue
; };

46 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	gIsPoš‹r
< T * > { 
True
 
	tV®ue
; };

53 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	sIsPod
 { 
F®£
 
	tV®ue
; };

54 
	g‹m¶©e
<> 
	gIsPod
< 
	gboŞ
 > { 
True
 
	tV®ue
; };

55 
	g‹m¶©e
<> 
	gIsPod
< sigÃd > { 
True
 
	tV®ue
; };

56 
	g‹m¶©e
<> 
	gIsPod
< sigÃd > { 
True
 
	tV®ue
; };

57 
	g‹m¶©e
<> 
	gIsPod
< sigÃd > { 
True
 
	tV®ue
; };

58 
	g‹m¶©e
<> 
	gIsPod
< sigÃd > { 
True
 
	tV®ue
; };

59 
	g‹m¶©e
<> 
	gIsPod
< sigÃd > { 
True
 
	tV®ue
; };

60 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

61 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

62 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

63 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

64 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

65 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

66 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

67 
	g‹m¶©e
<> 
	gIsPod
< > { 
True
 
	tV®ue
; };

68 
	g‹m¶©e
< 
ty³Çme
 
	gT
 > 
	gIsPod
< T * > { 
True
 
	tV®ue
; };

	@fwk/Types.h

3 #iâdeà
TAC_TYPES_H


4 
	#TAC_TYPES_H


	)

6 
	~<ty³šfo
>

8 
	tU8
;

9 
	tU16
;

10 
	tU32
;

11 
	tU64
;

12 
	tS32
;

14 
	~<m©h.h
>

18 
	~<io¡»am
>

19 
	~<s¡»am
>

20 
	~<¡ršg
>

22 
	~<as£¹.h
>

24 
	#uÆik–y
Ğ
cÚd
 ) 
	`__butš_ex³ù
((cÚd),0)

	)

25 
	#lik–y
Ğ
cÚd
 ) 
	`__butš_ex³ù
((cÚd),1)

	)

27 
	#hidd’__
 
	`__©Œibu‹__
 ((
	`visib™y
 ("hidd’")))

	)

30 
	#th»ad_loÿl
 
__th»ad


	)

32 
Çme¥aû
 
	gFwk
 {

34 
	tSecÚds
;

35 
	tUnixTime
;

37 cÚ¡ 
SecÚds
 
	gbegšnšgOfTime
 = -
INFINITY
;

38 cÚ¡ 
SecÚds
 
	g’dOfTime
 = 
INFINITY
;

40 
	g¡d
::
	ti¡»am
 
	tI¡»am
;

41 
	g¡d
::
	to¡»am
 
	tO¡»am
;

42 
	g¡d
::
	ti¡ršg¡»am
 
	tI¡ršgSŒ—m
;

43 
	g¡d
::
	to¡ršg¡»am
 
	tO¡ršgSŒ—m
;

44 
	g¡d
::
	t¡ršg
 
	tSŒšg
;

46 
U32
 
	tBy‹s
;

48 
şass
 
	gA‰ribu‹
;

49 
şass
 
	gDœ
;

50 
şass
 
	gT“SŒ—m
;

52 
şass
 
	gAùiv™y
;

53 
Aùiv™y
 * 
Cu¼’tAùiv™y_
;

56 
şass
 
	gRoÙNÙif›e
;

57 
şass
 
	gLogMsg
;

59 
	g‹m¶©e
< 
şass
 
	gT
 > 
U32


60 
hash
Ğ
T
 cÚ¡ & 
t
 ) {

61  
	gt
.
hash
();

66 
šlše
 
U32
 
hash
Ğ
d
 ) {

67  *(
	gU32
*)(&
	gd
);

70 
šlše
 
U32


71 
hash
Ğ
U32
 
t
 ) {

72  
	gt
;

74 
šlše
 
U32


75 
hash
Ğ
U8
 
t
 ) {

76  
	gt
;

78 
šlše
 
U32


79 
hash
Ğ
U16
 
t
 ) {

80  
	gt
;

83 
šlše
 
U32


84 
hash
Ğ
t
 ) {

85  
	gt
;

88 
šlše
 
•sÚ
() {  0.000001; }

90 
SŒšg
 
demªgË
Ğ
¡d
::
ty³_šfo
 const & );

92 
	g‹m¶©e
< 
ty³Çme
 
	gT
 >

93 
SŒšg
 
ty³Name
() {

94  
demªgË
Ğ
ty³id
(
T
) );

97 
	g‹m¶©e
< 
ty³Çme
 
	gT
 >

98 
SŒšg
 
ty³Name
Ğ
T
 cÚ¡ & 
t
 ) {

99  
demªgË
Ğ
ty³id
(
t
) );

	@init.cpp

38 
	~"maš.h
"

40 
	~"mazew¬.h
"

42 
	~"uni¡d.h
"

44 
	gr¡©e
[32];

46 cÚ¡ 
MazeTy³
 
	gmazeB™s
 = {

89 
	$MazeIn™
(
¬gc
, **
¬gv
) {

90 
	`g‘Maze
();

92 
	`£tRªdom
();

94 
	`In™Di¥Ïy
(
¬gc
, 
¬gv
);

96 
	`NewPos™iÚ
(
M
);

98 
	`´štf
("%d X LOC \n", 
M
->
	`xloc
().
	`v®ue
());

105 
	`ÃtIn™
();

106 
	`S¹Di¥Ïy
();

107 
	`R©CursÜ
();

108 
	}
}

113 
	$g‘Maze
() {

114 
i
, 
j
;

116 
i
 = 0; i < 
MAZEXMAX
; i++) {

117 
j
 = 0; j < 
MAZEYMAX
; j++) {

118 ià(
mazeB™s
[
i
][
MAZEYMAX
 - 1 - 
j
] == 1) {

119 
M
->
maze_
[
i
][
j
] = 
TRUE
;

121 
M
->
maze_
[
i
][
j
] = 
FALSE
;

125 
	}
}

130 
	$£tRªdom
() {

132 
timev®
 
now
;

134 
	`g‘timeofday
(&
now
, 
NULL
);

135 
	`š™¡©e
((
now
.
tv_u£c
 / 16000), (*)
r¡©e
, 32);

136 
	`£t¡©e
(
r¡©e
);

137 
	}
}

142 
	$g‘Name
(*
´om±
, **
¿tName
) {

143 
buf
[128], *
ı
;

144 *
comma
;

146 
buf
[0] = '\0';

147 
	`´štf
("%s: ", 
´om±
);

149 
	`fg‘s
(
buf
, (bufè- 1, 
¡dš
);

150 ià(
buf
[0] == '\0') {

151 ià((
ı
 = 
	`g‘’v
("USERNAME")è!ğ
NULL
)

152 
	`¡rıy
(
buf
, 
ı
);

154 
	`¡rıy
(
buf
, (
	`g‘pwuid
(
	`g‘uid
()))->
pw_gecos
);

155 
comma
 = (*)
	`šdex
(
buf
, ',');

156 ià(
comma
 !ğ
NULL
)

157 *
comma
 = '\0';

160 *
¿tName
 = (*)
	`m®loc
(()(
	`¡¾’
(
buf
) + 1));

161 ià(*
¿tName
 =ğ
NULL
)

162 
	`MWE¼Ü
("no mem for„atName");

163 
	`¡rıy
(*
¿tName
, 
buf
);

164 
	}
}

167 
	$g‘SŒšg
(*
´om±
, **
¡ršg
) {

168 
buf
[128];

170 
buf
[0] = '\0';

171 
	`´štf
("%s: ", 
´om±
);

172 
	`fg‘s
(
buf
, (bufè- 1, 
¡dš
);

173 *
¡ršg
 = (*)
	`m®loc
(()(
	`¡¾’
(
buf
) + 1));

174 ià(*
¡ršg
 =ğ
NULL
)

175 
	`MWE¼Ü
("no mem for getString");

176 
	`¡rıy
(*
¡ršg
, 
buf
);

177 
	}
}

182 
	$g‘Ho¡Name
(*
´om±
, **
ho¡Name
, 
Sockaddr
 *
ho¡Addr
) {

183 
buf
[128];

184 
Sockaddr
 *
AddrTemp
;

186 
buf
[0] = '\0';

187 
AddrTemp
 = (
Sockaddr
 *)
NULL
; AddrTemp == (Sockaddr *)NULL;) {

188 
	`´štf
("% %s: ", 
´om±
, "(CR for‡ny host)");

189 
	`fg‘s
(
buf
, (bufè- 1, 
¡dš
);

190 ià(
	`¡¾’
(
buf
) == 0)

192 *
ho¡Name
 = (*)
	`m®loc
(()(
	`¡¾’
(
buf
) + 1));

193 ià(*
ho¡Name
 =ğ
NULL
)

194 
	`MWE¼Ü
("no mem for hostName");

195 
	`¡rıy
(*
ho¡Name
, 
buf
);

198 
AddrTemp
 = 
	`»sŞveHo¡
(*
ho¡Name
);

199 ià(
AddrTemp
 =ğ(
Sockaddr
 *)
NULL
) {

200 
	`´štf
("DÚ'ˆknow ho¡ %s\n", *
ho¡Name
);

201 
	`ä“
(*
ho¡Name
);

202 *
ho¡Name
 = 
NULL
;

205 ià((*
ho¡Name
 !ğ
NULL
è&& (
	`¡¾’
(*hostName) != 0))

206 
	`bcİy
((*)
AddrTemp
, (*)
ho¡Addr
, (
Sockaddr
));

207 
	}
}

219 
Sockaddr
 *
	$»sŞveHo¡
(*
Çme
) {

220 
ho¡’t
 *
fho¡
;

221 
š_addr
 
çdd
;

222 
Sockaddr
 
§
;

224 ià((
fho¡
 = 
	`g‘ho¡byÇme
(
Çme
)è!ğ
NULL
) {

225 
§
.
sš_çmy
 = 
fho¡
->
h_add¹y³
;

226 
§
.
sš_pÜt
 = 0;

227 
	`bcİy
(
fho¡
->
h_addr
, &
§
.
sš_addr
, fho¡->
h_Ëngth
);

229 
çdd
.
s_addr
 = 
	`š‘_addr
(
Çme
);

230 ià(
çdd
.
s_addr
 != -1) {

231 
§
.
sš_çmy
 = 
AF_INET
;

232 
§
.
sš_pÜt
 = 0;

233 
§
.
sš_addr
.
s_addr
 = 
çdd
.s_addr;

235  (
NULL
);

237  (&
§
);

238 
	}
}

242 
boŞ
 
	$em±yAh—d
() {

243 
tx
 = 
MY_X_LOC
;

244 
ty
 = 
MY_Y_LOC
;

246 
MY_DIR
) {

247 
NORTH
:

248  (!
M
->
maze_
[
tx
 + 1][
ty
]);

249 
SOUTH
:

250  (!
M
->
maze_
[
tx
 - 1][
ty
]);

251 
EAST
:

252  (!
M
->
maze_
[
tx
][
ty
 + 1]);

253 
WEST
:

254  (!
M
->
maze_
[
tx
][
ty
 - 1]);

257 
	`as£¹
(0);

259 
	}
}

263 
boŞ
 
	$em±yRight
() {

264 
tx
 = 
MY_X_LOC
;

265 
ty
 = 
MY_Y_LOC
;

267 
MY_DIR
) {

268 
NORTH
:

269  (!
M
->
maze_
[
tx
][
ty
 + 1]);

270 
SOUTH
:

271  (!
M
->
maze_
[
tx
][
ty
 - 1]);

272 
WEST
:

273  (!
M
->
maze_
[
tx
 + 1][
ty
]);

274 
EAST
:

275  (!
M
->
maze_
[
tx
 - 1][
ty
]);

278 
	`as£¹
(0);

280 
	}
}

284 
boŞ
 
	$em±yLeá
() {

285 
tx
 = 
MY_X_LOC
;

286 
ty
 = 
MY_Y_LOC
;

288 
MY_DIR
) {

289 
NORTH
:

290  (!
M
->
maze_
[
tx
][
ty
 - 1]);

291 
SOUTH
:

292  (!
M
->
maze_
[
tx
][
ty
 + 1]);

293 
WEST
:

294  (!
M
->
maze_
[
tx
 - 1][
ty
]);

295 
EAST
:

296  (!
M
->
maze_
[
tx
 + 1][
ty
]);

299 
	`as£¹
(0);

301 
	}
}

305 
boŞ
 
	$em±yBehšd
() {

306 
tx
 = 
MY_X_LOC
;

307 
ty
 = 
MY_Y_LOC
;

309 
MY_DIR
) {

310 
NORTH
:

311  (!
M
->
maze_
[
tx
 - 1][
ty
]);

312 
SOUTH
:

313  (!
M
->
maze_
[
tx
 + 1][
ty
]);

314 
EAST
:

315  (!
M
->
maze_
[
tx
][
ty
 - 1]);

316 
WEST
:

317  (!
M
->
maze_
[
tx
][
ty
 + 1]);

320 
	`as£¹
(0);

322 
	}
}

	@main.h

1 
	~<sys/sock‘.h
>

2 
	~<sys/time.h
>

3 
	~<sys/ty³s.h
>

4 
	~<sys/uio.h
>

6 
	~<¬·/š‘.h
>

7 
	~<Ãtš‘/š.h
>

9 
	~<as£¹.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtdb.h
>

12 
	~<pwd.h
>

13 
	~<sigÇl.h
>

14 
	~<¡dio.h
>

15 
	~<¡dlib.h
>

16 
	~<¡ršg.h
>

17 
	~<¡ršgs.h
>

18 
	~<uni¡d.h
>

	@mazewar.h

43 #iâdeà
MAZEWAR_H


44 
	#MAZEWAR_H


	)

46 
	~"fwk/NamedIÁ”çû.h
"

47 
	~<m­
>

48 
	~"Exû±iÚ.h
"

49 
	~"Nomš®.h
"

50 
	~<¡ršg
>

53 #iâdeà
TRUE


54 
	#TRUE
 1

	)

55 
	#FALSE
 0

	)

59 
	#MAX_RATS
 8

	)

65 
	#MAZEPORT
 5000

	)

67 
	#MAZEGROUP
 0xe0010101

	)

68 
	#MAZESERVICE
 "mazew¬244B"

	)

73 
	#MAZEXMAX
 32

	)

74 
	#MAZEYMAX
 16

	)

75 
	#VECTORSIZE
 55

	)

76 
	#NAMESIZE
 20

	)

77 
	#NDIRECTION
 4

	)

78 
	#NORTH
 0

	)

79 
	#SOUTH
 1

	)

80 
	#EAST
 2

	)

81 
	#WEST
 3

	)

82 
	#NVIEW
 4

	)

83 
	#LEFT
 0

	)

84 
	#RIGHT
 1

	)

85 
	#REAR
 2

	)

86 
	#FRONT
 3

	)

88 
	#HEARTBEAR
 0

	)

89 
	#HEARTBEARACK
 1

	)

90 
	#EVENT
 2

	)

91 
	#EVENTACK
 3

	)

92 
	#SIREQ
 4

	)

93 
	#SIRES
 5

	)

94 
	#SIACK
 6

	)

96 
usšg
 
Çme¥aû
 
	g¡d
;

100 
sockaddr_š
 
	tSockaddr
;

101 
boŞ
 
	tMazeRow
[
MAZEYMAX
];

102 
MazeRow
 
	tMazeTy³
[
MAZEXMAX
];

103 
MazeRow
 *
	tMazeTy³PŒ
;

105 ¡ruù { 
	mx
, 
	my
; } 
	tXYpošt
;

106 ¡ruù { 
XYpošt
 
	mp1
, 
	mp2
; } 
	tXY·œ
;

107 ¡ruù { 
	mxcÜ
, 
	mycÜ
; } 
	tXY
;

108 ¡ruù { 
	mb™s
[16]; } 
	tB™C–l
;

109 
	tR©Name
[
NAMESIZE
];

111 
şass
 
	gDœeùiÚ
 : 
public
 
Ordš®
<
DœeùiÚ
, > {

112 
	gpublic
:

113 
DœeùiÚ
(
num
è: 
Ordš®
<DœeùiÚ, >(
	gnum
) {

114 ià(
	gnum
 < 
	gNORTH
 ||‚um > 
	gNDIRECTION
) {

115 
throw
 
RªgeExû±iÚ
("Error: Unexpected value.\n");

120 
şass
 
	gLoc
 : 
public
 
Ordš®
<
Loc
, > {

121 
	gpublic
:

122 
Loc
(
num
è: 
Ordš®
<Loc, >(
	gnum
) {

123 ià(
	gnum
 < 0) {

124 
throw
 
RªgeExû±iÚ
("Error: Unexpected‚egative value.\n");

129 
şass
 
	gScÜe
 : 
public
 
Ordš®
<
ScÜe
, > {

130 
	gpublic
:

131 
ScÜe
(
num
è: 
Ordš®
<ScÜe, >(
	gnum
) {}

134 
şass
 
	gR©IndexTy³
 : 
public
 
Ordš®
<
R©IndexTy³
, > {

135 
	gpublic
:

136 
R©IndexTy³
(
num
è: 
Ordš®
<R©IndexTy³, >(
	gnum
) {

137 ià(
	gnum
 < 0) {

138 
throw
 
RªgeExû±iÚ
("Error: Unexpected‚egative value.\n");

143 
şass
 
	gR©Id
 : 
public
 
Ordš®
<
R©Id
, > {

144 
	gpublic
:

145 
R©Id
(
num
è: 
Ordš®
<R©Id, >(
	gnum
) {}

148 
şass
 
	gTok’Id
 : 
public
 
Ordš®
<
Tok’Id
, > {

149 
	gpublic
:

150 
Tok’Id
(
num
è: 
Ordš®
<Tok’Id, >(
	gnum
) {}

153 şas 
	cR©Aµ—¿nû
 {

155 
	mpublic
:

156 
	$R©Aµ—¿nû
(è: 
	`x
(1), 
	`y
(1), 
	$tok’Id
(0){};

157 
boŞ
 
visibË
;

158 
Loc
 
x
, 
y
;

159 
di¡ªû
;

160 
Tok’Id
 
tok’Id
;

161 
	}
};

163 
	sMisse
{

164 
Misse
(è: 
exi¡
(
çl£
), 
x
(0), 
y
(0), 
dœ
(
NORTH
) {};

165 
boŞ
 
	mexi¡
;

166 
Loc
 
	mx
, 
	my
;

167 
DœeùiÚ
 
	mdœ
;

170 şas 
	cR©
 {

172 
	mpublic
:

173 
	$R©
(è: 
	`¶ayšg
(0), 
	`şßked
(0), 
	`x
(1), 
	`y
(1), 
	$dœ
(
NORTH
){};

174 
R©Name
 
Name
;

175 
boŞ
 
¶ayšg
;

176 
boŞ
 
şßked
;

177 
Loc
 
x
, 
y
;

178 
DœeùiÚ
 
dœ
;

179 
Misse
 
R©Misse
[4];

180 
	}
};

182 
R©Aµ—¿nû
 
	tR©Aµ_ty³
[
MAX_RATS
];

183 
R©Aµ—¿nû
 *
	tR©Look
;

189 
R©Aµ_ty³
 
R©s2Di¥Ïy
;

192 şas 
	cMazew¬In¡ªû
 : 
public
 
Fwk
::
NamedIÁ”çû
 {

193 
public
:

194 
Fwk
::
	tPŒ
<
	tMazew¬In¡ªû
 cÚ¡> 
	tPŒCÚ¡
;

195 
	mFwk
::
	tPŒ
<
	tMazew¬In¡ªû
> Ptr;

197 
	mMazew¬In¡ªû
::
PŒ
 
	$mazew¬In¡ªûNew
(
¡ršg
 
s
) {

198 
Mazew¬In¡ªû
 *
m
 = 
Ãw
 
	`Mazew¬In¡ªû
(
s
);

199  
m
;

202 
šlše
 
DœeùiÚ
 
	$dœ
(ècÚ¡ {  
dœ_
; 
	}
}

203 
	$dœIs
(
DœeùiÚ
 
dœ
è{ 
this
->
dœ_
 = dœ; 
	}
}

204 
šlše
 
DœeùiÚ
 
	$dœP“k
(ècÚ¡ {  
dœP“k_
; 
	}
}

205 
	$dœP“kIs
(
DœeùiÚ
 
dœP“k
è{ 
this
->
dœP“k_
 = dœP“k; 
	}
}

207 
šlše
 
	$mazePÜt
(ècÚ¡ {  
mazePÜt_
; 
	}
}

208 
	$mazePÜtIs
(
mazePÜt
è{ 
this
->
mazePÜt_
 = mazePÜt; 
	}
}

209 
šlše
 
Sockaddr
 *
	$myAddr
(ècÚ¡ {  
myAddr_
; 
	}
}

210 
	$myAddrIs
(
Sockaddr
 *
myAddr
è{ 
this
->
myAddr_
 = myAddr; 
	}
}

211 
šlše
 
R©Id
 
	$myR©Id
(ècÚ¡ {  
myR©Id_
; 
	}
}

212 
	$myR©IdIs
(
R©Id
 
myR©Id
è{ 
this
->
myR©Id_
 = myR©Id; 
	}
}

214 
šlše
 
boŞ
 
	$³ekšg
(ècÚ¡ {  
³ekšg_
; 
	}
}

215 
	$³ekšgIs
(
boŞ
 
³ekšg
è{ 
this
->
³ekšg_
 =…“kšg; 
	}
}

216 
šlše
 
	$theSock‘
(ècÚ¡ {  
theSock‘_
; 
	}
}

217 
	$theSock‘Is
(
theSock‘
è{ 
this
->
theSock‘_
 =heSock‘; 
	}
}

218 
šlše
 
ScÜe
 
	$scÜe
(ècÚ¡ {  
scÜe_
; 
	}
}

219 
	$scÜeIs
(
ScÜe
 
scÜe
è{ 
this
->
scÜe_
 = scÜe; 
	}
}

220 
šlše
 
Loc
 
	$xloc
(ècÚ¡ {  
xloc_
; 
	}
}

221 
	$xlocIs
(
Loc
 
xloc
è{ 
this
->
xloc_
 = xloc; 
	}
}

222 
šlše
 
Loc
 
	$yloc
(ècÚ¡ {  
yloc_
; 
	}
}

223 
	$ylocIs
(
Loc
 
yloc
è{ 
this
->
yloc_
 = yloc; 
	}
}

224 
šlše
 
Loc
 
	$xP“k
(ècÚ¡ {  
xP“k_
; 
	}
}

225 
	$xP“kIs
(
Loc
 
xP“k
è{ 
this
->
xP“k_
 = xP“k; 
	}
}

226 
šlše
 
Loc
 
	$yP“k
(ècÚ¡ {  
yP“k_
; 
	}
}

227 
	$yP“kIs
(
Loc
 
yP“k
è{ 
this
->
yP“k_
 = yP“k; 
	}
}

228 
šlše
 
	$aùive
(ècÚ¡ {  
aùive_
; 
	}
}

229 
	$aùiveIs
(
aùive
è{ 
this
->
aùive_
 =‡ùive; 
	}
}

230 
šlše
 
R©
 
	$¿t
(
R©IndexTy³
 
num
ècÚ¡ {  
mazeR©s_
[num.
	`v®ue
()]; 
	}
}

231 
	$¿tIs
(
R©
 
¿t
, 
R©IndexTy³
 
num
è{ 
this
->
mazeR©s_
[num.
	`v®ue
()] =„©; 
	}
}

232 
šlše
 
R©IndexTy³
 
	$myIndex
(ècÚ¡ {  
this
->
myR©Index_
;
	}
}

233 
	$myIndexIs
(
R©IndexTy³
 
šdex
){ 
this
->
myR©Index_
 = index;
	}
}

235 
MazeTy³
 
	gmaze_
;

236 
R©Name
 
	gmyName_
;

238 
	g¡d
::
m­
<
R©IndexTy³
, 
	gR©Id
> 
	gAÎR©s
;

240 
	g´Ùeùed
:

241 
	$Mazew¬In¡ªû
(
¡ršg
 
s
)

242 : 
Fwk
::
	`NamedIÁ”çû
(
s
), 
	`dœ_
(0), 
	`dœP“k_
(0), 
	`myR©Id_
(0), 
	`scÜe_
(0),

243 
	`xloc_
(1), 
	`yloc_
(3), 
	`xP“k_
(0), 
	`yP“k_
(0), 
	$myR©Index_
(0) {

244 
myAddr_
 = (
Sockaddr
 *)
	`m®loc
((Sockaddr));

245 ià(!
myAddr_
) {

246 
	`´štf
("Error‡llocating sockaddr variable");

248 
	}
}

249 
DœeùiÚ
 
	gdœ_
;

250 
DœeùiÚ
 
	gdœP“k_
;

252 
	gmazePÜt_
;

253 
Sockaddr
 *
	gmyAddr_
;

254 
R©
 
	gmazeR©s_
[
MAX_RATS
];

255 
R©Id
 
	gmyR©Id_
;

256 
R©IndexTy³
 
	gmyR©Index_
;

258 
boŞ
 
	g³ekšg_
;

259 
	gtheSock‘_
;

260 
ScÜe
 
	gscÜe_
;

261 
Loc
 
	gxloc_
;

262 
Loc
 
	gyloc_
;

263 
Loc
 
	gxP“k_
;

264 
Loc
 
	gyP“k_
;

265 
	gaùive_
;

267 
Mazew¬In¡ªû
::
PŒ
 
M
;

269 
	#MY_RAT_INDEX
 0

	)

270 
	#MY_DIR
 
M
->
	`dœ
().
	`v®ue
()

	)

271 
	#MY_X_LOC
 
M
->
	`xloc
().
	`v®ue
()

	)

272 
	#MY_Y_LOC
 
M
->
	`yloc
().
	`v®ue
()

	)

276 
	#EVENT_A
 1

	)

277 
	#EVENT_S
 2

	)

278 
	#EVENT_F
 3

	)

279 
	#EVENT_D
 4

	)

280 
	#EVENT_G
 5

	)

281 
	#EVENT_C
 6

	)

282 
	#EVENT_BAR
 7

	)

284 
	#EVENT_LEFT_D
 30

	)

285 
	#EVENT_RIGHT_D
 31

	)

286 
	#EVENT_MIDDLE_D
 32

	)

287 
	#EVENT_LEFT_U
 33

	)

288 
	#EVENT_RIGHT_U
 34

	)

290 
	#EVENT_NETWORK
 50

	)

291 
	#EVENT_INT
 51

	)

292 
	#EVENT_TIMEOUT
 52

	)

294 
¿tB™s
[];

297 
	mty³
;

298 
u_lÚg
 
	mbody
[256];

299 } 
	tMW244BPack‘
;

302 
	mev’tTy³
;

303 
MW244BPack‘
 *
	mev’tD‘a
;

304 
Sockaddr
 
	mev’tSourû
;

305 } 
	tMWEv’t
;

307 *
m®loc
();

308 
Sockaddr
 *
»sŞveHo¡
();

311 
In™Di¥Ïy
(, **);

312 
S¹Di¥Ïy
();

313 
ShowV›w
(
Loc
, Loc, 
DœeùiÚ
);

314 
S‘MyR©IndexTy³
(
R©IndexTy³
);

315 
S‘R©Pos™iÚ
(
R©IndexTy³
, 
Loc
, Loc, 
DœeùiÚ
);

316 
CË¬R©Pos™iÚ
(
R©IndexTy³
);

317 
ShowPos™iÚ
(
Loc
, Loc, 
DœeùiÚ
);

318 
ShowAÎPos™iÚs
();

319 
showMe
(
Loc
, Loc, 
DœeùiÚ
);

320 
ş—rPos™iÚ
(
R©IndexTy³
, 
Loc
, Loc);

321 
ş—rSqu¬e
(
Loc
 
xCË¬
, Loø
yCË¬
);

322 
NewScÜeC¬d
();

323 
Upd©eScÜeC¬d
(
R©IndexTy³
);

324 
FlB™m­s
();

325 
b™Fl
(
B™C–l
 *, 
size
);

326 
Sw­B™m­s
();

327 
by‹Sw­
(
B™C–l
 *, 
size
);

330 
MazeIn™
(, **);

331 
¿tS‹s
();

332 
g‘Maze
();

333 
£tRªdom
();

334 
g‘Name
(*, **);

335 
g‘SŒšg
(*, **);

336 
g‘Ho¡Name
(*, **, 
Sockaddr
 *);

337 
Sockaddr
 *
»sŞveHo¡
(*);

338 
boŞ
 
em±yAh—d
();

339 
boŞ
 
em±yRight
();

340 
boŞ
 
em±yLeá
();

341 
boŞ
 
em±yBehšd
();

344 
¶ay
();

345 
aboutFaû
();

346 
ËáTuº
();

347 
rightTuº
();

348 
fÜw¬d
();

349 
backw¬d
();

350 
³ekLeá
();

351 
³ekRight
();

352 
³ekStİ
();

353 
shoÙ
();

354 
şßk
();

355 
qu™
();

356 
NewPos™iÚ
(
Mazew¬In¡ªû
::
PŒ
 
M
);

357 
MWE¼Ü
(*);

358 
ScÜe
 
G‘R©ScÜe
(
R©IndexTy³
);

359 *
G‘R©Name
(
R©IndexTy³
);

360 
CÚv”tIncomšg
(
MW244BPack‘
 *);

361 
CÚv”tOutgošg
(
MW244BPack‘
 *);

362 
¿tS‹
();

363 
mªageMisses
();

364 
DoV›wUpd©e
();

365 
£ndPack‘ToPÏy”
(
R©Id
);

366 
´oûssPack‘
(
MWEv’t
 *);

367 
ÃtIn™
();

370 
In™Wšdow
(, **);

371 
S¹Wšdow
(, );

372 
CË¬V›w
();

373 
D¿wV›wLše
(, , , );

374 
NextEv’t
(
MWEv’t
 *, );

375 
boŞ
 
KBEv’tP’dšg
();

376 
HourGÏssCursÜ
();

377 
R©CursÜ
();

378 
D—dR©CursÜ
();

379 
HackMazeB™m­
(
Loc
, Loc, 
B™C–l
 *);

380 
Di¥ÏyR©B™m­
(, , , , , );

381 
Wr™eScÜeSŒšg
(
R©IndexTy³
);

382 
CË¬ScÜeLše
(
R©IndexTy³
);

383 
Inv”tScÜeLše
(
R©IndexTy³
);

384 
NÙifyPÏy”
();

385 
D¿wSŒšg
(cÚ¡ *, 
ušt32_t
, uint32_t, uint32_t);

386 
StİWšdow
();

	@toplevel.cpp

10 
	~"maš.h
"

11 
	~"mazew¬.h
"

12 
	~<¡ršg
>

14 
boŞ
 
	gupd©eV›w
;

15 
	gMazew¬In¡ªû
::
PŒ
 
M
;

18 
Sockaddr
 
	ggroupAddr
;

19 
	#MAX_OTHER_RATS
 (
MAX_RATS
 - 1)

	)

21 
	$maš
(
¬gc
, *
¬gv
[]) {

22 
Loc
 
	`x
(1);

23 
Loc
 
	`y
(5);

24 
DœeùiÚ
 
	`dœ
(0);

25 *
¿tName
;

27 
	`sigÇl
(
SIGHUP
, 
qu™
);

28 
	`sigÇl
(
SIGINT
, 
qu™
);

29 
	`sigÇl
(
SIGTERM
, 
qu™
);

31 
	`g‘Name
("W–comtØCS244B MazeW¬!\n\nYou¸Name", &
¿tName
);

32 
¿tName
[
	`¡¾’
(ratName) - 1] = 0;

34 
M
 = 
Mazew¬In¡ªû
::
	`mazew¬In¡ªûNew
(
	`¡ršg
(
¿tName
));

35 
Mazew¬In¡ªû
 *
a
 = 
M
.
	`±r
();

36 
	`¡ºıy
(
M
->
myName_
, 
¿tName
, 
NAMESIZE
);

37 
	`ä“
(
¿tName
);

39 
	`MazeIn™
(
¬gc
, 
¬gv
);

41 
	`NewPos™iÚ
(
M
);

47 
	`¶ay
();

50 
	}
}

54 
	$¶ay
() {

55 
MWEv’t
 
ev’t
;

56 
MW244BPack‘
 
šcomšg
;

58 
ev’t
.
ev’tD‘a
 = &
šcomšg
;

60 
TRUE
) {

61 
	`NextEv’t
(&
ev’t
, 
M
->
	`theSock‘
());

62 ià(!
M
->
	`³ekšg
())

63 
ev’t
.
ev’tTy³
) {

64 
EVENT_A
:

65 
	`aboutFaû
();

68 
EVENT_S
:

69 
	`ËáTuº
();

72 
EVENT_D
:

73 
	`fÜw¬d
();

76 
EVENT_F
:

77 
	`rightTuº
();

80 
EVENT_G
:

81 
	`backw¬d
();

84 
EVENT_C
:

85 
	`şßk
();

88 
EVENT_BAR
:

89 
	`shoÙ
();

92 
EVENT_LEFT_D
:

93 
	`³ekLeá
();

96 
EVENT_RIGHT_D
:

97 
	`³ekRight
();

100 
EVENT_NETWORK
:

101 
	`´oûssPack‘
(&
ev’t
);

104 
EVENT_INT
:

105 
	`qu™
(0);

109 
ev’t
.
ev’tTy³
) {

110 
EVENT_RIGHT_U
:

111 
EVENT_LEFT_U
:

112 
	`³ekStİ
();

115 
EVENT_NETWORK
:

116 
	`´oûssPack‘
(&
ev’t
);

120 
	`¿tS‹s
();

122 
	`mªageMisses
();

124 
	`DoV›wUpd©e
();

128 
	}
}

132 
DœeùiÚ
 
	g_aboutFaû
[
NDIRECTION
] = {
SOUTH
, 
NORTH
, 
WEST
, 
EAST
};

133 
DœeùiÚ
 
	g_ËáTuº
[
NDIRECTION
] = {
WEST
, 
EAST
, 
NORTH
, 
SOUTH
};

134 
DœeùiÚ
 
	g_rightTuº
[
NDIRECTION
] = {
EAST
, 
WEST
, 
SOUTH
, 
NORTH
};

136 
	$aboutFaû
() {

137 
M
->
	`dœIs
(
_aboutFaû
[
MY_DIR
]);

138 
upd©eV›w
 = 
TRUE
;

139 
	}
}

143 
	$ËáTuº
() {

144 
M
->
	`dœIs
(
_ËáTuº
[
MY_DIR
]);

145 
upd©eV›w
 = 
TRUE
;

146 
	}
}

150 
	$rightTuº
() {

151 
M
->
	`dœIs
(
_rightTuº
[
MY_DIR
]);

152 
upd©eV›w
 = 
TRUE
;

153 
	}
}

159 
	$fÜw¬d
() {

160 
tx
 = 
MY_X_LOC
;

161 
ty
 = 
MY_Y_LOC
;

163 
MY_DIR
) {

164 
NORTH
:

165 ià(!
M
->
maze_
[
tx
 + 1][
ty
])

166 
tx
++;

168 
SOUTH
:

169 ià(!
M
->
maze_
[
tx
 - 1][
ty
])

170 
tx
--;

172 
EAST
:

173 ià(!
M
->
maze_
[
tx
][
ty
 + 1])

174 
ty
++;

176 
WEST
:

177 ià(!
M
->
maze_
[
tx
][
ty
 - 1])

178 
ty
--;

181 
	`MWE¼Ü
("bad direction in Forward");

183 ià((
MY_X_LOC
 !ğ
tx
è|| (
MY_Y_LOC
 !ğ
ty
)) {

184 
M
->
	`xlocIs
(
	`Loc
(
tx
));

185 
M
->
	`ylocIs
(
	`Loc
(
ty
));

186 
upd©eV›w
 = 
TRUE
;

188 
	}
}

192 
	$backw¬d
() {

193 
tx
 = 
MY_X_LOC
;

194 
ty
 = 
MY_Y_LOC
;

196 
MY_DIR
) {

197 
NORTH
:

198 ià(!
M
->
maze_
[
tx
 - 1][
ty
])

199 
tx
--;

201 
SOUTH
:

202 ià(!
M
->
maze_
[
tx
 + 1][
ty
])

203 
tx
++;

205 
EAST
:

206 ià(!
M
->
maze_
[
tx
][
ty
 - 1])

207 
ty
--;

209 
WEST
:

210 ià(!
M
->
maze_
[
tx
][
ty
 + 1])

211 
ty
++;

214 
	`MWE¼Ü
("bad direction in Backward");

216 ià((
MY_X_LOC
 !ğ
tx
è|| (
MY_Y_LOC
 !ğ
ty
)) {

217 
M
->
	`xlocIs
(
	`Loc
(
tx
));

218 
M
->
	`ylocIs
(
	`Loc
(
ty
));

219 
upd©eV›w
 = 
TRUE
;

221 
	}
}

225 
	$³ekLeá
() {

226 
M
->
	`xP“kIs
(
MY_X_LOC
);

227 
M
->
	`yP“kIs
(
MY_Y_LOC
);

228 
M
->
	`dœP“kIs
(
MY_DIR
);

230 
MY_DIR
) {

231 
NORTH
:

232 ià(!
M
->
maze_
[
MY_X_LOC
 + 1][
MY_Y_LOC
]) {

233 
M
->
	`xP“kIs
(
MY_X_LOC
 + 1);

234 
M
->
	`dœP“kIs
(
WEST
);

238 
SOUTH
:

239 ià(!
M
->
maze_
[
MY_X_LOC
 - 1][
MY_Y_LOC
]) {

240 
M
->
	`xP“kIs
(
MY_X_LOC
 - 1);

241 
M
->
	`dœP“kIs
(
EAST
);

245 
EAST
:

246 ià(!
M
->
maze_
[
MY_X_LOC
][
MY_Y_LOC
 + 1]) {

247 
M
->
	`yP“kIs
(
MY_Y_LOC
 + 1);

248 
M
->
	`dœP“kIs
(
NORTH
);

252 
WEST
:

253 ià(!
M
->
maze_
[
MY_X_LOC
][
MY_Y_LOC
 - 1]) {

254 
M
->
	`yP“kIs
(
MY_Y_LOC
 - 1);

255 
M
->
	`dœP“kIs
(
SOUTH
);

260 
	`MWE¼Ü
("bad direction in PeekLeft");

265 ià((
M
->
	`xP“k
(è!ğ
MY_X_LOC
è|| (M->
	`yP“k
(è!ğ
MY_Y_LOC
)) {

266 
M
->
	`³ekšgIs
(
TRUE
);

267 
upd©eV›w
 = 
TRUE
;

269 
	}
}

273 
	$³ekRight
() {

274 
M
->
	`xP“kIs
(
MY_X_LOC
);

275 
M
->
	`yP“kIs
(
MY_Y_LOC
);

276 
M
->
	`dœP“kIs
(
MY_DIR
);

278 
MY_DIR
) {

279 
NORTH
:

280 ià(!
M
->
maze_
[
MY_X_LOC
 + 1][
MY_Y_LOC
]) {

281 
M
->
	`xP“kIs
(
MY_X_LOC
 + 1);

282 
M
->
	`dœP“kIs
(
EAST
);

286 
SOUTH
:

287 ià(!
M
->
maze_
[
MY_X_LOC
 - 1][
MY_Y_LOC
]) {

288 
M
->
	`xP“kIs
(
MY_X_LOC
 - 1);

289 
M
->
	`dœP“kIs
(
WEST
);

293 
EAST
:

294 ià(!
M
->
maze_
[
MY_X_LOC
][
MY_Y_LOC
 + 1]) {

295 
M
->
	`yP“kIs
(
MY_Y_LOC
 + 1);

296 
M
->
	`dœP“kIs
(
SOUTH
);

300 
WEST
:

301 ià(!
M
->
maze_
[
MY_X_LOC
][
MY_Y_LOC
 - 1]) {

302 
M
->
	`yP“kIs
(
MY_Y_LOC
 - 1);

303 
M
->
	`dœP“kIs
(
NORTH
);

308 
	`MWE¼Ü
("bad direction in PeekRight");

313 ià((
M
->
	`xP“k
(è!ğ
MY_X_LOC
è|| (M->
	`yP“k
(è!ğ
MY_Y_LOC
)) {

314 
M
->
	`³ekšgIs
(
TRUE
);

315 
upd©eV›w
 = 
TRUE
;

317 
	}
}

321 
	$³ekStİ
() {

322 
M
->
	`³ekšgIs
(
FALSE
);

323 
upd©eV›w
 = 
TRUE
;

324 
	}
}

328 
	$shoÙ
() {

331 
	}
}

335 
	$şßk
() {

336 
	`´štf
("Implement cloak()\n");

337 
	}
}

346 
	$qu™
(
sig
) {

348 
	`StİWšdow
();

349 
	`ex™
(0);

350 
	}
}

354 
	$NewPos™iÚ
(
Mazew¬In¡ªû
::
PŒ
 
m
) {

355 
Loc
 
	`ÃwX
(0);

356 
Loc
 
	`ÃwY
(0);

357 
DœeùiÚ
 
	`dœ
(0);

359 
M
->
maze_
[
ÃwX
.
	`v®ue
()][
ÃwY
.value()]) {

361 
ÃwX
 = 
	`Loc
(
	`¿ndom
(è& (
MAZEXMAX
 - 1));

362 
ÃwY
 = 
	`Loc
(
	`¿ndom
(è& (
MAZEYMAX
 - 1));

370 ià(!
m
->
maze_
[(
ÃwX
.
	`v®ue
()è+ 1][(
ÃwY
.value())])

371 
dœ
 = 
	`DœeùiÚ
(
NORTH
);

372 ià(!
m
->
maze_
[(
ÃwX
.
	`v®ue
()è- 1][(
ÃwY
.value())])

373 
dœ
 = 
	`DœeùiÚ
(
SOUTH
);

374 ià(!
m
->
maze_
[(
ÃwX
.
	`v®ue
())][(
ÃwY
.value()) + 1])

375 
dœ
 = 
	`DœeùiÚ
(
EAST
);

376 ià(!
m
->
maze_
[(
ÃwX
.
	`v®ue
())][(
ÃwY
.value()) - 1])

377 
dœ
 = 
	`DœeùiÚ
(
WEST
);

379 
m
->
	`xlocIs
(
ÃwX
);

380 
m
->
	`ylocIs
(
ÃwY
);

381 
m
->
	`dœIs
(
dœ
);

382 
	}
}

386 
	$MWE¼Ü
(*
s
)

389 
	`StİWšdow
();

390 
	`årštf
(
¡d”r
, "CS244BMazeW¬: %s\n", 
s
);

391 
	`³¼Ü
("CS244BMazeWar");

392 
	`ex™
(-1);

393 
	}
}

398 
ScÜe
 
	$G‘R©ScÜe
(
R©IndexTy³
 
¿tId
) {

399 ià(
¿tId
.
	`v®ue
(è=ğ
M
->
	`myR©Id
().value()) {

400  (
M
->
	`scÜe
());

404 
	}
}

409 *
	$G‘R©Name
(
R©IndexTy³
 
¿tIndex
) {

410 ià(
¿tIndex
.
	`v®ue
(è=ğ
M
->
	`myIndex
().value()) {

411  (
M
->
myName_
);

413  
M
->
	`¿t
(
¿tIndex
).
Name
;

416 
	}
}

421 
	$CÚv”tIncomšg
(
MW244BPack‘
 *
p
è{
	}
}

426 
	$CÚv”tOutgošg
(
MW244BPack‘
 *
p
è{
	}
}

431 
	$¿tS‹s
() {

434 
	}
}

439 
	$mªageMisses
() {

447 
	}
}

451 
	$DoV›wUpd©e
() {

452 ià(
upd©eV›w
) {

453 
	`ShowPos™iÚ
(
MY_X_LOC
, 
MY_Y_LOC
, 
MY_DIR
);

454 ià(
M
->
	`³ekšg
())

455 
	`ShowV›w
(
M
->
	`xP“k
(), M->
	`yP“k
(), M->
	`dœP“k
());

457 
	`ShowV›w
(
MY_X_LOC
, 
MY_Y_LOC
, 
MY_DIR
);

458 
upd©eV›w
 = 
FALSE
;

460 
	}
}

473 
	$£ndPack‘ToPÏy”
(
R©Id
 
¿tId
) {

491 
	}
}

497 
	$´oûssPack‘
(
MWEv’t
 *
ev’tPack‘
) {

509 
	}
}

517 
	$ÃtIn™
() {

518 
Sockaddr
 
nuÎAddr
;

519 
Sockaddr
 *
thisHo¡
;

520 
buf
[128];

521 
»u£
;

522 
u_ch¬
 
‰l
;

523 
_m»q
 
m»q
;

526 
M
->
	`mazePÜtIs
(
	`htÚs
(
MAZEPORT
));

528 
	`g‘ho¡Çme
(
buf
, (buf));

529 ià((
thisHo¡
 = 
	`»sŞveHo¡
(
buf
)è=ğ(
Sockaddr
 *)
NULL
)

530 
	`MWE¼Ü
("who‡m I?");

531 
	`bcİy
((
ÿddr_t
)
thisHo¡
, (ÿddr_t)(
M
->
	`myAddr
()), (
Sockaddr
));

533 
M
->
	`theSock‘Is
(
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0));

534 ià(
M
->
	`theSock‘
() < 0)

535 
	`MWE¼Ü
("can't get socket");

540 
»u£
 = 1;

541 ià(
	`£tsockİt
(
M
->
	`theSock‘
(), 
SOL_SOCKET
, 
SO_REUSEADDR
, &
»u£
,

542 (
»u£
)) < 0) {

543 
	`MWE¼Ü
("setsockopt failed (SO_REUSEADDR)");

546 
nuÎAddr
.
sš_çmy
 = 
AF_INET
;

547 
nuÎAddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

548 
nuÎAddr
.
sš_pÜt
 = 
M
->
	`mazePÜt
();

549 ià(
	`bšd
(
M
->
	`theSock‘
(), (
sockaddr
 *)&
nuÎAddr
, (nullAddr)) < 0)

550 
	`MWE¼Ü
("netInit binding");

564 
‰l
 = 1;

565 ià(
	`£tsockİt
(
M
->
	`theSock‘
(), 
IPPROTO_IP
, 
IP_MULTICAST_TTL
, &
‰l
,

566 (
‰l
)) < 0) {

567 
	`MWE¼Ü
("setsockopt failed (IP_MULTICAST_TTL)");

571 
m»q
.
imr_muÉŸddr
.
s_addr
 = 
	`htÚl
(
MAZEGROUP
);

572 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

573 ià(
	`£tsockİt
(
M
->
	`theSock‘
(), 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, (*)&
m»q
,

574 (
m»q
)) < 0) {

575 
	`MWE¼Ü
("setsockopt failed (IP_ADD_MEMBERSHIP)");

582 
	`´štf
("\n");

585 
M
->
	`myR©IdIs
(
	`htÚl
(
thisHo¡
->
sš_addr
.
s_addr
));

586 
M
->
	`scÜeIs
(0);

587 
	`S‘MyR©IndexTy³
(0);

588 
M
->
AÎR©s
.
	`š£¹
({M->
	`myIndex
(), M->
	`myR©Id
()});

592 
	`memıy
(&
groupAddr
, &
nuÎAddr
, (
Sockaddr
));

593 
groupAddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
MAZEGROUP
);

594 
	}
}

	@winsys.cpp

37 
	#USE_BITMAPS


	)

39 
	~<X11/SŒšgDefs.h
>

40 
	~<X11/X©om.h
>

41 
	~<X11/Xlib.h
>

42 
	~<X11/Xos.h
>

43 
	~<X11/X»sourû.h
>

44 
	~<X11/Xut.h
>

46 
	~"maš.h
"

48 
	~"mazew¬.h
"

50 
	~<X11/IÁršsic.h
>

51 
	~<X11/Xaw/C¬dš®s.h
>

53 
	#VIEW_X_DIM
 400

	)

54 
	#VIEW_Y_DIM
 400

	)

55 
	#VIEW_X_ORIGIN
 100

	)

56 
	#VIEW_Y_ORIGIN
 50

	)

57 
	#MAZE_X_DIM
 (
MAZEXMAX
 * 16)

	)

58 
	#MAZE_Y_DIM
 (
MAZEYMAX
 * 16)

	)

59 
	#MAZE_X_ORIGIN
 48

	)

60 
	#MAZE_Y_ORIGIN
 451

	)

61 
	#SCORE_X_DIM
 192

	)

62 
	#SCORE_Y_DIM
 \

63 ((
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 + scÜeFÚtInfo->max_bounds.
desûÁ
) * \

64 
MAX_RATS
)

	)

65 
	#SCORE_X_ORIGIN
 208

	)

66 
	#SCORE_Y_ORIGIN
 708

	)

67 
	#MIN_X_DIM
 608

	)

68 
	#MIN_Y_DIM
 
SCORE_Y_ORIGIN


	)

70 
	#DEFAULT_FONT
 "8x13"

	)

71 
	#DEFAULT_POSITION
 "%dx%d+0+0"

	)

73 
	#ICON_FLASH_PERIOD
 4

	)

75 
	gmazeB™s
[
MAZEXMAX
 * 
MAZEYMAX
 * 16];

76 
Wšdow
 
	gmwWšdow
;

77 #ifdeà
USE_BITMAPS


78 
Pixm­
 
	gmazeB™m­
;

79 
Pixm­
 
	g¿tsB™m­
;

81 
XImage
 *
	g¿tsImage
;

82 
XImage
 *
	gmazeImage
;

84 
Pixm­
 
	gicÚMask
;

85 
XFÚtSŒuù
 *
	gscÜeFÚtInfo
;

86 
boŞ
 
	gm­³d
 = 
FALSE
;

87 
boŞ
 
	gæashIcÚ
 = 
FALSE
;

88 
boŞ
 
	gicÚInv”‹d
 = 
FALSE
;

89 
	gdi¥ÏyFD
;

91 
Di¥Ïy
 *
	gdpy
;

92 
	gsü“n
;

93 
	gcur_width
, 
	gcur_height
;

94 
GC
 
	gcİyGC
, 
	gxÜGC
;

95 
Pixm­
 
	gicÚ_pixm­
, 
	gicÚmask_pixm­
;

96 
Pixm­
 
	gicÚ_»v”£_pixm­
;

97 
	gicÚ_æash
 = 0;

98 
XImage
 *
	g¬rowImage
;

100 
	~"b™m­s/cup.cur
"

101 
	~"b™m­s/dR©.cur
"

102 
	~"b™m­s/dR©Mask.cur
"

103 
	~"b™m­s/icÚ.ic
"

104 
	~"b™m­s/¿t.cur
"

105 
	~"b™m­s/¿tMask.cur
"

107 
CursÜ
 
	g¿tCursÜ
, 
	gd—dR©CursÜ
, 
	ghourGÏssCursÜ
;

109 *
	g´ogName
;

111 
XtAµCÚ‹xt
 
	g­p_cÚ
;

113 
	s_»sourûs
 {

114 
Pix–
 
	mfg_pix–
;

115 
Pix–
 
	mbg_pix–
;

116 
Pix–
 
	mmou£ground
;

117 
FÚt
 
	mscÜeFÚt
;

118 
Pix–
 
	mbÜd”CŞÜ
;

119 
C¬dš®
 
	mbÜd”Width
;

121 
	mtime_š‹rv®
;

122 
boŞ
 
	mrobÙic
;

123 } 
	g­p_»sourûs
;

125 
SŒšg
 
	gdeçuÉ_»sourûs
[] = {

128 
NULL
,

131 
XrmO±iÚDescRec
 
	gİTabË
[] = {

132 {"-mou£", "*mou£CŞÜ", 
XrmİtiÚS•Arg
, (
ÿddr_t
)
NULL
},

133 {"-time_š‹rv®", "*time_š‹rv®", 
XrmİtiÚS•Arg
, (
ÿddr_t
)
NULL
},

136 
	#XtNmou£
 "mou£"

	)

138 
	gz”o
 = 0;

139 
	gÚe
 = 1;

140 cÚ¡ *
	gbÏh
;

142 
	#off£t
(
f›ld
è
	`XtOff£t
(
_»sourûs
 *, f›ld)

	)

143 
XtResourû
 
	g»sourûs
[] = {

144 {"time_š‹rv®", "Time_IÁ”v®", 
XtRIÁ
, (),

145 
off£t
(
time_š‹rv®
), 
XtRSŒšg
, 
¡rdup
("500")},

146 {
XtNfÜeground
, 
XtCFÜeground
, 
XtRPix–
, (
Pix–
), 
off£t
(
fg_pix–
),

147 
XtRSŒšg
, 
¡rdup
("black")},

148 {
XtNbackground
, 
XtCBackground
, 
XtRPix–
, (
Pix–
), 
off£t
(
bg_pix–
),

149 
XtRSŒšg
, 
¡rdup
("white")},

150 {
XtNmou£
, 
XtCCursÜ
, 
XtRPix–
, (
Pix–
), 
off£t
(
mou£ground
),

151 
XtRSŒšg
, 
¡rdup
("black")},

152 {
XtNfÚt
, 
XtCFÚt
, 
XtRFÚt
, (
FÚt
), 
off£t
(
scÜeFÚt
), 
XtRSŒšg
,

153 
¡rdup
(
DEFAULT_FONT
)},

154 {
XtNbÜd”Width
, 
XtCBÜd”Width
, 
XtRIÁ
, (), 
off£t
(
bÜd”Width
),

155 
XtRIÁ
, (
ÿddr_t
)(*)&
Úe
},

156 {
XtNbÜd”
, 
XtCBÜd”CŞÜ
, 
XtRPix–
, (
Pix–
), 
off£t
(
bÜd”CŞÜ
),

157 
XtRSŒšg
, 
¡rdup
("black")},

159 #undeà
off£t


161 *
G‘R©Name
();

163 
RªdomEv’t
();

164 
š™CursÜs
();

165 
š™Maze
();

166 
š™R©s
(
width
, 
height
);

167 
d¿wMaze
();

168 
»·štWšdow
();

169 
»·štIcÚ
();

170 
Pixm­
 
xC»©eB™m­FromB™C–l
(
Di¥Ïy
 *, 
D¿wabË
, *,

194 
	$In™Wšdow
(
¬gc
, **
¬gv
) {

195 
XGCV®ues
 
gc_v®ues
;

196 
XWMHšts
 
wmhšts
;

197 
Widg‘
 
w
;

198 
XCÏssHšt
 
şassHšt
;

199 
GC
 
icÚGC
;

201 
´ogName
 = (*)
	`ršdex
(
¬gv
[0], '/');

202 ià(
´ogName
)

203 
´ogName
++;

205 
´ogName
 = 
¬gv
[0];

212 
w
 = 
	`XtAµIn™Ÿlize
(&
­p_cÚ
, 
´ogName
, 
İTabË
, 
	`XtNumb”
(İTabË), &
¬gc
,

213 
¬gv
, 
deçuÉ_»sourûs
, 
NULL
, 
ZERO
);

215 ià((
¬gc
 > 1è&& (
	`¡rcmp
("-robÙ", 
¬gv
[1]) == 0)) {

216 
¬gc
--;

217 
­p_»sourûs
.
robÙic
 = 
TRUE
;

219 
­p_»sourûs
.
robÙic
 = 
FALSE
;

222 
	`´štf
("set„obot. ");

223 
dpy
 = 
	`XtDi¥Ïy
(
w
);

224 
sü“n
 = 
	`DeçuÉSü“n
(
dpy
);

226 
	`´štf
("set Xscreen. ");

228 
	`XtG‘AµliÿtiÚResourûs
(
w
, (
ÿddr_t
)&
­p_»sourûs
, 
»sourûs
,

229 
	`XtNumb”
(
»sourûs
), 
NULL
, (
C¬dš®
)0);

231 
	`´štf
("set XResource. ");

233 ià(!
­p_»sourûs
.
scÜeFÚt
)

234 
	`MWE¼Ü
("cannot open font");

235 
scÜeFÚtInfo
 = 
	`XQu”yFÚt
(
dpy
, 
­p_»sourûs
.
scÜeFÚt
);

237 
	`´štf
("set XQueue. ");

239 
cur_width
 = 
MIN_X_DIM
;

240 
cur_height
 = 
MIN_Y_DIM
 +

241 (
MAX_RATS
 + 1è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

242 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
);

244 
mwWšdow
 = 
	`XC»©eSim¶eWšdow
(
dpy
, 
	`RoÙWšdow
(dpy, 
sü“n
), 0, 0, 
cur_width
,

245 
cur_height
, 
­p_»sourûs
.
bÜd”Width
, 0,

246 
­p_»sourûs
.
bg_pix–
);

247 
	`XStÜeName
(
dpy
, 
mwWšdow
, "MazeWar");

248 
	`XS‘IcÚName
(
dpy
, 
mwWšdow
, "MazeWar");

249 
şassHšt
.
»s_Çme
 = "cs244Bmazewar";

250 
şassHšt
.
»s_şass
 = "cs244Bmazewar";

251 
	`XS‘CÏssHšt
(
dpy
, 
mwWšdow
, &
şassHšt
);

253 
gc_v®ues
.
funùiÚ
 = 
GXcİy
;

254 
gc_v®ues
.
fÜeground
 = 
­p_»sourûs
.
fg_pix–
;

255 
gc_v®ues
.
background
 = 
­p_»sourûs
.
bg_pix–
;

256 
gc_v®ues
.
fÚt
 = 
­p_»sourûs
.
scÜeFÚt
;

257 
gc_v®ues
.
lše_width
 = 0;

258 
cİyGC
 = 
	`XC»©eGC
(
dpy
, 
mwWšdow
, 
GCFunùiÚ
 | 
GCFÜeground
 | 
GCBackground
 |

259 
GCLšeWidth
 | 
GCFÚt
,

260 &
gc_v®ues
);

262 
gc_v®ues
.
funùiÚ
 = 
GXxÜ
;

263 
gc_v®ues
.
¶ªe_mask
 = 
AÎPÏÃs
;

264 
gc_v®ues
.
fÜeground
 = 
­p_»sourûs
.
fg_pix–
 ^‡µ_»sourûs.
bg_pix–
;

265 
gc_v®ues
.
background
 = 0;

266 
xÜGC
 = 
	`XC»©eGC
(
dpy
, 
mwWšdow
,

267 
GCFunùiÚ
 | 
GCFÜeground
 | 
GCBackground
 | 
GCPÏÃMask
,

268 &
gc_v®ues
);

270 
icÚ_pixm­
 = 
	`XC»©ePixm­FromB™m­D©a
(

271 
dpy
, 
mwWšdow
, (*)
icÚ_b™s
, 
icÚ_width
, 
icÚ_height
,

272 
­p_»sourûs
.
fg_pix–
,‡µ_»sourûs.
bg_pix–
,

273 
	`XDeçuÉD•th
(
dpy
, 
sü“n
));

276 
gc_v®ues
.
funùiÚ
 = 
GXş—r
;

277 
gc_v®ues
.
¶ªe_mask
 = 
AÎPÏÃs
;

278 
icÚGC
 = 
	`XC»©eGC
(
dpy
, 
mwWšdow
, 
GCFunùiÚ
 | 
GCPÏÃMask
, &
gc_v®ues
);

279 
icÚmask_pixm­
 = 
	`XC»©ePixm­
(
dpy
, 
mwWšdow
, 
icÚ_width
, 
icÚ_height
,

280 
	`XDeçuÉD•th
(
dpy
, 
sü“n
));

281 
	`XFlReùªgË
(
dpy
, 
icÚmask_pixm­
, 
icÚGC
, 0, 0, 
icÚ_width
, 
icÚ_height
);

283 
icÚ_»v”£_pixm­
 = 
	`XC»©ePixm­FromB™m­D©a
(

284 
dpy
, 
mwWšdow
, (*)
icÚ_b™s
, 
icÚ_width
, 
icÚ_height
,

285 
­p_»sourûs
.
bg_pix–
,‡µ_»sourûs.
fg_pix–
,

286 
	`XDeçuÉD•th
(
dpy
, 
sü“n
));

288 
wmhšts
.
šput
 = 
TRUE
;

289 
wmhšts
.
æags
 = 
IcÚPixm­Hšt
 | 
IcÚMaskHšt
 | 
IÅutHšt
;

290 
wmhšts
.
icÚ_pixm­
 = icon_pixmap;

291 
wmhšts
.
icÚ_mask
 = 
icÚmask_pixm­
;

292 
	`XS‘WMHšts
(
dpy
, 
mwWšdow
, &
wmhšts
);

294 
	`š™CursÜs
();

295 
¬rowImage
 = 
	`XC»©eImage
(
dpy
, 
	`DeçuÉVisu®
(dpy, 
	`DeçuÉSü“n
(dpy)), 1,

296 
XYB™m­
, 0, 
NULL
, 16, 16, 8, 2);

297 
¬rowImage
->
by‹_Üd”
 = 
MSBFœ¡
;

298 
¬rowImage
->
b™m­_b™_Üd”
 = 
MSBFœ¡
;

299 
	}
}

307 
	$S¹Wšdow
(
¿tWidth
, 
¿tHeight
) {

309 
	`XS–eùIÅut
(
dpy
, 
mwWšdow
, 
KeyP»ssMask
 | 
Bu‰ÚP»ssMask
 |

310 
Bu‰ÚR–—£Mask
 | 
Exposu»Mask
 |

311 
SŒuùu»NÙifyMask
 | 
FocusChªgeMask
);

312 
	`HourGÏssCursÜ
();

314 
	`š™Maze
();

315 
	`Sw­B™m­s
();

317 
di¥ÏyFD
 = 
	`XCÚÃùiÚNumb”
(
dpy
);

319 
	`XM­Wšdow
(
dpy
, 
mwWšdow
);

320 
	`š™R©s
(
¿tWidth
, 
¿tHeight
);

321 
	}
}

330 
	$CË¬V›w
() {

331 
	`XCË¬A»a
(
dpy
, 
mwWšdow
, 
VIEW_X_ORIGIN
, 
VIEW_Y_ORIGIN
, 
VIEW_X_DIM
,

332 
VIEW_Y_DIM
, 
F®£
);

333 
	}
}

340 
	$D¿wV›wLše
(
x1
, 
y1
, 
x2
, 
y2
) {

341 
	`XD¿wLše
(
dpy
, 
mwWšdow
, 
cİyGC
, 
x1
 + 
VIEW_X_ORIGIN
, 
y1
 + 
VIEW_Y_ORIGIN
,

342 
x2
 + 
VIEW_X_ORIGIN
, 
y2
 + 
VIEW_Y_ORIGIN
);

343 
	}
}

347 
	gTheNextEv’t
 = 0;

349 
	$RªdomEv’t
() {

350 
boŞ
 
visibË
 = 
FALSE
;

351 
R©IndexTy³
 
	`¿tIndex
(0);

352 
choiû
;

354 
choiû
 = 
	`¿ndom
() % 4;

356 ià((
choiû
 =ğ0è|| 
M
->
	`³ekšg
()) {

357 
¿tIndex
 = 
	`R©IndexTy³
(0);„©Index.
	`v®ue
(è< 
MAX_RATS
;

358 
¿tIndex
 = 
	`R©IndexTy³
Ô©Index.
	`v®ue
() + 1)) {

359 ià((
¿tIndex
 !ğ
MY_RAT_INDEX
) &&

360 (
R©s2Di¥Ïy
[
¿tIndex
.
	`v®ue
()].
visibË
 =ğ
TRUE
)) {

361 
visibË
 = 
TRUE
;

367 ià(
TheNextEv’t
 > 0) {

368 
TheNextEv’t
 = -TheNextEvent;

369  (
EVENT_D
);

370 } ià(
TheNextEv’t
 < 0) {

371 
M
->
	`dœIs
(
	`DœeùiÚ
(-
TheNextEv’t
));

372 
TheNextEv’t
 = 0;

373  (
EVENT_BAR
);

374 } ià((
M
->
	`³ekšg
()è&& (
visibË
 =ğ
TRUE
)) {

375 
TheNextEv’t
 = 
M
->
	`dœP“k
().
	`v®ue
();

376  (
EVENT_LEFT_U
);

377 } ià((
M
->
	`³ekšg
()è&& (
choiû
 != 2)) {

378  (
EVENT_LEFT_U
);

379 } ià(
visibË
 =ğ
TRUE
) {

380  (
EVENT_BAR
);

381 } ià(
	`em±yAh—d
(è&& 
choiû
 != 2) {

382  (
EVENT_D
);

383 } ià(
	`em±yRight
()) {

384  (
EVENT_F
);

385 } ià(
	`em±yLeá
()) {

386  (
EVENT_S
);

387 } ià((
choiû
 !ğ2è&& (
	`em±yBehšd
())) {

388  (
EVENT_A
);

390  (
EVENT_LEFT_D
 + (
	`¿ndom
() % 2));

392 
	}
}

413 
	$NextEv’t
(
MWEv’t
 *
ev’t
, 
sock‘
) {

414 
fd_£t
 
fdmask
;

415 
XEv’t
 
xev
;

416 
Ãx‰imeoutš™Ÿlized
 = 0;

417 
timev®
 
Ãx‰imeout
;

418 
timev®
 
timeout
, 
Şdtime
, 
Ãwtime
;

419 
»t
;

420 
c
;

422 ià(!
Ãx‰imeoutš™Ÿlized
) {

423 
Ãx‰imeoutš™Ÿlized
 = 1;

424 
Ãx‰imeout
.
tv_£c
 = 
­p_»sourûs
.
time_š‹rv®
 / 1000;

425 
Ãx‰imeout
.
tv_u£c
 = 1000 * (
­p_»sourûs
.
time_š‹rv®
 % 1000);

428 
icÚ_æash
 = (++icÚ_æashè% 
ICON_FLASH_PERIOD
;

430 ià(!
	`XP’dšg
(
dpy
))

431 ià(
æashIcÚ
 && !
icÚ_æash
 && !
m­³d
) {

433 
icÚInv”‹d
 = !iconInverted;

434 
	`»·štIcÚ
();

455 ià(!
	`XP’dšg
(
dpy
)) {

456 
	`FD_ZERO
(&
fdmask
);

457 
	`FD_SET
(
di¥ÏyFD
, &
fdmask
);

458 
	`FD_SET
(
sock‘
, &
fdmask
);

459 
»t
 = 0;„et <= 0;) {

460 ià((
Ãx‰imeout
.
tv_£c
 < 0) ||

461 ((
Ãx‰imeout
.
tv_£c
 =ğ0è&& (Ãx‰imeout.
tv_u£c
 <= 0))) {

462 
Ãx‰imeout
.
tv_£c
 = 
­p_»sourûs
.
time_š‹rv®
 / 1000;

463 
Ãx‰imeout
.
tv_u£c
 = 1000 * (
­p_»sourûs
.
time_š‹rv®
 % 1000);

464 ià(
­p_»sourûs
.
robÙic
 =ğ
TRUE
) {

465 
ev’t
->
ev’tTy³
 = 
	`RªdomEv’t
();

469 
timeout
.
tv_£c
 = 
Ãx‰imeout
.tv_sec;

470 
timeout
.
tv_u£c
 = 
Ãx‰imeout
.tv_usec;

471 
	`g‘timeofday
(&
Şdtime
, 0);

472 
»t
 = 
	`£Ëù
(32, &
fdmask
, 
NULL
, NULL, &
timeout
);

473 
	`g‘timeofday
(&
Ãwtime
, 0);

474 
Ãx‰imeout
.
tv_£c
 -ğ
Ãwtime
.tv_£ø- 
Şdtime
.tv_sec;

475 
Ãx‰imeout
.
tv_u£c
 -ğ
Ãwtime
.tv_u£ø- 
Şdtime
.tv_usec;

476 ià(
Ãx‰imeout
.
tv_u£c
 < 0) {

477 
Ãx‰imeout
.
tv_£c
--;

478 
Ãx‰imeout
.
tv_u£c
 += 1000000;

480 ià(
»t
 == -1) {

481 ià(
”ºo
 !ğ
EINTR
)

482 
	`MWE¼Ü
("selectƒrror onƒvents");

483 } ià(
»t
 == 0) {

484 
Ãx‰imeout
.
tv_£c
 = 
­p_»sourûs
.
time_š‹rv®
 / 1000;

485 
Ãx‰imeout
.
tv_u£c
 = 1000 * (
­p_»sourûs
.
time_š‹rv®
 % 1000);

486 ià(
­p_»sourûs
.
robÙic
 =ğ
TRUE
)

487 
ev’t
->
ev’tTy³
 = 
	`RªdomEv’t
();

489 
ev’t
->
ev’tTy³
 = 
EVENT_TIMEOUT
;

494 
	`FD_ZERO
(&
fdmask
);

495 
	`FD_SET
(
sock‘
, &
fdmask
);

496 
timeout
.
tv_£c
 = 0;

497 
timeout
.
tv_u£c
 = 0;

498 (
»t
 = 
	`£Ëù
(32, &
fdmask
, 
NULL
, NULL, &
timeout
)) == -1)

499 ià(
”ºo
 !ğ
EINTR
)

500 
	`MWE¼Ü
("selectƒrror onƒvents");

502 ià(
	`XP’dšg
(
dpy
)) {

503 
	`XNextEv’t
(
dpy
, &
xev
);

504 
xev
.
ty³
) {

505 
KeyP»ss
:

506 
ev’t
->
ev’tTy³
 = 0;

507 
	`XLookupSŒšg
((
XKeyEv’t
 *)&
xev
, &
c
, 1, 
NULL
, NULL);

509 
c
) {

512 
ev’t
->
ev’tTy³
 = 
EVENT_A
;

517 
ev’t
->
ev’tTy³
 = 
EVENT_S
;

522 
ev’t
->
ev’tTy³
 = 
EVENT_D
;

527 
ev’t
->
ev’tTy³
 = 
EVENT_F
;

531 
ev’t
->
ev’tTy³
 = 
EVENT_G
;

535 
ev’t
->
ev’tTy³
 = 
EVENT_C
;

540 
ev’t
->
ev’tTy³
 = 
EVENT_BAR
;

546 
ev’t
->
ev’tTy³
 = 
EVENT_INT
;

551 
	#RightBu‰Ú
 
Bu‰Ú3


	)

552 
	#MiddËBu‰Ú
 
Bu‰Ú2


	)

553 
	#LeáBu‰Ú
 
Bu‰Ú1


	)

554 
Bu‰ÚP»ss
:

555 
ev’t
->
ev’tTy³
 = 0;

556 ((
XBu‰ÚP»s£dEv’t
 *)&
xev
)->
bu‰Ú
 & 0xff) {

557 
RightBu‰Ú
:

558 
ev’t
->
ev’tTy³
 = 
EVENT_RIGHT_D
;

561 
MiddËBu‰Ú
:

562 
ev’t
->
ev’tTy³
 = 
EVENT_MIDDLE_D
;

565 
LeáBu‰Ú
:

566 
ev’t
->
ev’tTy³
 = 
EVENT_LEFT_D
;

571 
Bu‰ÚR–—£
:

572 
ev’t
->
ev’tTy³
 = 0;

573 ((
XBu‰ÚR–—£dEv’t
 *)&
xev
)->
bu‰Ú
 & 0xff) {

574 
RightBu‰Ú
:

575 
ev’t
->
ev’tTy³
 = 
EVENT_RIGHT_U
;

578 
LeáBu‰Ú
:

579 
ev’t
->
ev’tTy³
 = 
EVENT_LEFT_U
;

584 
Expo£
:

585 
	`»·štWšdow
();

588 
FocusIn
:

589 
M­NÙify
:

590 
m­³d
 = 
TRUE
;

591 
icÚInv”‹d
 = 
FALSE
;

592 
æashIcÚ
 = 
FALSE
;

593 
	`»·štIcÚ
();

596 
FocusOut
:

597 
Unm­NÙify
:

598 
m­³d
 = 
FALSE
;

603 ià(
	`FD_ISSET
(
sock‘
, &
fdmask
)) {

604 
sockËn_t
 
äomL’
 = (
ev’t
->
ev’tSourû
);

605 
cc
;

607 
ev’t
->
ev’tTy³
 = 
EVENT_NETWORK
;

608 
cc
 = 
	`»cväom
(
sock‘
, (*)
ev’t
->
ev’tD‘a
, (
MW244BPack‘
), 0,

609 (
sockaddr
 *)&
ev’t
->
ev’tSourû
, &
äomL’
);

610 ià(
cc
 <= 0) {

611 ià(
cc
 < 0 && 
”ºo
 !ğ
EINTR
)

612 
	`³¼Ü
("event„ecvfrom");

615 ià(
äomL’
 !ğ(
sockaddr_š
))

617 
	`CÚv”tIncomšg
(
ev’t
->
ev’tD‘a
);

621 
	}
}

631 
boŞ
 
	$KBEv’tP’dšg
(è{  (
	`XP’dšg
(
dpy
è!ğ0); 
	}
}

637 
	$HourGÏssCursÜ
() {

638 
	`XDefšeCursÜ
(
dpy
, 
mwWšdow
, 
hourGÏssCursÜ
);

639 
	`XFlush
(
dpy
);

640 
	}
}

645 
	$R©CursÜ
() {

646 
	`XDefšeCursÜ
(
dpy
, 
mwWšdow
, 
¿tCursÜ
);

647 
	`XFlush
(
dpy
);

648 
	}
}

653 
	$D—dR©CursÜ
() {

654 
	`XDefšeCursÜ
(
dpy
, 
mwWšdow
, 
d—dR©CursÜ
);

655 
	`XFlush
(
dpy
);

656 
	}
}

665 
	$HackMazeB™m­
(
Loc
 
x
, Loø
y
, 
B™C–l
 *
ÃwB™s
) {

666 
¬rowImage
->
d©a
 = (*)
ÃwB™s
;

667 
	`XPutImage
(
dpy
, 
mwWšdow
, 
cİyGC
, 
¬rowImage
, 0, 0,

668 
x
.
	`v®ue
(è* 16 + 
MAZE_X_ORIGIN
, 
y
.v®ue(è* 16 + 
MAZE_Y_ORIGIN
, 16,

670 
	}
}

679 
	$Di¥ÏyR©B™m­
(
sü“nX
, 
sü“nY
, 
width
, 
height
, 
¤cX
,

680 
¤cY
) {

681 #ifdeà
USE_BITMAPS


682 
	`XCİyPÏÃ
(
dpy
, 
¿tsB™m­
, 
mwWšdow
, 
xÜGC
, 
¤cX
, 
¤cY
, 
width
, 
height
,

683 
sü“nX
 + 
VIEW_X_ORIGIN
, 
sü“nY
 + 
VIEW_Y_ORIGIN
, 1);

685 
	`XPutImage
(
dpy
, 
mwWšdow
, 
xÜGC
, 
¿tsImage
, 
¤cX
, 
¤cY
,

686 
sü“nX
 + 
VIEW_X_ORIGIN
, 
sü“nY
 + 
VIEW_Y_ORIGIN
, 
width
, 
height
);

688 
	}
}

697 
	$Wr™eScÜeSŒšg
(
R©IndexTy³
 
¿t
) {

698 
buf
[64];

699 
ËáEdge
;

701 
	`¥rštf
(
buf
, "%d", ()
	`G‘R©ScÜe
(
¿t
).
	`v®ue
());

703 
	`XCË¬A»a
(
dpy
, 
mwWšdow
, 
SCORE_X_ORIGIN
,

704 
SCORE_Y_ORIGIN
 +

705 
¿t
.
	`v®ue
(è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

706 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
),

707 
SCORE_X_DIM
, (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

708 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
),

709 
FALSE
);

710 
	`XD¿wImageSŒšg
(
dpy
, 
mwWšdow
, 
cİyGC
, 
SCORE_X_ORIGIN
,

711 
SCORE_Y_ORIGIN
 +

712 
¿t
.
	`v®ue
(è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

713 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
) +

714 
scÜeFÚtInfo
->
max_bounds
.
asûÁ
,

715 
	`G‘R©Name
(
¿t
), 
	`¡¾’
(GetRatName(rat)));

716 
ËáEdge
 = 
SCORE_X_DIM
 - 
	`XTextWidth
(
scÜeFÚtInfo
, 
buf
, 
	`¡¾’
(buf));

717 
	`XD¿wImageSŒšg
(
dpy
, 
mwWšdow
, 
cİyGC
, 
ËáEdge
 + 
SCORE_X_ORIGIN
,

718 
SCORE_Y_ORIGIN
 +

719 
¿t
.
	`v®ue
(è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

720 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
) +

721 
scÜeFÚtInfo
->
max_bounds
.
asûÁ
,

722 
buf
, 
	`¡¾’
(buf));

723 
	}
}

730 
	$CË¬ScÜeLše
(
R©IndexTy³
 
¿t
) {

731 
	`XCË¬A»a
(
dpy
, 
mwWšdow
, 
SCORE_X_ORIGIN
,

732 
SCORE_Y_ORIGIN
 +

733 
¿t
.
	`v®ue
(è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

734 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
),

735 
SCORE_X_DIM
, 
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

736 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
,

737 
F®£
);

738 
	}
}

745 
	$Inv”tScÜeLše
(
R©IndexTy³
 
¿t
) {

746 
	`XFlReùªgË
(
dpy
, 
mwWšdow
, 
xÜGC
, 
SCORE_X_ORIGIN
,

747 
SCORE_Y_ORIGIN
 +

748 
¿t
.
	`v®ue
(è* (
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

749 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
),

750 
SCORE_X_DIM
, 
scÜeFÚtInfo
->
max_bounds
.
asûÁ
 +

751 
scÜeFÚtInfo
->
max_bounds
.
desûÁ
);

752 
	}
}

762 
	$NÙifyPÏy”
(è{ 
æashIcÚ
 = 
TRUE
; 
	}
}

771 
	$š™CursÜs
() {

772 
Pixm­
 
p
, 
m
;

773 
XCŞÜ
 
mc
, 
bc
;

775 
mc
.
pix–
 = 
­p_»sourûs
.
mou£ground
;

776 
bc
.
pix–
 = 
­p_»sourûs
.
bg_pix–
;

777 
mc
.
æags
 = 
DoRed
 | 
DoG»’
 | 
DoBlue
;

778 
bc
.
æags
 = 
DoRed
 | 
DoG»’
 | 
DoBlue
;

779 
	`XQu”yCŞÜ
(
dpy
, 
	`DeçuÉCŞÜm­
(dpy, 
sü“n
), &
mc
);

780 
	`XQu”yCŞÜ
(
dpy
, 
	`DeçuÉCŞÜm­
(dpy, 
sü“n
), &
bc
);

782 
m
 = 
	`XC»©eB™m­FromD©a
(
dpy
, 
mwWšdow
, (*)
¿tMask_b™s
, 
¿tMask_width
,

783 
¿tMask_height
);

784 
p
 = 
	`XC»©eB™m­FromD©a
(
dpy
, 
mwWšdow
, (*)
¿t_b™s
, 
¿t_width
,

785 
¿t_height
);

786 
¿tCursÜ
 = 
	`XC»©ePixm­CursÜ
(
dpy
, 
p
, 
m
, &
mc
, &
bc
, 
¿t_x_hÙ
, 
¿t_y_hÙ
);

788 
m
 = 
	`XC»©eB™m­FromD©a
(
dpy
, 
mwWšdow
, (*)
dR©Mask_b™s
,

789 
dR©Mask_width
, 
dR©Mask_height
);

790 
p
 = 
	`XC»©eB™m­FromD©a
(
dpy
, 
mwWšdow
, (*)
dR©_b™s
, 
dR©_width
,

791 
dR©_height
);

792 
d—dR©CursÜ
 = 
	`XC»©ePixm­CursÜ
(
dpy
, 
p
, 
m
, &
mc
, &
bc
, 0, 0);

794 
p
 = 
	`XC»©eB™m­FromD©a
(
dpy
, 
mwWšdow
, (*)
cup_b™s
, 
cup_width
,

795 
cup_height
);

796 
hourGÏssCursÜ
 = 
	`XC»©ePixm­CursÜ
(
dpy
, 
p
,…, &
mc
, &
bc
, 0, 0);

797 
	}
}

804 
	$š™Maze
() {

805 
i
, 
j
, 
k
, 
lše
, 
šdex
;

807 
i
 = 0; i < 
MAZEYMAX
; i++) {

808 
lše
 = 
i
 * 
MAZEXMAX
 * 
MAZEYMAX
;

809 
j
 = 0; j < 
MAZEXMAX
; j++) {

810 
šdex
 = 
lše
 + 
j
;

811 
k
 = 0; k < 16; k++) {

812 ià(
M
->
maze_
[
j
][
i
])

813 
mazeB™s
[
šdex
] = 0177777;

815 
mazeB™s
[
šdex
] = 0;

816 
šdex
 += 32;

821 #ifdeà
USE_BITMAPS


822 
mazeB™m­
 = 
	`xC»©eB™m­FromB™C–l
(
dpy
, 
mwWšdow
, (*)
mazeB™s
,

823 
MAZE_X_DIM
, 
MAZE_Y_DIM
);

824 ià(
mazeB™m­
 == 0)

826 
mazeImage
 =

827 
	`XC»©eImage
(
dpy
, 
	`DeçuÉVisu®
(dpy, 
	`DeçuÉSü“n
(dpy)), 1, 
XYB™m­
, 0,

828 
mazeB™s
, 
MAZE_X_DIM
, 
MAZE_Y_DIM
, 8, MAZE_X_DIM >> 3);

829 
mazeImage
->
by‹_Üd”
 = 
MSBFœ¡
;

830 
mazeImage
->
b™m­_b™_Üd”
 = 
MSBFœ¡
;

832 ià(
mazeImage
 == 0)

834 
	`MWE¼Ü
("Can't create maze Pixmap");

835 
	}
}

842 
	$d¿wMaze
() {

843 #ifdeà
USE_BITMAPS


844 
	`XCİyPÏÃ
(
dpy
, 
mazeB™m­
, 
mwWšdow
, 
cİyGC
, 0, 0, 
MAZE_X_DIM
, 
MAZE_Y_DIM
,

845 
MAZE_X_ORIGIN
, 
MAZE_Y_ORIGIN
, 1);

847 
	`XPutImage
(
dpy
, 
mwWšdow
, 
cİyGC
, 
mazeImage
, 0, 0, 
MAZE_X_ORIGIN
,

848 
MAZE_Y_ORIGIN
, 
MAZE_X_DIM
, 
MAZE_Y_DIM
);

850 
	}
}

857 
	$š™R©s
(
width
, 
height
) {

858 #ifdeà
USE_BITMAPS


859 
¿tsB™m­
 =

860 
	`xC»©eB™m­FromB™C–l
(
dpy
, 
mwWšdow
, (*)
¿tB™s
, 
width
, 
height
);

861 ià(
¿tsB™m­
 == 0)

863 
¿tsImage
 =

864 
	`XC»©eImage
(
dpy
, 
	`DeçuÉVisu®
(dpy, 
	`DeçuÉSü“n
(dpy)), 1, 
XYB™m­
, 0,

865 (*)
¿tB™s
, 
width
, 
height
, 8, width >> 3);

866 
¿tsImage
->
by‹_Üd”
 = 
MSBFœ¡
;

867 
¿tsImage
->
b™m­_b™_Üd”
 = 
MSBFœ¡
;

869 ià(
¿tsImage
 == 0)

871 
	`MWE¼Ü
("Can't create„ats");

872 
	}
}

883 
	$»·štWšdow
() {

884 
	`d¿wMaze
();

885 
	`ShowPos™iÚ
(
MY_X_LOC
, 
MY_Y_LOC
, 
MY_DIR
);

886 
	`ShowV›w
(
MY_X_LOC
, 
MY_Y_LOC
, 
MY_DIR
);

887 
	`ShowAÎPos™iÚs
();

889 
	`NewScÜeC¬d
();

890 
	`XFlush
(
dpy
);

891 
	}
}

900 
	$»·štIcÚ
() {

901 
XWMHšts
 
wmhšts
;

903 ià(!
icÚInv”‹d
)

904 
wmhšts
.
icÚ_pixm­
 = icon_pixmap;

906 
wmhšts
.
icÚ_pixm­
 = 
icÚ_»v”£_pixm­
;

907 
wmhšts
.
šput
 = 
TRUE
;

908 
wmhšts
.
æags
 = 
IcÚPixm­Hšt
 | 
IcÚMaskHšt
 | 
IÅutHšt
;

909 
wmhšts
.
icÚ_mask
 = 
icÚmask_pixm­
;

910 
	`XS‘WMHšts
(
dpy
, 
mwWšdow
, &
wmhšts
);

911 
	}
}

920 
Pixm­
 
	$xC»©eB™m­FromB™C–l
(
Di¥Ïy
 *
di¥Ïy
, 
D¿wabË
 
d
, *
d©a
,

921 
width
,

922 
height
) {

923 
XImage
 
ximage
;

924 
GC
 
gc
;

925 
Pixm­
 
pix
;

927 
pix
 = 
	`XC»©ePixm­
(
di¥Ïy
, 
d
, 
width
, 
height
, 1);

928 ià(!
pix
)

930 
gc
 = 
	`XC»©eGC
(
di¥Ïy
, 
pix
, ()0, (
XGCV®ues
 *)0);

931 
	`mem£t
(&
ximage
, 0, (ximage));

932 
ximage
.
height
 = height;

933 
ximage
.
width
 = width;

934 
ximage
.
d•th
 = 1;

935 
ximage
.
xoff£t
 = 0;

936 
ximage
.
fÜm©
 = 
ZPixm­
;

937 
ximage
.
d©a
 = data;

938 
ximage
.
by‹_Üd”
 = 
MSBFœ¡
;

939 
ximage
.
b™m­_un™
 = 8;

940 
ximage
.
b™m­_b™_Üd”
 = 
MSBFœ¡
;

941 
ximage
.
b™m­_·d
 = 8;

942 
ximage
.
by‹s_³r_lše
 = (
width
 + 7) / 8;

943 
	`XIn™Image
(&
ximage
);

945 
	`XPutImage
(
di¥Ïy
, 
pix
, 
gc
, &
ximage
, 0, 0, 0, 0, 
width
, 
height
);

946 
	`XF»eGC
(
di¥Ïy
, 
gc
);

947  (
pix
);

948 
	}
}

955 
	$D¿wSŒšg
(cÚ¡ *
msg
, 
ušt32_t
 
Ëngth
, ušt32_ˆ
x
, ušt32_ˆ
y
) {

956 
	`XD¿wImageSŒšg
(
dpy
, 
mwWšdow
, 
cİyGC
, 
x
, 
y
, 
msg
, 
Ëngth
);

957 
	}
}

966 
	$StİWšdow
(è{
	}
}

	@bitmaps/cup.cur

1 
	#cup_width
 16

	)

2 
	#cup_height
 16

	)

3 
	#cup_x_hÙ
 1

	)

4 
	#cup_y_hÙ
 12

	)

5 
	gcup_b™s
[] = {

	@bitmaps/dRat.cur

1 
	#dR©_width
 16

	)

2 
	#dR©_height
 16

	)

3 
	#dR©_x_hÙ
 0

	)

4 
	#dR©_y_hÙ
 9

	)

5 
	gdR©_b™s
[] = {

	@bitmaps/dRatMask.cur

1 
	#dR©Mask_width
 16

	)

2 
	#dR©Mask_height
 16

	)

3 
	#dR©Mask_x_hÙ
 -1

	)

4 
	#dR©Mask_y_hÙ
 -1

	)

5 
	gdR©Mask_b™s
[] = {

	@bitmaps/icon.ic

1 
	#icÚ_width
 32

	)

2 
	#icÚ_height
 32

	)

3 
	gicÚ_b™s
[] = {

	@bitmaps/rat.cur

1 
	#¿t_width
 16

	)

2 
	#¿t_height
 16

	)

3 
	#¿t_x_hÙ
 0

	)

4 
	#¿t_y_hÙ
 6

	)

5 
	g¿t_b™s
[] = {

	@bitmaps/ratMask.cur

1 
	#¿tMask_width
 16

	)

2 
	#¿tMask_height
 16

	)

3 
	#¿tMask_x_hÙ
 -1

	)

4 
	#¿tMask_y_hÙ
 -1

	)

5 
	g¿tMask_b™s
[] = {

	@
1
.
0
32
485
Exception.h
Nominal.h
display.cpp
display.h
fwk/Array.h
fwk/BaseCollection.cpp
fwk/BaseCollection.h
fwk/BaseNotifiee.cpp
fwk/BaseNotifiee.h
fwk/Exception.cpp
fwk/Exception.h
fwk/HashMap.h
fwk/LinkedList.h
fwk/LinkedQueue.h
fwk/ListRaw.h
fwk/NamedInterface.h
fwk/Ptr.h
fwk/PtrInterface.h
fwk/String.h
fwk/TypeTraits.h
fwk/Types.h
init.cpp
main.h
mazewar.h
toplevel.cpp
winsys.cpp
bitmaps/cup.cur
bitmaps/dRat.cur
bitmaps/dRatMask.cur
bitmaps/icon.ic
bitmaps/rat.cur
bitmaps/ratMask.cur
